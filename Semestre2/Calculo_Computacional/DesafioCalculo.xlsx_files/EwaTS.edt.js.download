'use strict';(globalThis.dullscriptWebpackJsonp=globalThis.dullscriptWebpackJsonp||[]).push([[18],{97168:function(ka,oa,a){a.d(oa,{a:function(){return r}});oa=a(22535);oa=a.n(oa);var H=a(88840);a=a.n(H)()(oa());a.push([ka.id,'.ewa-ac{position:absolute;z-index:102;margin-top:1px;width:auto}.ewa-ac .ewa-ac-param{white-space:nowrap;margin-bottom:3px;direction:ltr}.ewa-ac .ewa-ac-param function_param_table{position:absolute}.ewa-ac .ewa-ac-param .ewa-function-help-link{text-decoration:underline}.ewa-lb{position:absolute;border:1px solid #a2a6ab;overflow-x:hidden;overflow-y:auto;cursor:default;background-color:#fff;color:#262626;font-size:12px;font-family:"Segoe UI";z-index:102;height:auto;margin:0 8px;touch-action:manipulation;vertical-align:middle}.ewa-lb.ewa-fb-refactor{position:relative;margin:0}.ewa-lb table{left:0;right:0;border-collapse:collapse}.ewa-lb table td{white-space:nowrap}.ewa-lb table td div.clip16x16{margin:0 0 0 2px}.ewa-lb table td.list-item{height:24px;padding:0 8px}.ewa-lb table td.list-item-selected{background-color:#d3f0e0}@media screen and (-ms-high-contrast:active){.ewa-lb table td.list-item-selected{border:2px solid #fff}}.ewa-lb table.list-table-touch td.list-item{height:35px}div#suggested_cells_list_box{margin:0}div#suggested_cells_list_box .list-table .ewa-suggested-cell-name{float:left;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}@font-face{font-family:"Segoe UI Semibold";font-weight:600;src:local("Segoe UI Semibold"),local("Segoe UI")}.ewa-lb table td.columnName-header{color:#666;font-size:12px;font-family:"Segoe UI Semibold";text-align:left;padding:3px 8px;text-overflow:ellipsis}.ewa-tt{background-color:#f7f7f7;border:1px solid #a2a6ab;color:#444;height:auto;vertical-align:middle;width:auto;z-index:102;font-size:8pt;margin:0;padding-bottom:3px;padding-top:2px}.ewa-root-ltr .ewa-tt{text-align:left;padding-left:5px;padding-right:7px}.ewa-root-rtl .ewa-tt{text-align:right;padding-left:7px;padding-right:5px}.ewa-dlg-function-link-container .ewa-fdb-help-link,.ewa-tt-ltr .ewa-fdb-help-link,.ewa-tt-rtl .ewa-fdb-help-link{color:#00f;text-decoration:underline}.ewa-function-link-container .ewa-function-udf-name,.ewa-function-link-container-udf .ewa-function-help-link{display:none}.ewa-root.rtl .ewa-function-link-container{text-align:left}',
""]);const r=a},13815:function(ka,oa,a){a.d(oa,{a:function(){return r}});oa=a(22535);oa=a.n(oa);var H=a(88840);a=a.n(H)()(oa());a.push([ka.id,".ewa-fb-fluent .ewa-rteLine .formula-highlight-1,.ewa-gridKeyHandler .formula-highlight-1{color:#006cbe}.ewa-fb-fluent .ewa-rteLine .formula-highlight-1::selection{color:#b2e3ff}.ewa-fb-fluent .ewa-rteLine .formula-highlight-2,.ewa-gridKeyHandler .formula-highlight-2{color:#bc2f32}.ewa-fb-fluent .ewa-rteLine .formula-highlight-2::selection{color:#ffcfe1}.ewa-fb-fluent .ewa-rteLine .formula-highlight-3,.ewa-gridKeyHandler .formula-highlight-3{color:#7c53ac}.ewa-fb-fluent .ewa-rteLine .formula-highlight-3::selection{color:#e9d4ff}.ewa-fb-fluent .ewa-rteLine .formula-highlight-4,.ewa-gridKeyHandler .formula-highlight-4{color:#0f700f}.ewa-fb-fluent .ewa-rteLine .formula-highlight-4::selection{color:#98ff87}.ewa-fb-fluent .ewa-rteLine .formula-highlight-5,.ewa-gridKeyHandler .formula-highlight-5{color:#bf0077}.ewa-fb-fluent .ewa-rteLine .formula-highlight-5::selection{color:#fcf}.ewa-fb-fluent .ewa-rteLine .formula-highlight-6,.ewa-gridKeyHandler .formula-highlight-6{color:#b5490f}.ewa-fb-fluent .ewa-rteLine .formula-highlight-6::selection{color:#ffda00}.ewa-fb-fluent .ewa-rteLine .formula-highlight-7,.ewa-gridKeyHandler .formula-highlight-7{color:#00758f}.ewa-fb-fluent .ewa-rteLine .formula-highlight-7::selection{color:#3df5e8}",
""]);const r=a},44176:function(ka,oa,a){function H(W,Ta){(0,Od.d)(()=>{var ob=Ya.EwaSettings.i3d()?W.getCellBounds(W.Db(null)?.cell,!0,!1):W.getCellBounds(W.Db(null)?.cell,!0);ob&&(ob=ob?new Sys.UI.Bounds(ob.x+ob.width,ob.y+ob.height,0,0):null)&&Ta.Bxb(["DatePickerFloatie"],ob,tc.a.xb)})}function r(W){const Ta=(0,Ga.f)(W);W=(0,ma.a)(W);var ob=Ta.vj,K=Ta.cellTextEditBox.d$f;K=Ta.Qv||K&&W;W=Aa((K?W:ob).Ya.domElement);if(K)ob={top:0,left:0,right:innerWidth,bottom:innerHeight};else if(W.left+=12,Ta.oD?
(ob=Ta.vE.x,K=Ta.vE.y,ob={top:ob,left:K,right:ob+Ta.vE.width,bottom:K+Ta.vE.height}):ob=Aa(Ta.domElement),Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:7845089_fixFormulaAssistancePositoningInFreezePanes")&&Ta.fb.Ti&&(K=Ta.fb,ob.top-=K.height,ob.left-=K.width),{zoom:K}=(0,bd.a)(),1!==K)for(var ja of[W,ob])for(const ub in ja)ja[ub]*=K;return Wd?(ja=Ta.Kw(Ta.da.la.activeCell),{target:W,bounds:ob,activeCellAndGridZoom:{top:ja?ja.top:0,bottom:ja?ja.bottom:0,zoomNumber:Ta.YM}}):{target:W,bounds:ob}}function Aa(W){const {top:Ta,
left:ob,right:K,bottom:ja}=Ua.HelperMethods.isStandardZoomCssSupportedByBrowser?Mb.DOMElementExtensions.clb({element:W}):W.getBoundingClientRect();return{top:Ta,left:ob,right:K,bottom:ja}}function k(W){switch(W.type){case jf.a.NamedRange:return Fc.iRa.NamedRange;case jf.a.Table:return Fc.iRa.Table;case jf.a.Lambda:return Fc.iRa.Lambda;default:return Fc.iRa.Other}}function y(W){if(W){var Ta=new lf(W.kind===Fc.Mha.CellRef);W=W?.rangeInfo?.positionKindInfo;if(!W)return Ta;Ta.lma=W.firstRow===Fc.cBb.Absolute;
Ta.kma=W.firstColumn===Fc.cBb.Absolute;Ta.Swa=W.secondRow===Fc.cBb.Absolute;Ta.Rwa=W.secondColumn===Fc.cBb.Absolute;return Ta}}function b(W,Ta){return W===Ta?{kind:"equal"}:{kind:"different",diff:Ib.a.acf(W,Ta)}}function c(W){[W.clientResult,W.serverResult].forEach(Ta=>{(0,vd.c)(Ta)||"success"!==Ta.kind||(Ta.value=Ib.a.D1(Ta.value),Ta.unformattedValue=Ib.a.D1(Ta.unformattedValue))})}function d(W,Ta,ob){if(W.has(Ta))return W.get(Ta);ob=ob();W.set(Ta,ob);return ob}function m(W,Ta,ob,K,ja){if(!K)return ja();
if(W.has(Ta))return W.get(Ta);K=ja();W.set(Ta,K);W.set(ob,K);return K}function l(W){return JSON.stringify({text:W.text,index:W.index,length:W.length})}function f(W){return(0,vd.c)(W)?"Undefined text":""===W?"Empty text":null}function e(W,Ta){if(W===Ta)return!0;if(!W||!Ta||W.kind!==Ta.kind||W.Fv!==Ta.Fv||W.WJe!==Ta.WJe||W.source.trigger!==Ta.source.trigger)return!1;switch(W.kind){case "Success":return n(W,Ta);case "Loading":return W.index===Ta.index&&W.length===Ta.length;default:return W}}function n(W,
Ta){return W.Fv===Ta.Fv&&W.index===Ta.index&&W.length===Ta.length}function h({x:W,y:Ta},ob,K=document){let ja=-1,ub=null;void 0!==K.caretPositionFromPoint?(W=K.caretPositionFromPoint(W,Ta),null!==W&&(ja=W.offset,ub=W.offsetNode)):void 0!==K.caretRangeFromPoint&&(W=K.caretRangeFromPoint(W,Ta),null!==W&&(ja=W.startOffset,ub=W.startContainer));return null===ub||-1===ja?(Ma.ULS.sendTraceTag(521446491,0,15,"getEditorCaretPositionFromPoint - failed to get relevant range"),-1):ob.contains(ub)?t(ob,ub,ja):
(Ma.ULS.sendTraceTag(521446490,0,15,"getEditorCaretPositionFromPoint - relavant node not inside root"),-1)}function t(W,Ta,ob){if(W===Ta)return ob;if(Ta.textContent!==Ta.parentElement.textContent)for(;null!==Ta.previousSibling;)Ta=Ta.previousSibling,ob+=Ta.textContent.length,"div"===Ta.nodeName.toLowerCase()&&(ob+=1);return t(W,Ta.parentElement,ob)}function v(W,Ta){return W.text===Ta.text&&W.index===Ta.index&&W.length===Ta.length}function u(W){return"Failure"!==W.kind?{kind:"Success",value:{cell:{col:W.cell.FirstColumn,
row:W.cell.FirstRow},value:x(W),formatted:W.format}}:{kind:"Failure",reason:{cell:{col:W.cell.FirstColumn,row:W.cell.FirstRow,cols:W.cell.LastColumn-W.cell.FirstColumn+1,rows:W.cell.LastRow-W.cell.FirstRow+1},kind:W.value.toString(),innerKind:"Unknown"}}}function x(W){if("ExcelAppError"===W.kind)return{kind:8,type:W.value};switch(typeof W.value){case "number":return{kind:1,_valueXL:W.value};case "string":return{kind:2,value:W.value};case "boolean":return{kind:4,_valueXL:W.value?1:0}}}function w(W){const Ta=
/^ROW\(\) [-+] ROW\(\w+\)( [-+] \d+)?$/;return/^ROW\(\) [-+] \d+$/.test(W)||"ROW()"===W||Ya.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleReferenceRowFormula",!1)&&Ta.test(W)}function z(W,Ta,ob,K){Ta=new La.a(562,0,Va(W,Ta,ob,K),18,null);W=W.Ba.enqueueOperation(Ta,null);Ma.ULS.shipAssertTag(507331929,0,!!W,"RangeAndSheetNameExtractor.InvokeWebMethodRequest: queueItem is null after scheduling the web method call.")}function A({x:W,y:Ta},ob,K=document){let ja=-1,ub=null;
void 0!==K.caretPositionFromPoint?(W=K.caretPositionFromPoint(W,Ta),null!==W&&(ja=W.offset,ub=W.offsetNode)):void 0!==K.caretRangeFromPoint&&(W=K.caretRangeFromPoint(W,Ta),null!==W&&(ja=W.startOffset,ub=W.startContainer));return null===ub||-1===ja?(Ma.ULS.sendTraceTag(507339543,0,15,"getEditorCaretPositionFromPoint - failed to get relevant range"),-1):ob.contains(ub)?C(ob,ub,ja):(Ma.ULS.sendTraceTag(507339542,0,15,"getEditorCaretPositionFromPoint - relavant node not inside root"),-1)}function C(W,
Ta,ob){if(W===Ta)return ob;if(Ta.textContent!==Ta.parentElement.textContent)for(;null!==Ta.previousSibling;)Ta=Ta.previousSibling,ob+=Ta.textContent.length,"div"===Ta.nodeName.toLowerCase()&&(ob+=1);return C(W,Ta.parentElement,ob)}function G(W){return(0,vd.b)(W)&&(0,vd.b)(W.FormulaInfo)&&(0,vd.b)(W.FormulaInfo.Formula)&&(W.FormulaInfo.FormulaType===je.d.Formula||W.FormulaInfo.FormulaType===je.d.ArrayFormula)&&1<W.FormulaInfo.Formula.length&&W.FormulaInfo.Formula!==W.Text}function F(W){return{["formula"]:W.FormulaInfo.Formula,
["formulaTokens"]:W.FormulaInfo.Formula,["formulaType"]:W.FormulaInfo.FormulaType,["value"]:W.Text,["unformattedValue"]:W.Value,["valueType"]:W.ValueType,["hasError"]:W.HasError,["ifmt"]:W.Ifmt,["ifmtStamped"]:W.IfmtStamped,["row"]:W.Row,["col"]:W.Col}}function B(W,Ta){return W===Ta?{kind:"equal"}:(0,vd.c)(W)&&(0,vd.c)(Ta)?{kind:"empty",source:"both"}:(0,vd.c)(W)||(0,vd.c)(Ta)?{kind:"empty",source:(0,vd.c)(W)?"cse":"immediate"}:{kind:"different",diff:Ib.a.acf(W,Ta)}}async function P(W){const Ta=await yc.a.resolve(Mc.kRa),
ob=wb.Range.pc(W.row,W.col);return{...W,formula:Ta.anonymize(W.formula,ob),formulaTokens:Ib.a.D1(W.formulaTokens),value:Ib.a.D1(W.value),unformattedValue:Ib.a.D1(W.unformattedValue)}}function U(W){if((0,vd.b)(W)&&(0,vd.b)(W.table)&&(0,vd.b)(W.table.interpretations)){var Ta={sheetId:W.table.analyzedRange.sheetId,analyzedRange:(0,Sb.NHc)(W.table.analyzedRange.range),interpretations:W.table.interpretations.map(O)};a:{switch(W.metadataState){case 2:W=Fc.tRa.Valid;break a;case 4:W=Fc.tRa.Invalid;break a;
case 6:W=Fc.tRa.All;break a}W=void 0}Ta={rangeTableInfo:Ta,metadataState:W}}else Ta=null;return Ta}function O(W){if(W){var Ta=(0,Sb.NHc)(W.tableLocation);var ob=W.confidence,K=W.headerRowCount,ja=W.headerColumnCount;a:{switch(W.orientation){case 0:W=Fc.Rfc.none;break a;case 1:W=Fc.Rfc.rowMajor;break a;case 2:W=Fc.Rfc.columnMajor;break a}W=void 0}Ta={tableLocation:Ta,confidence:ob,headerRowCount:K,headerColumnCount:ja,orientation:W}}else Ta=null;return Ta}function L(W,Ta,ob){const K=W.Tv,ja=W.lS();
W.HMa(()=>{const ub=W.Tv-K,Cb=W.lS(),Jc=ja===Cb,cd=[],Kd=Ya.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FbeEcsMismatchesMaxExamplesPerLog",5);let ne=0;for(const Gf of Ta){if(cd.length>=Kd)break;var Ve=W.Db(Gf.range);if(!Ve){ne++;continue}const Eg=Gf.text,Wf=Gf.value,Hf=mh[Gf.kind],Tf=Ve.text,bg=Ve.Nh.value;Ve=je.e[Ve.Nh.type];a:{var uf=Wf;var sf=Tf,Rf=bg;if(Eg===sf){uf=vg.NoMismatch;break a}const Lg=/^#+$/.test(Eg);sf=/^#+$/.test(sf);uf=Lg||sf?uf===Rf?vg.NoMismatch:vg.HashesValueMismatch:
vg.Mismatch}uf!==vg.NoMismatch&&cd.push({["cseText"]:Ib.a.eY(Eg),["cseValue"]:Ib.a.eY(Wf),["cseKind"]:Hf,["ecsText"]:Ib.a.eY(Tf),["ecsValue"]:Ib.a.eY(bg),["ecsType"]:Ve,["isHashesValue"]:uf===vg.HashesValueMismatch,["areValuesEqual"]:Wf===bg})}0<cd.length&&Ma.ULS.sendTraceTag(67707660,0,20,"ECS mismatch detected! "+JSON.stringify({["flowId"]:ob,["stateIdDiff"]:ub,["isSameRequestId"]:Jc,["requestIdBeforeEvent"]:ja,["requestIdAfterEvent"]:Cb,["correctCellsCount"]:Ta.length-cd.length,["cellsWithMismatchCount"]:cd.length,
["mismatches"]:cd}));0<ne&&Ma.ULS.sendTraceTag(508704130,0,50,"FormulaByExampleEcsMismatchDetection:checkForEcsMismatch: "+ne+" cells not loaded. flowId: "+ob)})}function T(W){return wb.Range.pc(W.row+1,W.col+1)}function Z(W,Ta){W=W.Nh.type===je.e.Number?parseFloat(W.Nh.value):W.Nh.value;return jh(Ta)===W}function za(W){return"Table"===W.kind?W.formula:W.dQd}a.r(oa);var na={};a.r(na);a.d(na,{jul:function(){return Nb}});var N={};a.r(N);a.d(N,{kul:function(){return Wc}});var ca={};a.r(ca);a.d(ca,{jvl:function(){return fc}});
var ea={};a.r(ea);a.d(ea,{kvl:function(){return Hb}});var ia={};a.r(ia);var Fa={};a.r(Fa);a.d(Fa,{axl:function(){return Jb}});var Oa={};a.r(Oa);a.d(Oa,{bxl:function(){return Tc}});var Qa={};a.r(Qa);a.d(Qa,{cxl:function(){return we}});var Db={};a.r(Db);a.d(Db,{dxl:function(){return Le}});var Eb={};a.r(Eb);a.d(Eb,{fxl:function(){return kf}});var $a={};a.r($a);a.d($a,{gxl:function(){return Dc}});var ha={};a.r(ha);var Ea={};a.r(Ea);a.d(Ea,{exl:function(){return fd}});var aa={};a.r(aa);var fa={};a.r(fa);
a.d(fa,{ixl:function(){return Ad}});var ba={};a.r(ba);a.d(ba,{xlh:function(){return Ob}});var R={};a.r(R);a.d(R,{jxl:function(){return uc},kxl:function(){return X}});var Za={};a.r(Za);var da={};a.r(da);a.d(da,{lxl:function(){return xd}});var db={};a.r(db);a.d(db,{mxl:function(){return cf}});var eb={};a.r(eb);a.d(eb,{xxl:function(){return ab}});var cb={};a.r(cb);a.d(cb,{GotoCtrlClick:function(){return eg}});var Ab={};a.r(Ab);a.d(Ab,{Exl:function(){return Ug}});var pb={};a.r(pb);var vb={};a.r(vb);a.d(vb,
{Ayl:function(){return Pg}});var mb={};a.r(mb);a.d(mb,{YBl:function(){return fh}});var Ba=a(43216),ya=a(89236),Ma=a(60302),ua=a(22440),Ha=a(85988),Ra=a(44509),Ua=a(99488),Ga=a(60896);class pa extends Ha.a{constructor(W,Ta){super(document.createElement("div"));this.UZ=this.uyc=this.POb=this.QOb=this.yyc=this.ROb=!1;this.rQ=null;this.visible=void 0;this.zoom=null;this.Bge=(ob,K)=>{this.Wt(ob,K)};this.u0a=()=>{this.ed.Ya.$I=!0};this.PMa=()=>{this.autoComplete(!0)};this.Kqg=()=>{this.ed.Ya.focus()};this.onActiveCellChanged=
()=>{Ga.f(this.J).inRangePicker||(this.Yh=!1)};this.J=W;this.zoom=Ta;Ga.f(W)&&Ga.f(W).da&&Ga.f(this.J).da.add_activeCellChanged(this.onActiveCellChanged)}get zoomManager(){return this.zoom.zoomManager}get mJ(){return this.rE.mJ}get Yh(){return this.rE.Yh}set Yh(W){this.rE.Yh=W}get ed(){return this.rQ}set ed(W){(this.rQ=W)&&this.rQ.vJe.add(this)}get_visible(){return void 0!==this.visible?this.visible:this.visible=super.get_visible()}set_visible(W){if(this.visible===W)return W;this.visible=W;return super.set_visible(W)}Wt(){this.vQa(!1);
this.rE.Wt()}dispose(){this.J&&Ga.f(this.J)&&Ga.f(this.J).da&&Ga.f(this.J).da.remove_activeCellChanged(this.onActiveCellChanged);this.J=null;super.dispose()}gl(W,Ta,ob=!1){W=!1;if((this.SNb||ob)&&!this.uob()&&this.get_visible()&&this.Yh)switch(this.hHe(Ta),Ta){case 1872288872:this.Yh=!1;W=!0;break;case -798660877:this.rE.tD(1);W=!0;break;case 137938150:this.rE.tD(-1);W=!0;break;case 2091832999:this.rE.tD(this.mJ-1);W=!0;break;case 742457698:this.rE.tD(-(this.mJ-1));W=!0;break;case 125627505:W=this.autoComplete(!1);
break;case 267796030:W=this.autoComplete(!1)}return W}vQa(W){if(this.Yh||W){var Ta=Ga.f(this.J),ob=this.rQ.Ya.domElement;W=this.zoomManager.uh(ob.offsetHeight);var K=this.zoomManager.uh(ob.offsetTop);ob=this.zoomManager.uh(ob.offsetLeft);Ta=Ta.Qv;$get(this.J.Bc+Ra.a.lDd,this.J.domElement);var ja=document.getElementById("EditorContainer");var ub=new Sys.UI.Point(Ta?this.rE.$Pd:0,Ta?-5:pa.Mbj),Cb=this.domElement;Cb.style.top=Ua.HelperMethods.Wc(ja.offsetTop+ub.y+(Ta?0:W+K));Cb.style.left=Ua.HelperMethods.Wc(ja.offsetLeft+
ob+ub.x)}}ebc(W){this.rE&&(W&&!this.UZ?(this.rE.rja(this.Kqg),this.rE.dqc(this.u0a),this.rE.jJb(this.PMa),this.UZ=!0):this.UZ&&(this.rE.toa(this.Kqg),this.rE.dZc(this.u0a),this.rE.j7b(this.PMa),this.UZ=!1))}hHe(W){switch(W){case -798660877:case 137938150:case 2091832999:case 742457698:this.ROb=!0;break;case 125627505:this.QOb=!0;break;case 267796030:this.POb=!0}}}pa.$Pd=0;pa.Mbj=1;(0,ya.a)(pa,"AutoCompleteControl",Ha.a,[352]);var kb=a(54219);class Zb{}Zb.PC="clip16x16";Zb.twi="ewa-ac";Zb.cMd="ewa-fb-refactor";
Zb.RBf="ewa-lb";Zb.Wzi="ewa-suggested-cell-name";Zb.iqb="list-item";Zb.$_b="list-item-selected";Zb.b0b="list-table";Zb.c0b="list-table-touch";Zb.rtl="rtl";Zb.o7g="suggested_cells_list_box";(0,ya.a)(Zb,"AutoCompleteClassNames",null,[]);class Bb extends Sys.EventArgs{constructor(W,Ta=0,ob="",K=""){super();this.length=W;this.selectedIndex=Ta;this.wM=ob;this.description=K}}(0,ya.a)(Bb,"ListEventArgs",Sys.EventArgs,[]);class kc{constructor(W,Ta){this.Fqh=W;this.Eqh=Ta}get hta(){return this.Fqh}get Ryd(){return this.Eqh}}
(0,ya.a)(kc,"CellAutoCompleteItem",null,[681]);var wc=a(79330),Gc=a(19594),qa=a(56694),Sb=a(52034),Ya=a(98856),Ib=a(93447);class lb extends Gc.a{constructor(W,Ta,ob){super(W,Ta);this.qt=null;this.AOc=0;this.Aaa=this.Vpb=null;this.xMa=(K,ja)=>{if(K=this.qt.items)if(1===K.length&&this.qt.SNb.length<K[0].hta.length&&this.qt.ZJa&&Ib.a.AH(K[0].hta,this.qt.SNb)&&(ja.newValue=K[0].hta),this.ed&&Ya.EwaSettings.Ua(128)){let ub=-1;1<K.length?ub=this.qt.kGc(this.ed.text,!0):1===K.length&&(this.qt.ZJa||this.qt.jIc)&&
(ub=0);if(0<=ub&&K.length>ub&&K[ub].Ryd){const Cb=Sb.I(K[ub].Ryd);Cb&&Ga.f(this.J).ub.YKa(Cb)&&(ja.z5f=!0,ja.ujf=K[ub].Ryd)}}};this.K3b=()=>{this.qt.ZJa=!1};this.ed.PIb(this.xMa);this.qt=ob;this.Aaa=this.wf.gf(this.ed.Ya.domElement);this.Aaa.Qa("mousedown",this.K3b)}get sKc(){return!1}get QKa(){return this.qt.Yh}set QKa(W){this.qt.Yh=W}get FIc(){return!1}get key(){return qa.a.TBd}dispose(){this.ed.XYc(this.xMa);super.dispose()}Gta(W){W&&!this.qt.Yh||super.Gta(W)}gl(W,Ta){this.qt.ed=this.ed;this.AOc=
W.keyCode;if(this.ed.isEditing){const ob=this.ed.text;Ib.a.equals(this.Vpb,ob,!1)||(this.Vpb=ob)}else this.Vpb=null;if(237279923===Ta)return this.qt.Yh=!1;Ya.EwaSettings.Ua(128)&&17===this.AOc&&this.qt.ZJa&&(this.qt.jIc=!0);return super.gl(W,Ta)}Lqg(){if(!Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:5172529_CheckForShuttingDownInAutocompletionTimedCallback")||!wc.AFrameworkApplication.Mf)if(this.qt.ed=this.ed,this.qt.ZJa=!1,this.ed.isEditing){const W=!Ib.a.equals(this.Vpb,this.ed.text,!0),Ta=this.ed.J2d;
Ta||!W&&229!==this.AOc?Ta&&(this.qt.Yh&&(this.qt.Yh=!1),this.qt.m3a?.cancel()):this.qt.ESh(this.AOc)}else this.Vpb=null}Mj(){}ng(){this.QKa=!1;this.qt.set_visible(!1);this.Vpb=null;this.qt.ZJa=!1;this.qt.jIc=!1;this.qt.m3a&&this.qt.m3a.cancel()}wHg(W,Ta){return this.qt.gl(W,Ta)}}(0,ya.a)(lb,"CellAutoCompleteListAutoCompleteBehavior",Gc.a,[]);var Yb=a(6546),ec=a(49498),tc=a(37883),Mb=a(84410),Y=a(42108),S=a(80551);class va extends ec.a{constructor(W,Ta){super(W,Ta,new S.a(Zb.iqb,Zb.$_b,Zb.b0b,Zb.c0b));
this.UGc=!1;this.OGb=this.X2=null;this.EKf=!1;this.visible=void 0;this.JPa(!0);this.EKf=Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:5893822_FixFormulaBarXOffsetCrash")}get $Pd(){const W=document.getElementById(this.J.Bc+Ra.a.YPd);return!this.EKf||W?Mb.DOMElementExtensions.getBoundingClientRect({element:W}).x:0}get qg(){return this.OGb}set qg(W){this.OGb=W}get Yh(){return void 0!==this.visible?this.visible&&0<this.X2.length:(this.visible=Mb.DOMElementExtensions.isVisible(this.mh))&&0<this.X2.length}set Yh(W){this.visible!==
W&&(Mb.DOMElementExtensions.setVisible(this.mh,W),Mb.DOMElementExtensions.setVisible(this.Iyb,W),this.visible=W);const Ta=Ga.f(this.J).view;W?this.UGc||(Ta.jt(this.Qyd.Bge),this.UGc=!0):(this.X2.length=0,this.UGc&&(Ta.Qs(this.Qyd.Bge),this.UGc=!1))}nRc(){var W=460;const Ta=Ga.f(this.J);var ob=Ta.domElement,K=this.Iyb.style;const ja=this.mh.offsetTop+this.$o.offsetHeight*this.$o.sectionRowIndex-this.mh.scrollTop;K.width="auto";K.whiteSpace="nowrap";K.position="absolute";const ub=ob.offsetLeft+ob.offsetWidth-
(this.domElement.offsetLeft+this.mh.offsetLeft+this.mh.offsetWidth+3);ob=this.domElement.offsetLeft-3-(ob.offsetLeft+this.$Pd);W=Math.min(this.Iyb.offsetWidth,W,Math.max(ub,ob));Mb.DOMElementExtensions.HH(this.Iyb,W);K.whiteSpace="";K.position="absolute";ja+3>this.mh.offsetTop+this.mh.offsetHeight||ja<this.mh.offsetTop||(W=this.mh.offsetLeft-3-this.Iyb.offsetWidth,K=this.mh.offsetLeft+this.mh.offsetWidth+3,Mb.DOMElementExtensions.updatePosition(this.Iyb,ob>ub!==Ta.rtl?W:K,ja,!1))}tD(W){super.tD(W);
this.nRc()}Wt(){this.nRc()}AVa(){const W=this.Il,Ta=this.mh,ob=3===tc.a.xb||Yb.a.Nt,K=ob?this.aMa:this.mJ;this.Yh=!0;Ta.style.height="auto";this.Qyd.set_visible(!0);this.DIb(W,ob);this.X2.length>K&&(Mb.DOMElementExtensions.i6(Ta,Math.floor(Ta.offsetHeight*K/this.X2.length)),Ta.style.overflowY="auto");Mb.DOMElementExtensions.HH(Ta,W.offsetWidth+(this.X2.length>K?Y.a.Lr:0))}}(0,ya.a)(va,"AutoCompleteListBox",ec.a,[]);class bb extends va{constructor(W,Ta,ob,K){super(W,Ta);this.Wmc=null;this.Kc=ob;this.qt=
K;this.X2=[]}get $o(){return this.Wmc}set $o(W){this.z9a(this.$o);this.Wmc=W;const Ta=this.z9a(this.$o);this.qg=W?Ta.innerText:null;this.yue(W)}get Yh(){return super.Yh}set Yh(W){super.Yh=W;W||(this.$o=null)}get Iyb(){return null}get Qyd(){return this.qt}dispose(){super.dispose();this.Wmc=null}m9k(W){this.aBa(!1);const Ta=document.createElement("table");Ta.classList.add(this.dya);Ta.Odf=Ra.a.DFa;const ob=document.createElement("tbody");for(let K=0,ja=this.X2.length;K<ja;K++){const ub=document.createElement("tr"),
Cb=document.createElement("td");Cb.classList.add(this.l3a);const Jc=document.createElement("span");Jc.classList.add(bb.UBd);Jc.setAttribute(Ra.a.Obf,W[this.X2[K]].hta);Jc.innerText=W[this.X2[K]].hta;Cb.appendChild(Jc);ub.appendChild(Cb);ob.appendChild(ub)}Ta.appendChild(ob);this.Kc.TK(this.mh);this.mh.appendChild(Ta);this.Il=Mb.DOMElementExtensions.nr(this.domElement,this.dya);this.aBa(!0);this.AVa()}$Gi(W,Ta){if(W&&W.length){var ob=[];if(Ta)for(let K=0,ja=W.length;K<ja;K++)Ib.a.AH(W[K].hta,Ta)&&
ob.push(K);this.X2=ob;this.m9k(W)}else this.Yh=!1,this.Wmc=null}nRc(){}s_h(W,Ta,ob){let K=Math.min(W,Math.max(200,ob));Ta&&W<ob&&(K+=Y.a.Lr);Mb.DOMElementExtensions.HH(this.mh,K);Ta&&(K-=Y.a.Lr);return K}AVa(){super.AVa();var W=Mb.DOMElementExtensions.nr(this.get_element(),this.dya),Ta=this.X2.length>this.mJ,ob=Ga.f(this.J);if(ob=ob.Db(ob.da.la.activeCell))for(W=this.s_h(W.offsetWidth,Ta,ob.width),Ta=this.mh.getElementsByClassName(bb.UBd),ob=0;ob<Ta.length;ob++)Ta[ob].style.maxWidth=Ua.HelperMethods.Wc(W);
else Ma.ULS.sendTraceTag(537167964,0,15,"CellAutoCompleteListBox.AdjustHeightAndWidth: Can't retrive FormattedCell of the Current Active Cell.")}onItemClick(W){if(W=super.onItemClick(W)){const Ta=Ga.f(this.J);Ta.hv(!1);Ta.focus()}return W}}bb.UBd=Zb.Wzi;(0,ya.a)(bb,"CellAutoCompleteListBox",va,[]);var wb=a(10531),$b=a(84214),ma=a(73835),nb=a(12676),Gb=a(46388),xc=a(46325),hd=a(77941),Vb=a(51414),yc=a(872),Mc=a(33403),pd;let Nb=pd=class extends pa{constructor(W,Ta,ob,K,ja){super(W,ja);this.mSa=null;
this.SBd=[];this.jIc=this.ZJa=!1;this.VXe=this.Xn=null;this.xxf=()=>{this.W7.$Gi(this.items,this.mSa);this.raiseEvent("ACLBUpdated",new Bb(this.items.length));this.show()};a(78604);this.Yd=Ta;this.domElement.className=Zb.twi;Ta=document.createElement("div");Ta.classList.add(Zb.RBf);Ta.classList.add(Vb.a.KE);Ta.id=Zb.o7g;this.domElement.appendChild(Ta);Mb.DOMElementExtensions.setVisible(this.domElement,!1);hd.e(this.style,this.J.isChromeRtl);this.tjf=$get(Zb.o7g,this.domElement);this.W7=new bb(this.J,
this.tjf,ob,this);this.ebc(!0);this.J.domElement.appendChild(this.domElement);ma.b(this.J,ub=>{this.mKb(W,ub)});this.mKb(W,Ga.f(W).Jb);this.xtj=Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:8554518_ChangeHandleKeyDownConditionOrder");K.Qa(this)}Rvd(W){this.addHandler("ACLBUpdated",W)}sqe(W){this.removeHandler("ACLBUpdated",W)}es(W){this.addHandler("ACLBSelectionChanged",W)}Ls(W){this.removeHandler("ACLBSelectionChanged",W)}NLh(W){this.addHandler("ACLBMatchedItem",W)}Nzk(W){this.removeHandler("ACLBMatchedItem",
W)}get rE(){return this.W7}get SNb(){return this.mSa}get qg(){return this.W7.qg}get items(){return this.Xn}get m3a(){return this.VXe}get activeCell(){return Ga.f(this.J).da.la.activeCell}B6g(W){for(let Ta=0;Ta<W.length;Ta++)if(Ib.a.isLetter(W.charCodeAt(Ta)))return!0;return!1}uob(){return!this.items}dispose(){if(this.J){this.ebc(!1);const W=Ga.f(this.J);W&&W.view.Qs(this.Bge)}ua.a.jd([this.W7,this.m3a]);ua.a.jd(this.SBd);this.SBd=this.tjf=this.W7=this.ed=null;super.dispose()}gl(W,Ta){let ob=!1;if(this.WXk())switch(Ta){case -798660877:if(1===
this.items.length&&this.qg)break;this.rE.tD(1);this.raiseEvent("ACLBSelectionChanged",new Bb(this.items.length,this.kGc(this.qg),this.qg));ob=this.autoComplete(!1);break;case 137938150:if(1===this.items.length&&this.qg)break;this.rE.tD(-1);this.raiseEvent("ACLBSelectionChanged",new Bb(this.items.length,this.kGc(this.qg),this.qg));ob=this.autoComplete(!1);break;case 2091832999:this.rE.tD(this.mJ-1);ob=this.autoComplete(!1);break;case 742457698:this.rE.tD(-(this.mJ-1));ob=this.autoComplete(!1);break;
case 125627505:this.ed.Ya.caretPosition=this.ed.text.length;this.Yh=!1;ob=!0;break;case 267796030:this.autoComplete(!0);break;default:ob=super.gl(W,Ta)}return ob}show(){this.items&&this.items.length&&(this.W7.$o=this.qg?this.rE.Il.rows[this.kGc(this.qg)]:null,this.Yh=0<this.W7.X2.length,this.vQa(!0),this.W7.nRc())}ESh(W){const Ta=!!this.ed&&!$b.e(this.J.ja);this.jIc=this.ZJa=!1;this.ed&&!this.ed.isEditing?this.set_visible(!1):Ta&&!this.Yji(this.activeCell)&&this.y1k(W)}Yji(W){return yc.a.kb(Mc.hCa)?.VJd(W)}autoComplete(W){if(!this.ed||
!this.Yh)return!1;const Ta=this.mSa;if(this.qg){var ob=Mb.DOMElementExtensions.bea(Mb.DOMElementExtensions.nr(this.W7.$o,bb.UBd),Ra.a.Obf,"");const K=ob.substring(Ta.length,ob.length);W?this.ed.text=ob:this.ed.insertTextAt(K,Ta.length,this.ed.text.length)}ob=Ga.f(this.J);ob.Qv&&(ob=ob.Jb,ob.text=this.ed.text,ob.setCaretPosition(this.ed.Ya.caretPosition));W?this.Yh=!1:this.ed.Ya.selectRange(Ta.length,this.ed.text.length);return!0}kGc(W,Ta=!1){if(!this.W7.Il)return-1;const ob=this.W7.Il.children[0],
K=ob.children.length;let ja;for(let ub=0;ub<K;++ub)if(ja=ob.children[ub],Ib.a.equals(ja.innerText.trim(),W,Ta))return ub;return-1}XFh(W,Ta,ob,K,ja,ub,Cb){const Jc=ob.originalText.replace(pd.Fog,String.fromCharCode(32)),cd=new wb.Range(W.top-1,W.left,W.bottom-1,W.right,!1,!1),Kd=Cb?Cb.Ft(ob.range):null;(!ob.IB||ob.range.left===W.left)&&1<Jc.length&&!K.qb(Jc.toUpperCase())&&Ib.a.AH(Jc,Ta)&&!Ib.a.equals(Jc,Ta,!0)&&!pd.NIf(Ta)&&this.B6g(Jc)&&(!ja&&!Kd||!ja&&Kd.equals(Cb.Ft(cd))||ja&&ob.range.$c(ub)&&
ob.range.top!==ub.top)&&(W=ob.formulaBarText,Ib.a.equals(W,ob.text,!1)||!W)&&(W={},W.FirstRow=ob.range.top-1,W.FirstColumn=ob.range.left-1,ob=new kc(Jc,W),K.add(Jc.toUpperCase(),ob))}y1k(W){this.Xn=this.e8i();this.m3a&&this.m3a.cancel();0<this.ed.text.length&&0!==W?this.items&&((1<this.items.length||this.Yh)&&this.mri(),8!==W&&127!==W&&46!==W&&(1===this.items.length?this.ikj():this.W7.$o&&this.autoComplete(!1))):this.Yh=!1}mri(){this.Yh?this.xxf():this.VXe=nb.AsyncMethodContext.Ux(this.xxf,500,Gb.a.i2h,
this.m3a)}ikj(){Ma.ULS.shipAssertTag(537167966,0,!this.uob()&&1===this.items.length,"Invalid Items");const W=this.items[0].hta,Ta=this.ed.text,ob=W.substring(Ta.length,W.length);0<ob.length&&(this.ed.appendText(ob),this.ed.Ya.selectRange(Ta.length,this.ed.text.length),this.raiseEvent("ACLBMatchedItem",new Bb(this.items.length,0,W)),this.ZJa=!0)}e8i(){this.Xn=null;const W=new xc.a(!1);var Ta=this.activeCell;this.mSa=this.ed.text.replace(pd.Fog,String.fromCharCode(32));const ob=this.Yd.Ft(Ta),K=Ta.$c(ob);
if(pd.NIf(this.mSa)||!this.B6g(this.mSa))return this.items;const ja=new wb.Range(1,Ta.left,Ta.top-1,Ta.left,!1,!1);var ub=new wb.Range(Ta.top+1,Ta.left,kb.a.Xe,Ta.left,!1,!1);let Cb;const Jc=Ga.f(this.J);ub=Jc.Io("CellAutoCompleteControl.GetSuggestedCells",ub);try{const cd=Jc.Io("CellAutoCompleteControl.GetSuggestedCells2",ja);try{for(const Kd of[cd,ub])for(;Kd.$$mn();)Cb=Kd.$$cu(),this.XFh(Ta,this.mSa,Cb,W,K,ob,this.Yd)}finally{cd&&cd.dispose()}}finally{ub&&ub.dispose()}this.Xn=Array(W.values.length);
for(Ta=0;Ta<this.items.length;Ta++)this.items[Ta]=W.values[Ta];this.items.sort((cd,Kd)=>cd.hta.localeCompare(Kd.hta));return this.items}mKb(W,Ta){W&&Ta&&this.SBd.push(new lb(W,Ta,this))}WXk(){return this.xtj?this.SNb&&!this.uob()&&this.Yh?this.get_visible():!1:this.SNb&&!this.uob()&&this.get_visible()&&this.Yh}static get Fog(){return pd.GZe||(pd.GZe=new RegExp(String.fromCharCode(160),"g"))}static NIf(W){W=0<W.length?W.charCodeAt(0):-1;return 35===W||61===W||43===W||45===W||64===W}};Nb.GZe=null;Nb=
pd=(0,Ba.__decorate)([(0,yc.d)(Mc.y$c,{Sd:"transient"}),(0,Ba.__param)(0,(0,Mc.ra)()),(0,Ba.__param)(1,(0,Mc.ql)()),(0,Ba.__param)(2,(0,Mc.pl)()),(0,Ba.__param)(3,(0,Mc.Aec)()),(0,Ba.__param)(4,(0,Mc.Re)())],Nb);(0,ya.a)(Nb,"CellAutoCompleteControl",pa,[351,352,353,2]);var Lc=a(95445);let Wc=class{constructor(W){this.Tfb=null;this.lyg=(Ta,ob)=>{1<ob.length&&(Ta=Lc.a.instance.ea(858),this.ariaLiveNotifier.lKg(Ta,ob.length))};this.myg=(Ta,ob)=>{Ma.ULS.shipAssertTag(537167961,0,0<=ob.selectedIndex&&
0<=ob.length&&ob.selectedIndex<ob.length,"Invalid ListEventArgs: SelectedIndex/Length");Ma.ULS.shipAssertTag(537167960,0,!!ob.wM,"ListEventArgs: SelectedValue should not be null");this.ariaLiveNotifier.ork(ob.wM,ob.selectedIndex+1,ob.length)};this.nyg=(Ta,ob)=>{this.ariaLiveNotifier.f5(ob.wM)};this.ariaLiveNotifier=W}dispose(){this.QGe();this.Tfb=null}Qa(W){W&&(this.Tfb=W,W.Rvd(this.lyg),W.es(this.myg),W.NLh(this.nyg))}QGe(){this.Tfb&&(this.Tfb.sqe(this.lyg),this.Tfb.Ls(this.myg),this.Tfb.Nzk(this.nyg))}};
Wc=(0,Ba.__decorate)([(0,yc.d)(Mc.Aec),(0,Ba.__param)(0,(0,Mc.th)())],Wc);(0,ya.a)(Wc,"CellAutoCompleteReadoutHandler",null,[350,2]);var lc=a(14449),Qc=a(94386);let fc=class{constructor(W){this.eki=W}Rc(){return!1}executeCommand(W,Ta){W=!1;Ta=Ta.command;switch(Ta){case 1159342996:this.eki.N$b(!0),W=!0}return W?Qc.Task.Xa(!0):lc.a(Ta)}Ec(W,Ta){switch(Ta.command){case 1159342996:return Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:8841835_DatePickerEnabled");default:return!1}}Zc(){return!1}};fc=(0,
Ba.__decorate)([(0,yc.d)(Mc.R$c),(0,Ba.__param)(0,(0,Mc.P$a)())],fc);(0,ya.a)(fc,"DatePickerCommandHandler",null,[50]);var Fd=a(13400),ie=a(95052),Jd=a(26049),ee=a(37811),Ee=a(95912),hc=a(26195),Ac=a(60808),Od=a(55650),je=a(1176),Ed=a(68020),tb;let Hb=tb=class extends ee.a{constructor(W,Ta,ob,K){super(W,tb.featureName);this.mKc=!1;this.iYa=()=>{this.mKc&&(0,Od.d)(()=>{this.uG.ZC();this.mKc=!1;this.ld.detach("scroll");this.U.view.Qs(this.iYa)})};this.onActiveCellChanged=async()=>{Ya.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DatePickerFloatie",
!1)&&(this.iYa(),Ed.a(async()=>{!this.uG.job()&&await (0,hc.b)(this.grid.Db(null))&&(Ma.ULS.sendTraceTag(508610529,0,100,"DatePickerControl.onActiveCellChanged: Date Picker Floatie is to be shown"),this.v2g())},100)())};this.xna=async(ja,ub)=>{this.iYa();!this.uOb&&await (0,hc.a)(ub)&&(Ma.ULS.sendTraceTag(509147206,0,50,"DatePickerControl.onCellEditStarted: Encountered Date in cell, Date Picker service already available, showing date picker"),this.Dxc.start(),this.N$b())};this.wna=()=>{this.vJd()};
this.Xu=()=>{(0,Ac.g)(this.grid.Jb?.text)&&this.vJd()};this.QOk=ja=>{const ub=this.U.Jb;var Cb=this.U.Db(null);if(Cb){var Jc=this.Wd?.config;if(!Jc){this.Tse("DatePickerControl.SetCellDate: calc config unavailable",ub);return}ja=excelOnlineCalc.date.dateTime(ja.getFullYear(),ja.getMonth()+1,ja.getDate(),ja.getHours(),ja.getMinutes(),ja.getSeconds(),0,ja.getMilliseconds(),0);ja=Jc.datepack.toNum(Jc,ja);Jc=Jc.mathpack.toNumber(ja);this.uOb=!1;if(this.z4f||this.J.Mea){ja=this.Ge.BVd(Cb,{ValidMembers:32,
NumberFormat:4});if(!ja.success&&ja.oMa){this.Tse(`DatePickerControl.SetCellDate: Conversion to ribbon number format failed, LogData:  ${`
            reason: ${ja.reason},
            format: ${ja.oMa}`}`,ub);return}Cb=this.Ge.EKi(Jc.toString(),ja.oMa,je.e.Number,Cb.cell.k2);if(!Cb.success){this.Tse("DatePickerControl.SetCellDate:formatStringValueWithFormatString failed",ub);return}ub.text=Cb.OI;this.z4f=!1}else ub.text=Jc.toString();this.mKc?(this.U.setCell({Text:ub.text,TextRuns:null,Fonts:null},this.U.da.la.activeRange,0,127,null),this.iYa()):ub.endEdit(!0,"DatePickerControl.SetCellDate",0);Ma.ULS.sendTraceTag(509110228,0,50,"DatePickerControl.setCellDate: User selected Date using Date Picker")}this.sga()};
this.Tse=(ja,ub)=>{Ma.ULS.sendTraceTag(508956939,0,10,ja);ub.endEdit(!0,"DatePickerControl.SetCellDate Failed",0);this.sga()};this.Zti=()=>{this.Dxc&&(this.Dxc.stop(),Ma.ULS.sendTraceTag(508823174,0,50,`DatePickerControl: Time taken to render DatePicker: ${this.Dxc.xc}`))};this.sga=ja=>{(0,Od.d)(()=>{this.uOb=!1;Fd.FocusManager.instance().fm(ie.a.y2);Jd.a.Jvb(Mb.DOMElementExtensions.mTb(this.J.Qf),tc.a.xb,ja,this.J,this.U)})};this.mGg=()=>{Fd.FocusManager.instance().fm(ie.a.cga)};this.J=W;this.U=
Ga.f(this.J);this.Wd=Ta;this.Ge=ob;this.uG=K;this.U.Jb?.fr(this.wna);this.U.Jb?.GN(this.xna);this.U.Jb?.rVa(this.Xu);this.U.da.add_activeCellChanged(this.onActiveCellChanged);this.Dxc=this.J.Lb.Lg("DialogShown","DatePickerRender")}dispose(){this.vJd();this.iYa();this.U.Jb?.K_(this.xna);this.U.Jb?.rq(this.wna);this.U.Jb?.D6a(this.Xu);this.U.da.remove_activeCellChanged(this.onActiveCellChanged);super.dispose()}get jf(){return Ee.a.xtf}v2g(){H(this.grid,this.uG);this.mKc=!0;this.U.view.jt(this.iYa);
this.ld.Qa("scroll",this.iYa)}N$b(W=!1){this.z4f=W;this.ZBk(this.U.da.la.activeCell)}vJd(){this.uOb&&(0,Od.d)(()=>{appChrome.hideDatePicker();this.uOb=!1})}ZBk(W=null){const Ta=()=>{this.zxb(W,K=>{appChrome.renderDatePicker(this.domElement,K.y,K.x,K.y+K.height,K.x+K.width,!0,this.TRi(),this.QOk,this.sga,this.mGg,this.Pwb,this.U.rtl)});this.uOb=!0;this.Zti()},ob=()=>{(0,Od.d)(()=>{Ta()})};(0,Od.b)()&&window.requestIdleCallback?window.requestIdleCallback(Ta,{timeout:100}):ob()}TRi(){var W=new Date,
Ta=this.U.Db(null)?.cell;if(Ta?.cellValue&&this.Wd.r6f(Ta.$h)&&Ta.Fy===je.e.Number){var ob=this.Wd.config;Ta=parseInt(Ta.cellValue,10);if(!Ta||0>=Ta)return W;W=ob.mathpack.fromNumber(Ta);ob=ob.datepack.fromNum(ob,W,0);W=new Date(ob.yr,ob.mon-1,ob.dom)}return W}Om(){this.mGg()}lo(){this.sga()}};Hb=tb=(0,Ba.__decorate)([(0,yc.d)(Mc.P$a),(0,Ba.__param)(0,(0,Mc.ra)()),(0,Ba.__param)(1,(0,Mc.Rl)()),(0,Ba.__param)(2,(0,Mc.Zq)()),(0,Ba.__param)(3,(0,Mc.Qj)())],Hb);(0,ya.a)(Hb,"DatePickerControl",ee.a,[2]);
var Bc=a(34623),oc=a(60323);(0,yc.b)(Mc.BAb)(async()=>{const W=await yc.a.resolve(Mc.ra);return(Ta,ob,K=!1)=>{if(ob||K)a:if(ob){if(Ta&&(!Ta||Ta.startsWith("http://")||Ta.startsWith("https://"))){if(Ya.EwaSettings.Ua(147)&&(ob=yc.a.kb(Mc.Zaa))&&ob.FBa(Ta))break a;Ua.HelperMethods.vg(Ta,"_blank",Bc.a)}}else Ua.HelperMethods.N4(W.OJ,"XLWAEndUser_"+Ta,W.TM);else ob=new oc.a(-859308420,tc.a.xb,W.jc,0,null),W.Ga.vb(ob,{[tc.a.Ic]:Ra.a.WI,[tc.a.Cf]:"HelpID="+Ta})}});var Hc=a(3769),ed=a(92027),qd=a(25993);
class Gd extends Sys.EventArgs{constructor(W,Ta){super();this.functionName=W;this.bLf=Ta}}(0,ya.a)(Gd,"FormulaAssistanceFunctionChangedEventArgs",Sys.EventArgs,[]);class ve extends Sys.EventArgs{constructor(W){super();this.JVg=W}}(0,ya.a)(ve,"FormulaAssistanceSelectedParameterChangedEventArgs",Sys.EventArgs,[]);var de=a(91709);class Wb{constructor(W,Ta,ob,K,ja=null){this.NJc=this.DWa=!1;this.J=W;this.formulaAssistanceUIControl=Ta;this.uKf=ob;this.Pue=K;this.lYf=ja;this.NJc=Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:6592066_FixAutoCompleteCardFocusBug")}get Ri(){return this.DWa}set Ri(W){this.DWa!==
W&&(W?de.a(this.J).ll(this):de.a(this.J).JD(this),this.DWa=W)}get jf(){return this.Pue}get dd(){return this.formulaAssistanceUIControl.getRootElement(this.uKf)}Oj(W,Ta){W=!1;Ta||(Ga.f(this.J).vj.Ya.$I=!0,W=this.formulaAssistanceUIControl.focus(this.uKf));return W}Ak(W){const Ta=this.dd;return!(void 0===Ta||null===Ta)&&Mb.DOMElementExtensions.Di(Ta,W)}Om(){this.lYf&&this.lYf();const W=Ga.f(this.J).vj.Ya;this.selection=W.selection;W.removeSelection()}lo(){Ga.f(this.J).vj.Ya.selection=this.selection}dispose(){de.a(this.J).JD(this)}}
(0,ya.a)(Wb,"FormulaAssistanceFocusManager",null,[20,2]);var rc=a(69756),Vc=a(61856),jd=a(11942),Ld=a(80786),te=a(47582);class ue{constructor(W){this.y8=W;this.z3=this.dze=this.kq=!1;this.onKeyDown=Ta=>this.z3||"Space"!==Ta.code&&" "!==Ta.key||!Ta.altKey||!Ta.ctrlKey?!1:(this.Xzc(),Ta.stopPropagation(),Ta.preventDefault(),!0);this.T2a=Ta=>{if(!this.z3)return!1;if(Ta.eventName===rc.a.Xc){const ob=Ta.Ha.ctrlKey?1:Ta.Ha.shiftKey?50:10;switch(Ta.Ha.keyCode){case Vc.a.s$a:this.rfa(0,-ob);break;case Vc.a.TBa:this.rfa(0,
ob);break;case Vc.a.IQa:this.rfa(-ob,0);break;case Vc.a.Mzb:this.rfa(ob,0);break;case Vc.a.mX:case Vc.a.wo:this.dze=!0;break;default:return!1}}Ta.eventName===rc.a.Oe&&this.dze&&this.Lda(!0);Ta.Ha.preventDefault();return!0};this.I4b=Ta=>{if(!this.z3)return!1;Ta.Ha.preventDefault();this.Lda();return!0};this.onBlur=()=>{if(!this.z3)return!1;this.Lda();return!0};this.cz=jd.a.instance;this.ike=Ld.a.instance}Qa(W){(this.root=W)&&!this.kq&&(this.root.addEventListener("keydown",this.onKeyDown,!0),this.kq=
!0)}detach(){this.root&&this.kq&&(this.root.addEventListener("keydown",this.onKeyDown,!0),this.kq=!1)}Xzc(){this.root&&(this.y8.onStart("move",!0),this.root.focus(),this.z3=!0,this.dze=!1,this.xA(),this.Vce||this.CGd(),this.root.appendChild(this.Vce))}Lda(W=!1){this.z3&&(this.z3=!1,this.y8.onEnd(W),this.Kpe(),this.mpe())}xA(){this.cz.capture(this.T2a,null);this.ike.oz(rc.a.Kd,this.root,this.I4b,!0);this.root.addEventListener("blur",this.onBlur)}mpe(){this.cz.releaseCapture();this.ike.Cz(rc.a.Kd,this.root,
this.I4b,!0);this.root.removeEventListener("blur",this.onBlur)}Kpe(){this.Vce?.remove()}rfa(W,Ta){const ob=this.y8.getPosition();ob.x+=W;ob.y+=Ta;this.y8.setPosition(ob)}CGd(){this.Vce=te.b(24,24,"ShapeQuadArrow_24x24x32","WACMoveArrowIcon",!0,"")}}(0,ya.a)(ue,"FormulaAssistanceMoveAdapter",null,[]);var ye=a(31028);class Se{constructor(W){this.y8=W;this.startOffset={x:0,y:0};this.O5g=!0;this.kq=!1}oma(){return this.kq&&!!this.handle}C4a(W){const Ta=this.y8.getPosition();this.O5g=Ta.renderDown;this.startOffset.x=
Ta.x-W.clientPoint.x;this.startOffset.y=Ta.y-W.clientPoint.y;this.y8.onStart("drag");return!0}Oya(W){this.y8.setPosition({x:W.clientPoint.x+this.startOffset.x,y:W.clientPoint.y+this.startOffset.y,renderDown:this.O5g});return!0}Nya(){}Mya(){}Qa(W,Ta){this.handle=Ta;this.root=W;this.handle&&(this.handle.style.cursor="move",ye.a.instance.W$(this.handle,this,!1),this.kq=!0)}detach(){this.kq&&this.handle&&(this.handle.style.cursor="",ye.a.instance.yha(this.handle,this),this.kq=!1)}}(0,ya.a)(Se,"FormulaAssistanceDragAdapter",
null,[965]);class qb{get getPosition(){return this.Nuh}get setPosition(){return this.Lqd}constructor(W){this.formulaAssistanceTelemetryManager=W;this.kq=!1;this.Lrc=Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:7376612_argumentAssistanceOrderedActionsTelemetry");this.Spa={[Xb.Drag]:0,[Xb.Move]:0};this.Xmg=new ue(this);this.jxf=new Se(this)}Qa(W,Ta,ob,K){this.Nuh=ob;this.Lqd=K;this.Xmg.Qa(W);this.jxf.Qa(W,Ta);this.kq=!0}detach(){this.kq&&(this.jxf.detach(),this.Xmg.detach(),this.kq=!1)}clear(){this.Lqd&&
this.Lqd.call(this,null);this.detach();this.oQg()}onStart(W,Ta=!1){this.Spa[W]++;Ta&&(this.Fle=document.activeElement)}onEnd(W=!0){this.Fle&&(W&&this.Fle.focus(),this.Fle=null)}oQg(){const W=this.formulaAssistanceTelemetryManager.Bja,Ta=this.Spa[Xb.Drag],ob=this.Spa[Xb.Move];0<Ta&&(this.formulaAssistanceTelemetryManager.nja("d"),this.Lrc||(W.argumentAssistanceDragTotalCounter+=Ta),this.Spa[Xb.Drag]=0);0<ob&&(this.formulaAssistanceTelemetryManager.nja("m"),this.Lrc||(W.argumentAssistanceMoveTotalCounter+=
ob),this.Spa[Xb.Move]=0)}}(0,ya.a)(qb,"FormulaAssistanceDragControl",null,[]);var Xb;(function(W){W.Drag="drag";W.Move="move"})(Xb||(Xb={}));(0,ya.b)("FormulaAssistanceDragMode",Xb);var bd=a(84161);const Wd=Ya.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaAssistantMinifiedState",!1);var ze=a(44266);class Ae extends Ha.a{constructor(W,Ta,ob){super(Ae.MQd());this.J=W;this.formulaAssistanceUIControl=Ta;this.formulaAssistanceTelemetryManager=ob;this.isExpanded=!0;this.a3a=this.Zz=null;
this.vyc=this.gB=!1;this.bsi=0;this.Zxd=!1;this.UPd=0;this.setPosition=K=>{this.formulaAssistanceUIControl.setFixedPosition(K);this.formulaAssistanceUIControl.updatePosition(ze.lRa.ArgumentAssistanceCard);this.UPd++};this.getPosition=()=>this.formulaAssistanceUIControl.getPosition();this.Iob=Ya.EwaSettings.iLc();this.Fd=()=>{this.visible=!1};this.onIsExpandedChange=K=>{this.Ikl(K);K?this.formulaAssistanceTelemetryManager.nja("e"):this.formulaAssistanceTelemetryManager.nja("c")};this.onDismissClick=
()=>{this.dismiss();this.grid.vj.Ya.focus()};this.lve=K=>{var ja=this.J;K=K.functionName;const ub={};ub[Ra.a.CG]="ArgumentAssistanceCard";const Cb={};Cb.FunctionName=K;ub[Ra.a.zBc]=Cb;ja.uc(802602464,0,8,ub);this.formulaAssistanceTelemetryManager.nja("gf")};this.Wt=()=>{this.formulaAssistanceUIControl.updatePosition(ze.lRa.ArgumentAssistanceCard)};this.ng=()=>{this.y8.clear();this.zdl();this.Zxd=!1;Ma.ULS.sendTraceTag(506999066,0,50,`FormulaArgumentAssistanceControl.onEditEnded: Argument assistance card is dismissed after ${this.UPd} drag events`);
this.UPd=0};this.fRk();this.Zz=new Wb(this.J,this.formulaAssistanceUIControl,ze.lRa.ArgumentAssistanceCard,Ee.a.tKf);this.grid=(0,Ga.f)(W);this.grid.view.jt(this.Wt);this.grid.da.es(this.Fd);this.y8=new qb(this.formulaAssistanceTelemetryManager);this.grid.cellTextEditBox.fr(this.ng)}qLh(W){this.addHandler("FAFunctionNameUpdated",W)}rzk(W){this.removeHandler("FAFunctionNameUpdated",W)}sNh(W){this.addHandler("FAParameterSelectionChangedOld",W)}gBk(W){this.removeHandler("FAParameterSelectionChangedOld",
W)}rNh(W){this.addHandler("FAParameterSelectionChanged",W)}fBk(W){this.removeHandler("FAParameterSelectionChanged",W)}get visible(){return this.gB}set visible(W){W||this.dismiss();this.gB=W}dismiss(){this.gB=!1;this.formulaAssistanceUIControl&&(this.y8.detach(),this.formulaAssistanceUIControl.dismiss(this.domElement),this.a3a=null,this.Zz.Ri=!1)}show(W){this.gB=this.Zxd=!0;W=this.Skk(W);this.formulaAssistanceUIControl&&(this.formulaAssistanceTelemetryManager.FPa(["argumentAssistanceRender"]),this.formulaAssistanceUIControl.renderArgumentAssistanceCard(this.domElement,
W,()=>r(this.J)),this.NDk(),this.khk(W),this.y8.Qa(this.formulaAssistanceUIControl.getCalloutElement(ze.lRa.ArgumentAssistanceCard),this.formulaAssistanceUIControl.getDraggableElement(ze.lRa.ArgumentAssistanceCard),this.getPosition,this.setPosition),this.Iob&&"Full"!==W.kind||(this.Zz.Ri=!0),this.formulaAssistanceTelemetryManager.H2(["argumentAssistanceRender"]),this.formulaAssistanceTelemetryManager.TPb("argumentAssistanceOverall"))}gl(W,Ta){if(1872288872===Ta){if(this.visible)return this.vyc=!0;
this.vyc&&(this.formulaAssistanceTelemetryManager.nja("2ndEsc"),this.vyc=!1)}else this.vyc=!1;return!1}P_a(W){return this.visible&&1872288872===W?(this.formulaAssistanceTelemetryManager.nja("esc"),this.dismiss(),!0):!1}dispose(){this.J&&this.grid&&(this.grid.da&&this.grid.da.Ls(this.Fd),this.grid.view.Qs(this.Wt),this.grid.cellTextEditBox.rq(this.ng));ua.a.hb(this.Zz);this.J=null}Skk(W){switch(W.kind){case "Minimal":return this.Pkk(W);case "Full":return this.Kkk(W)}}Pkk(W){return{kind:"Minimal",functionRenderingInfo:W}}Kkk(W){const Ta=
{kind:"Full",isExpanded:!1,callbacks:null,functionRenderingInfo:null};Ta.functionRenderingInfo=W;Ta.isExpanded=this.isExpanded;this.Svk(Ta);return Ta}Svk(W){W.callbacks={onIsExpandedChange:null,onHelpLink:null,onFeedback:null,onDismissClick:null};W.callbacks.onHelpLink=this.IYi(W.functionRenderingInfo);W.callbacks.onIsExpandedChange=this.onIsExpandedChange;W.callbacks.onFeedback=this.lve;W.callbacks.onDismissClick=this.onDismissClick}IYi(W){return()=>{void yc.a.resolve(Mc.BAb).then(Ta=>Ta(W.helpID,
W.isUDF));this.formulaAssistanceTelemetryManager.nja("lm")}}fRk(){const W=ed.a.get(Ra.a.Jdf);W?this.isExpanded="false"!==W:(this.isExpanded=Ae.Pki,this.formulaAssistanceTelemetryManager.yOk());this.formulaAssistanceTelemetryManager.zOk(this.isExpanded)}khk(W){switch(W.kind){case "Minimal":this.mhk(W.functionRenderingInfo);break;case "Full":this.hhk(W)}}mhk(W){var Ta=W.functionName;if(this.a3a&&Ib.a.equals(this.a3a,Ta,!0)){Ta="";const ob=W.parameters.activeParam;0<=ob&&ob<W.parameters.params.length&&
(Ta=W.parameters.params[ob]);this.raiseEvent("FAParameterSelectionChanged",new ve([Ta]))}else this.a3a=Ta,W=W.parameters.params.join(", "),this.raiseEvent("FAFunctionNameUpdated",new Gd(Ta,[W]))}hhk(W){var Ta=W.functionRenderingInfo.functionName;this.a3a&&Ib.a.equals(this.a3a,Ta,!0)?(Ta=qd.a.map(W.functionRenderingInfo.signatures,ob=>{let K="";0<=ob.signatureParams.activeParam&&ob.signatureParams.activeParam<ob.signatureParams.params.length&&(K=ob.signatureParams.params[ob.signatureParams.activeParam]);
return K}),this.raiseEvent("FAParameterSelectionChanged",new ve(Ta))):(this.a3a=Ta,W=qd.a.map(W.functionRenderingInfo.signatures,ob=>ob.signatureParams.params.join(", ")),this.raiseEvent("FAFunctionNameUpdated",new Gd(Ta,W)))}Ikl(W){this.isExpanded=W;try{ed.a.PD(Ra.a.Jdf,W.toString(),ie.a.GBa)}catch(Ta){Ma.ULS.sendTraceTag(512267714,0,15,`Failed setting ArgumentAssistanceCardCollapseState cookie with error message: ${Ta.message}`)}}static MQd(){return document.createElement("div")}NDk(){const W=this.getPosition().renderDown?
"rd":"ru";this.formulaAssistanceTelemetryManager.nja(W)}zdl(){this.Zxd&&2===++this.bsi&&this.J.uc(953250532,-1,0,null)}}Ae.Pki=!0;(0,ya.a)(Ae,"FormulaArgumentAssistanceControl",Ha.a,[682]);var Hd=a(70197),Rd=a(37736);const Ge=[(0,Rd.d)("featureNameField","FormulaSmartSuggestions"),(0,Rd.d)("ver","1.0.0")],He={eventName:"Office.Excel.FormulaSmartSuggestions.Seen",eventFlags:Hd.a,dataFields:[...Ge,(0,Rd.a)("isFeatureSeen",!0)]},Wa={eventName:"Office.Excel.FormulaSmartSuggestions.Tried",eventFlags:Hd.a,
dataFields:[...Ge,(0,Rd.a)("isFeatureTried",!0)]},ac={eventName:"Office.Excel.FormulaSmartSuggestions.Succeeded",eventFlags:Hd.a,dataFields:[...Ge,(0,Rd.a)("isFeatureSucceeded",!0)]};var Fc=a(55212),ld;(function(W){W[W.Dismissed=0]="Dismissed";W[W.Smart=1]="Smart";W[W.Simple=2]="Simple";W[W.Mixed=3]="Mixed"})(ld||(ld={}));(0,ya.b)("UIState",ld);class Cd extends Ha.a{constructor(W,Ta,ob){super(Cd.MQd());this.J=W;this.formulaAssistanceUIControl=Ta;this.formulaAssistanceTelemetryManager=ob;this.kLa=
Hc.a.KLc();this.Zz=this.clearContentNotifier=this.ed=this.U=null;this.wyc=this.xyc=this.uyc=this.POb=this.QOb=this.yyc=this.ROb=!1;this.KN=null;this.y5=0;this.JBe=this.$3c=this.B8a=this.Wjc=this.gB=!1;this.Acc=ld.Dismissed;this.onRestoreFocus=()=>{};this.dismiss=()=>{this.gB=!1;this.zob&&this.B8a&&this.K1a&&(this.wyc=!0);this.JKj();this.Jea&&this.ed.isEditing&&this.JYc();this.formulaAssistanceUIControl&&(this.formulaAssistanceUIControl.dismiss(this.domElement),this.Zz.Ri=!1,this.Acc=ld.Dismissed)};
this.dcj=()=>{this.raiseEvent("FAFocusOnSmartSuggestionsCard",null)};this.Kya=()=>{const K=this.formulaAssistanceTelemetryManager.OL?.Gj;this.U.da.la.selectedRanges.some(ja=>ja.contains(K))&&this.formulaAssistanceTelemetryManager.v9d++};this.J4=(K,ja)=>{0==ja.Tq&&(170==ja.Wf.operation.operationName&&this.formulaAssistanceTelemetryManager.aPc++,this.J.Ba.kn(this.J4),this.KMc&&this.clearContentNotifier&&this.clearContentNotifier.P6b(this.Kya))};this.Bhe=(K,ja)=>{0==ja.Tq&&(12==ja.Wf.operation.operationName&&
this.J.Ba.Up(this.J4),this.J.Ba.kn(this.Bhe))};this.h2j=()=>{this.dismiss();this.U.vj.Ya.focus()};this.lve=()=>{const K={};K[Ra.a.CG]=this.bCg?"SmartSuggestionsCard":this.KBe?"FunctionAndSmartSuggestionsCard":"SimpleAutoCompleteCard";this.J.uc(802602464,0,8,K)};this.ng=()=>{this.K1a&&this.kPh()};this.M0j=(K,ja)=>{this.zzb(ja);this.yyc=!0};this.Fd=()=>{this.visible=!1};this.L0j=K=>{this.uyc=!0;this.kEd(K)};this.Ji=()=>{this.dismiss()};this.Wt=()=>{this.formulaAssistanceUIControl.updatePosition(ze.lRa.AutoCompleteMenu)};
this.U=Ga.f(this.J);this.Zz=new Wb(this.J,this.formulaAssistanceUIControl,ze.lRa.AutoCompleteMenu,Ee.a.wKf,this.dcj);this.U.view.jt(this.Wt);this.U.da.es(this.Fd);this.J.ma.Kg(this.Ji);this.K1a=Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:5523443_FormulaSuggestionsCardUserInteractionTelemetry");this.zob=Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:6650011_LogSuggestionsDismissal");this.KMc=Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:7629619_RefiningKeptTelemetry");!this.kLa&&this.KMc&&(Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:9011101_RemoveServiceNameClearContentNotifier")?
void yc.a.Tc(Mc.gqa).then(K=>{this.clearContentNotifier=K}):this.J.za.Hd(313,K=>{this.clearContentNotifier=K}));this.K1a&&this.U.cellTextEditBox.fr(this.ng)}pLh(W){this.addHandler("FACardOpened",W)}qzk(W){this.removeHandler("FACardOpened",W)}lLh(W){this.addHandler("FAFocusOnSmartSuggestionsCard",W)}mzk(W){this.removeHandler("FAFocusOnSmartSuggestionsCard",W)}oLh(W){this.addHandler("FormulaAutoCompleteShown",W)}pzk(W){this.removeHandler("FormulaAutoCompleteShown",W)}tNh(W){this.addHandler("SelectedRowChanged",
W)}hBk(W){this.removeHandler("SelectedRowChanged",W)}Rvd(W){this.addHandler("ListBoxUpdated",W)}sqe(W){this.removeHandler("ListBoxUpdated",W)}dispose(){this.J&&(this.J.Ba.kn(this.J4),this.J.Ba.kn(this.Bhe),this.U&&(this.U.da&&this.U.da.Ls(this.Fd),this.U.cellTextEditBox&&this.K1a&&this.U.cellTextEditBox.rq(this.ng),this.U.view.Qs(this.Wt)),this.J.ma&&this.J.ma.Pg(this.Ji));this.KMc&&this.clearContentNotifier&&this.clearContentNotifier.P6b(this.Kya);ua.a.hb(this.Zz);this.J=null}DKh(W){this.addHandler("CVIC",
W)}Kyk(W){this.removeHandler("CVIC",W)}get visible(){return this.gB}set visible(W){W||this.dismiss();this.gB=W}get Jea(){return this.Wjc}get KBe(){return this.KN?.items[0]?.type===Fc.mqa.Smart}get bCg(){return 1===this.KN.items.length&&this.KBe}gl(W,Ta){if(!this.visible)return!1;this.hHe(Ta);let ob;return(ob=this.wej(Ta)).handled?ob.result:this.XXk(Ta)}P_a(W){if(!this.visible)return!1;let Ta=!1;switch(W){case 1872288872:this.Jea&&this.JYc();this.zob&&this.KBe&&(this.formulaAssistanceTelemetryManager.H2(["autoCompleteSmartSuggestionActiveDismissing"]),
this.xyc=!0);this.visible=!1;Ta=!0;break;case -798660877:this.zzb(this.XTb(this.y5+1));Ta=!0;break;case 137938150:this.zzb(this.XTb(this.y5-1));Ta=!0;break;case 2091832999:this.zzb(this.XTb(this.y5+8));Ta=!0;break;case 742457698:this.zzb(this.XTb(this.y5-8));Ta=!0;break;case 125627505:case 267796030:this.kEd(this.KN.items[this.y5]),Ta=!0}return Ta}show(W){this.ed=this.U.vj;this.gB=!0;this.y5=0;this.KN=W;0<this.KN.items.length&&(this.render(),this.zzb(this.XTb(this.y5)),this.zob?this.K1a&&(this.KN.items[0].type===
Fc.mqa.Smart?(this.B8a||this.formulaAssistanceTelemetryManager.FPa(["autoCompleteSmartSuggestionActiveDismissing","autoCompleteSmartSuggestionAccepted"]),this.B8a=!0):this.B8a&&(this.wyc=!0)):this.KN.items[0].type===Fc.mqa.Smart&&this.K1a&&(this.B8a=!0));this.formulaAssistanceTelemetryManager.aDk(W.items)}JYc(){this.Wjc=!1;this.ed.zJd()}XXk(W){return[1872288872,-798660877,137938150,2091832999,742457698,125627505,267796030].includes(W)}wej(W){return this.Jea?125627505===W||267796030===W?(this.kEd(this.KN.items[this.y5]),
{handled:!0,result:!1}):!this.bCg||-798660877!==W&&137938150!==W?{handled:!1}:{handled:!0,result:!1}:{handled:!1}}render(){this.formulaAssistanceTelemetryManager.FPa(["autoCompleteRender"]);this.formulaAssistanceUIControl&&(this.formulaAssistanceUIControl.renderAutoCompleteMenu(this.domElement,this.KXi(),()=>r(this.J)),this.bpk(),this.Zz.Ri=!0,this.Sti())}Sti(){this.formulaAssistanceTelemetryManager.H2(["autoCompleteRender"]);this.formulaAssistanceTelemetryManager.TPb("autoCompleteOverall");const W=
this.KN.items.some(ob=>ob.type===Fc.mqa.Smart),Ta=this.KN.items.some(ob=>ob.type===Fc.mqa.Simple);W&&Ta?this.formulaAssistanceTelemetryManager.TPb("autoCompleteOverallSimpleAndSmart"):W?this.formulaAssistanceTelemetryManager.TPb("autoCompleteOverallSmartOnly"):Ta&&this.formulaAssistanceTelemetryManager.TPb("autoCompleteOverallSimpleOnly")}bpk(){const W=this.Acc;this.Acc=this.O9i(this.KN.items);W!==ld.Dismissed&&W!==ld.Smart||this.Acc!==ld.Simple&&this.Acc!==ld.Mixed||this.raiseEvent("FormulaAutoCompleteShown")}Qpk(){if(0!==
this.KN.items.length){var W=0<=this.y5?this.y5:0,Ta=this.KN.items[W];this.raiseEvent("SelectedRowChanged",{wM:Ta.label,description:Ta.detail??"",selectedIndex:W+1,length:this.KN.items.length})}}kEd(W){if(this.ed&&this.visible){var Ta=W.textEdit;this.Wpj(this.ed.text,Ta);this.ed.Ya.caretPosition=Ta.range.start.character+Ta.newText.length;Ya.EwaSettings.suj()&&this.ed.mve();this.Jea&&(this.Wjc=!1,this.K1a&&(this.zob&&this.formulaAssistanceTelemetryManager.H2(["autoCompleteSmartSuggestionAccepted"]),
this.JBe=this.$3c=!0),this.kLa||this.IYg(),this.U.EHa.iOk(),this.ed.endEdit(!0,"FormulaAutoCompleteControl.CommitAutoCompletion",0),this.kLa&&this.IYg());this.visible=!1;this.raiseEvent("CVIC",{shouldRequestAutocompleteOnCommit:W.shouldRequestAutocompleteOnCommit});this.formulaAssistanceTelemetryManager.$Ck(W.kind)}}IYg(){const W={Gj:this.U.da.la.activeCell,cellText:this.U.Jb.text,committed:!0,uHa:null};this.kLa?this.formulaAssistanceTelemetryManager.wRk(W):(this.formulaAssistanceTelemetryManager.OL=
W,this.formulaAssistanceTelemetryManager.u9d=this.J.ma.ja.sheetId,this.formulaAssistanceTelemetryManager.$Oc=this.J.Z.Ee,this.J.Ba.Up(this.Bhe),this.KMc&&this.clearContentNotifier&&this.clearContentNotifier.MIb(this.Kya))}kPh(){this.zob&&this.wyc&&!this.xyc&&!this.$3c&&(this.formulaAssistanceTelemetryManager.kta.dismissSmartSuggestionImplicitlyCounter++,this.wyc=!1);this.B8a&&(this.formulaAssistanceTelemetryManager.BR.smartSuggestionShownCounter++,this.B8a=!1,(0,Hd.c)(He));this.$3c&&(this.formulaAssistanceTelemetryManager.BR.smartSuggestionSelectedCounter++,
this.$3c=!1,(0,Hd.c)(Wa));this.JBe&&(this.formulaAssistanceTelemetryManager.BR.smartSuggestionCommittedCounter++,this.JBe=!1)}KXi(){const W={completionItems:this.KN.items,activeItemIndex:this.y5,callbacks:null};this.avk(W);return W}avk(W){W.callbacks={onCompletionItemSelected:null,onCompletionItemCommitted:null,onFeedback:null,onDismiss:null,onRestoreFocus:null};W.callbacks.onCompletionItemSelected=this.M0j;W.callbacks.onCompletionItemCommitted=this.L0j;W.callbacks.onFeedback=this.lve;W.callbacks.onDismiss=
this.h2j;W.callbacks.onRestoreFocus=this.onRestoreFocus}Dlk(W){this.Wjc=!0;const Ta=W.textEdit.newText;this.ed.P5(Ta.substring(this.ed.text.length-W.textEdit.range.start.character,Ta.length))}zzb(W){const Ta=this.y5;this.y5=W;const ob=this.KN.items[W];this.Jea&&this.JYc();Ta!==W&&this.render();ob.type!==Fc.mqa.Smart||this.U.vj.text.includes("\n")||this.Dlk(ob);this.Qpk()}XTb(W){return 0>W?0:Math.min(W,this.KN.items.length-1)}Wpj(W,Ta){this.ed.text=W.substring(0,Ta.range.start.character)+Ta.newText+
W.substring(Ta.range.end.character,W.length);this.U.Qv&&(this.U.Jb.text=this.ed.text)}JKj(){this.ROb&&(this.formulaAssistanceTelemetryManager.kta.selectByArrowKeyCounter++,this.ROb=!1);this.yyc&&(this.formulaAssistanceTelemetryManager.kta.selectByMouseHoverCounter++,this.yyc=!1);this.QOb&&(this.formulaAssistanceTelemetryManager.kta.commitByTabKeyCounter++,this.QOb=!1);this.POb&&(this.formulaAssistanceTelemetryManager.kta.commitByEnterKeyCounter++,this.POb=!1);this.uyc&&(this.formulaAssistanceTelemetryManager.kta.commitByMouseClickCounter++,
this.uyc=!1);this.zob&&this.xyc&&(this.formulaAssistanceTelemetryManager.kta.dismissSmartSuggestionExplicitlyCounter++,this.xyc=!1)}hHe(W){switch(W){case -798660877:case 137938150:case 2091832999:case 742457698:this.ROb=!0;break;case 125627505:this.QOb=!0;break;case 267796030:this.POb=!0}}static MQd(){return document.createElement("div")}O9i(W){return W.reduce((Ta,ob)=>Ta|=ob.type===Fc.mqa.Simple?ld.Simple:ld.Smart,ld.Dismissed)}}(0,ya.a)(Cd,"FormulaAutoCompleteControl",Ha.a,[683,2,684]);var vd=a(17720),
Td=a(46498),ud=a(68354);class Ne{constructor(W,Ta){this.yp=W;this.J=Ta;this.u5c=new Map;this.eyb=null;this.U2b=()=>{this.HBc.resolve(this.yp.vs);this.Bbh()};this.nug=()=>{this.HBc.reject(null);this.Bbh()};this.ng=()=>{this.yp.c_c();this.F8d=null;this.u5c.clear();this.f7e()};this.K5j=(ob,K)=>{if(K!==this.Seg)Ma.ULS.sendTraceTag(509678923,0,15,"onGetTableColHeadersSuccess called with a tableName different than the one saved for last request"),this.PPa.reject();else if((0,ud.a)(ob))this.PPa.reject();
else{var ja=ob.Result;(0,vd.b)(ja)&&0!==ja.length?(this.u5c.set(K,ja),void this.PPa.resolve(ob.Result)):this.PPa.reject()}};this.J5j=()=>{this.PPa.reject()};Ga.f(this.J)?.cellTextEditBox?.fr(this.ng);this.i4k=Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:6476169_skipGetFieldInfoListContextIfContextLoaded")}getRichValueFieldListContext(W,Ta,ob,K){const ja={Uja:W,Zwf:Ta};var ub;if(ub=(0,vd.b)(this.F8d))ub=this.F8d,ub=!(ja.Uja.firstRow===ub.Uja.firstRow&&ja.Uja.firstColumn===ub.Uja.firstColumn&&ja.Uja.lastRow===
ub.Uja.lastRow&&ja.Uja.lastColumn===ub.Uja.lastColumn&&ja.Uja.sheetName===ub.Uja.sheetName&&ja.Zwf===ub.Zwf);ub&&this.yp.c_c();this.F8d=ja;this.i4k&&this.yp.$2d||this.yp.Alb((0,Sb.n1f)(W),ob,K,Ta);this.HBc=new vd.a;this.yp.$2d?this.HBc.resolve(this.yp.vs):this.nuk();return this.HBc.promise}getTableColHeaders(W){if(this.eyb&&3>=this.eyb.status&&W===this.Seg)return this.PPa.promise;this.PPa=new vd.a;if(this.u5c.has(W))this.PPa.resolve(this.u5c.get(W));else{this.f7e();this.Seg=W;const Ta=this.J.nc.getItemByName(W).ol;
this.eyb=(0,Td.v)(this.J.ia.oa,Ta,ob=>this.K5j(ob,W),this.J5j,null,null)}return this.PPa.promise}dispose(){Ga.f(this.J)?.cellTextEditBox?.rq(this.ng)}nuk(){this.yp.Gvd(this.U2b);this.yp.sLh(this.nug)}Bbh(){this.yp.gqe(this.U2b);this.yp.tzk(this.nug)}f7e(){(0,vd.b)(this.eyb)&&(wc.AFrameworkApplication.oc.py(this.eyb.Lx),this.eyb=null)}}(0,ya.a)(Ne,"ServerDataProvider",null,[]);var af=a(94735),Df=a(77935);a(30508);var jf=a(21103);class rf{constructor(W){this.xli={};this.J=W}get wli(){const W=[];if(!this.J.nc||
!this.J.nc.items)return W;let Ta=0;for(const ob of this.J.nc.items)if(ob&&(3===ob.type&&ob.usedRange||2===ob.type)){const K={tooltip:ob.sheetName+af.a.exclamation+ob.usedRange.toString(),name:ob.name,namedRange:this.mai(ob.usedRange),sheetName:ob.sheetName,type:this.$$h(ob.type)};W.push(K);this.xli[ob.name.toUpperCase()]=K;++Ta;if(!Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:7395300_FixTableAutoCompleteMissingInfo")&&Ta===Df.a.Zlg){Ma.ULS.sendTraceTag(537162076,0,15,`Maximum number of defined names reached for formula assistance: ${Df.a.Zlg}`);
break}}return W}mai(W){if(null!=W&&void 0!=W)return{top:W.top,left:W.left,bottom:W.bottom,right:W.right,maxRows:W.maxRows,maxColumns:W.maxColumns,sheetName:void 0}}$$h(W){switch(W){case 2:return Fc.iRa.Table;case 3:return Fc.iRa.NamedRange;default:return Fc.iRa.Invalid}}}(0,ya.a)(rf,"DefinedNameInfoManager",null,[]);var Zf=a(75071),pf=a(96555),Cf=a(31538),If=a(44614),gf=a(97795);const Pf={index:0,length:0};class lf{constructor(W){this.Rwa=this.Swa=this.kma=this.lma=!1;this.k2a=W}}(0,ya.a)(lf,"MarqueeRangeData",
null,[]);class sc{constructor(W,Ta,ob,K=!1){this.G$k=W;this.Z8g=Ta;this.EMc=K;ob?(this.k2a=ob.k2a,this.lma=ob.lma,this.kma=ob.kma,this.Swa=ob.Swa,this.Rwa=ob.Rwa):Ma.ULS.shipAssertTag(510255180,0,!1,"MarqueeMetadata.Ctor: rangeData is null")}}(0,ya.a)(sc,"MarqueeMetadata",null,[]);a(71411);const ad=Hc.a.Hs()?"rgba(0, 108, 190, {0});rgba(188, 47, 50, {0});rgba(124, 83, 172, {0});rgba(15, 112, 15, {0});rgba(191, 0, 119, {0});rgba(181, 73, 15, {0});rgba(0, 117, 143, {0})".split(";"):"rgba(95, 140, 237, {0});rgba(235, 94, 96, {0});rgba(141, 97, 194, {0});rgba(45, 150, 57, {0});rgba(191, 76, 145, {0});rgba(227, 130, 34, {0});rgba(55, 127, 158, {0})".split(";"),
zd=ad.map(W=>String.format(W,1));class Ce{constructor(W,Ta,ob,K){this.J=W;this.pluginScheduler=Ta;this.vB=ob;this.formulaAssistanceTelemetryManager=K;this.y0a=this.I7g=!1;this.vP=null;this.wna=()=>{this.y0a=!1;this.vP=null};this.U=Ga.f(W);this.U.Jb.fr(this.wna)}hX(W,Ta,ob){W.Ya.addEventLogRecord("FormulaHighlightsControl.TryUpdateFormulaHighlights");if(this.I7g||W.Jea)return!1;const K=isNullOrUndefined(Ta)?W.text:Ta;if(!Ac.f(K))return this.Aeh((0,vd.b)(Ta));ob=this.a$i(W,Ta,ob);ob=this.lTd(K,ob)?.formulaHighlights;
if(!ob)return Ma.ULS.sendTraceTag(512349465,0,50,"FormulaHighlightsControl.tryUpdateFormulaHighlights: formulaHighlights is null (might be an invalid formula)"),this.Aeh((0,vd.b)(Ta));const {U5c:ja,yJg:ub,wJg:Cb,rQj:Jc}=this.EQf(ob,K);this.OTk(W,ja,!!Ta);Ta=W.Ya.text;if(!Ib.a.equals(Ta,K,!1))return Ma.ULS.shipAssertTag(38114182,0,!1,`FormulaHighlightsControl.tryUpdateFormulaHighlights: The text we created is different from the original text. Setting the original text back. currentTextLength [${Ta.length}], updatedTextLength [${K.length}]`),
Ta=W.Ya.caretPosition,W.Ya.text=K,W.Ya.caretPosition=Ta,!0;this.highlightRanges(ub,Cb,3,Jc);return this.y0a=!0}bng(W,Ta,ob){if(!W||!Ta||!ob)return Ma.ULS.shipAssertTag(512349463,0,!!W,"FormulaHighlightsControl.MoveMarqueeRange: cellContentEditor is null"),Ma.ULS.shipAssertTag(512349462,0,!!Ta,"FormulaHighlightsControl.MoveMarqueeRange: highlightState is null"),Ma.ULS.shipAssertTag(512349461,0,!!ob,"FormulaHighlightsControl.MoveMarqueeRange: newRange is null"),!1;const K=(0,pf.a)(sc,Ta.metadata);if(!K)return Ma.ULS.shipAssertTag(512349460,
0,!1,"FormulaHighlightsControl.MoveMarqueeRange: marqueeMetadata is null"),!1;var ja=K.G$k,ub=K.Z8g;let Cb=this.U.ub.K6f(ob)?ob.pEc(K.kma,K.lma):ob.mea(K.kma,K.lma,K.Rwa,K.Swa);if(!Cb)return Ma.ULS.shipAssertTag(512349459,0,!1,"FormulaHighlightsControl.MoveMarqueeRange: newText is null"),!1;const Jc=ub.indexOf("!");-1!==Jc&&(Cb=ub.substring(0,Jc+1)+Cb);if(!W.Ya.changeTextInExistingTextPart(ja,ub,Cb))return Ma.ULS.shipAssertTag(38926105,0,!1,"FormulaHighlightsControl.MoveMarqueeRange: failed to change the text part"),
!1;K.Z8g=Cb;ja=!0;ub=this.U.fb.C9c;for(const cd of ub)(ub=Ga.f(this.J).Gb.JR(3,cd,Ta.eka))?(ub.range=ob,ub.metadata=K):(Ma.ULS.shipAssertTag(512349458,0,!1,"FormulaHighlightsControl.MoveMarqueeRange: highlightStateInPane is null"),ja=!1);this.U.Gb.update(!1,!1);this.U.Qv&&(this.U.cellTextEditBox.Ya.text=W.text);this.U.cellTextEditBox.F5b(new Cf.a({wKc:!0}));return ja}gzj(W){if(3!==W.Gq)return Ma.ULS.shipAssertTag(512349457,0,!1,"FormulaHighlightsControl.IsMarqueeHighlightDraggable: not HighlightDivIndex.Marquee."),
!1;W=(0,pf.a)(sc,W.metadata);return W?W.k2a&&!W.EMc:(Ma.ULS.shipAssertTag(512349456,0,!1,"FormulaHighlightsControl.IsMarqueeHighlightDraggable: marqueeMetadata is null."),!1)}dyb(W,Ta){Ma.ULS.sendTraceTag(512349455,0,50,"FormulaHighlightsControl.suspendResumeFormulaHighlights: "+(Ta?"suspending":"resuming")+" formula highlights");Ta&&this.y0a&&(this.y0a=!1,this.highlightRanges(null,null),W.Ya.d5h());this.I7g=Ta}dispose(){this.U&&this.U.Jb&&this.U.Jb.rq(this.wna)}y0f(W){this.formulaAssistanceTelemetryManager.FPa(["highlightPreviewRanges"]);
var Ta=this.lTd(W,Pf);if(isNullOrUndefined(Ta))this.NJc&&this.highlightRanges(null,null);else{var ob=this.SUd(),K=[],ja=new xc.a(!1),ub=[];Ta=Ta.formulaHighlights;for(const Cb of Ta)if(Ta=Cb.kind,Ta===Fc.Mha.CellRef||Ta===Fc.Mha.NamedRange||Ta===Fc.Mha.StructRef)Ta=Sb.E(Cb.rangeInfo.range),(0,vd.b)(Ta)&&(K.push(new gf.a(Ta,ob)),this.RDc(Ta,ja,1),ub.push(new sc(Cb.span.start,W.substring(Cb.span.start,Cb.span.end),y(Cb),!0)));this.highlightRanges(K,ja,3,ub);this.formulaAssistanceTelemetryManager.H2(["highlightPreviewRanges"],
!0)}}S8i(W,Ta=[]){const ob=this.lTd(W,Pf)?.formulaHighlights.filter(Cb=>!Ta.includes(Cb.kind));if(!ob)return null;const {U5c:K,yJg:ja,wJg:ub}=this.EQf(ob,W);return{U5c:K,highlightRanges:Cb=>Cb?this.highlightRanges(ja,ub,28):this.e5h()}}e5h(){this.highlightRanges(null,null,28)}Ckl(W,Ta){W&&this.formulaAssistanceTelemetryManager.eQd.formulaHighlightsCounter++;Ta&&this.formulaAssistanceTelemetryManager.eQd.parenthesesCouplingCounter++}Aeh(W){this.y0a&&this.highlightRanges(null,null);return this.y0a&&
(this.y0a=!1,W)?!0:!1}a$i(W,Ta,ob){let K=ob;(0,vd.b)(Ta)?(0,vd.b)(ob)||(K={index:Ta.length,length:0}):K=W.Ya.selection;return K}lTd(W,Ta){if(this.TBj({content:W,selection:Ta}))return this.vP.result;this.formulaAssistanceTelemetryManager.FPa(["formulaHighlightsRequest"]);const ob=this.pluginScheduler.syncRequester().formulaHighlighting({content:W,caretPosition:Ta.index,selectionLength:Ta.length},this.vB.B5a,null);this.vP={content:W,selection:Ta,result:ob};this.formulaAssistanceTelemetryManager.H2(["formulaHighlightsRequest"]);
return ob}RDc(W,Ta,ob){let K=Ta.getItem(W.toString());K||(K=ad[Ta.count%ad.length],Ta.add(W.toString(),K));return String.format(K,ob)}GIb(W,Ta,ob,K,ja=null,ub=null){Ma.ULS.shipAssertTag(512349453,0,ob<=K,"FormulaHighlightsControl.AddTextPart: startIndex cannot be larger than endIndex");ob<K&&(Ta=Ta.substring(ob,K),ob=Hc.a.Hs()&&ja?(zd.indexOf(ja)+1).toString():null,W.push((0,Zf.a)(new If.a,{text:Ta,color:ja,backgroundColor:ub,highlightClass:ob})))}highlightRanges(W,Ta,ob=3,K=null){Ma.ULS.shipAssertTag(508350945,
0,3===ob||null===K,"FormulaHighlightsControl.HighlightRanges: marqueeMetadatas param was passed although the divIndex isn't maquee");const ja=3===ob&&(0,vd.b)(K);W&&W.length?(Ma.ULS.sendTraceTag(512349452,0,50,"FormulaHighlightsControl.HighlightRanges: number of ranges to highlight: "+W.length),W.reverse(),ja&&K.reverse(),this.U.Gb.wH(W,[ob],!0,(ub,Cb)=>{if(ub&&ub.range&&Cb){Ma.ULS.shipAssertTag(512349448,0,Ta.qb(ub.range.toString()),`FormulaHighlightsControl.HighlightRanges: The range '${ub.range.toString()}' doesn't exist in the range to color dictionary`);
var Jc=this.RDc(ub.range,Ta,.1),cd=this.RDc(ub.range,Ta,1);this.J.frame&&this.J.frame.jD&&this.J.frame.jD.cS||(Cb.style.background=Jc);Cb.style.borderColor=cd;ja&&(Cb.setAttribute(Ra.a.PVb,ub.eka.toString()),ub.metadata=K[ub.eka])}else Ma.ULS.shipAssertTag(512349451,0,!!ub,"FormulaHighlightsControl.HighlightRanges: state is null"),Ma.ULS.shipAssertTag(512349450,0,!!ub.range,"FormulaHighlightsControl.HighlightRanges: state.Range is null"),Ma.ULS.shipAssertTag(512349449,0,!!Cb,"FormulaHighlightsControl.HighlightRanges: div is null")})):
0!==this.U.Gb.wDc([ob]).length&&(W=this.J.Lb.Hc("UserAction","HideRangesHighlightsStopwatch"),this.U.Gb.Xk([ob]),this.U.Gb.Iwb(new gf.a(null,this.SUd()),[ob]),W.stop())}OTk(W,Ta,ob){const K=W.Ya;K.$I=!0;var ja=K.selection;const ub=ja.index;ja=ub+ja.length;K.setTextFromTextParts(Ta);Ta=K.text.length;K.selectRange(Math.min(ub,Ta),Math.min(ja,Ta));ob&&W.F5b(new Cf.a);K.$I=!1}i2i(){return this.U.gx&&this.U.gx.AS?this.U.gx.AS:this.J.ja}SUd(){return this.i2i().sheetId}EQf(W,Ta){const ob=[],K=new xc.a(!1),
ja=[],ub=[],Cb=[];let Jc=!1;var cd=!1;let Kd=0;const ne=this.SUd();for(const Ve of W){this.GIb(ja,Ta,Kd,Ve.span.start);switch(Ve.kind){case Fc.Mha.CellRef:case Fc.Mha.StructRef:case Fc.Mha.NamedRange:W=Sb.E(Ve.rangeInfo.range);if(isNullOrUndefined(W)){Ma.ULS.sendTraceTag(512349464,0,10,`FormulaHighlightsControl.tryUpdateFormulaHighlights: Received formula highlight with undefined range, HighlightKind:${Ve.kind.toString()}`);this.GIb(ja,Ta,Ve.span.start,Ve.span.end);break}cd=this.RDc(W,K,1);this.GIb(ja,
Ta,Ve.span.start,Ve.span.end,cd,null);ob.push(new gf.a(W,ne));ub.push({Start:Ve.span.start,End:Ve.span.end});cd=ja.length-1;Cb.push(new sc(cd,ja[cd].text,y(Ve)));cd=!0;break;case Fc.Mha.Parentheses:this.GIb(ja,Ta,Ve.span.start,Ve.span.end,null,"rgb(229, 229, 229)"),Jc=!0}Kd=Ve.span.end}this.GIb(ja,Ta,Kd,Ta.length);this.Ckl(cd,Jc);return{U5c:ja,yJg:ob,wJg:K,rQj:Cb}}TBj(W){return(0,vd.b)(this.vP)&&this.vP.content===W.content&&this.vP.selection.index===W.selection.index&&this.vP.selection.length===W.selection.length}}
(0,ya.a)(Ce,"FormulaHighlightsControl",null,[685,2]);var Fe=a(83323),Ie=a(93156),Ca=a(31728);(0,yc.b)(Mc.LH,{Sd:"singleton"})(async W=>{var Ta=await yc.a.resolve(Mc.ra,W);const ob=await yc.a.resolve(Mc.ql,W),K=await yc.a.resolve(Mc.gp,W);var ja=W?.ua??0;const ub=await (Mc.t6.tb()?yc.a.resolve(Mc.t6,W):(0,Fe.e)(Ie.GetServiceTaskFactory.create(Ta.za,449,Ta.Ma,ja))),Cb=await yc.a.resolve(Ca.c,W),Jc=await yc.a.resolve(Mc.Rl,W);ja=await yc.a.resolve(Mc.Xec,W);const cd=await yc.a.resolve(Mc.z0,W),Kd=await yc.a.resolve(Mc.pX,
W);W=Ya.EwaSettings.iLc()?await yc.a.resolve(Mc.iCa,W):null;Ta=new Jb(Ta,Kd,Jc,Cb,ub,cd,K.vqf(Ta,ob),W);ja.ZSh(Ta.RCc);ja.$Sh(Ta.tva);ja.aTh(Ta.tva);return Ta});class Jb{constructor(W,Ta,ob,K,ja,ub,Cb,Jc){this.J=W;this.yB=Ta;this.Wd=ob;this.pluginScheduler=K;this.formulaAssistanceUIControl=ja;this.formulaAssistanceTelemetryManager=ub;this.yp=Cb;this.Iy=Jc;this.K1d=this.isCellContentOnlyEqualDuringEdit=!1;this.E_b=null;this.JOc=-1;this.Rna=0;this.Iob=!1;this.Yc=(cd,Kd)=>{Kd.dg||Kd.bob||this.pluginScheduler.notifier().notifyWorkbookClosing()};
this.onActiveCellChanged=(cd,Kd)=>{this.U.isEditing||this.U.dk||this.Uog(Kd?.cell)};this.onFunctionInfoLoaded=()=>{this.Leh();this.xoa()};this.R1j=()=>{this.qHe();this.xoa()};this.Jqg=(cd,Kd)=>{var ne=this.ed;cd=ne.text;ne=ne.Ya.caretPosition;0<this.Rna&&this.formulaAssistanceTelemetryManager.kta.commitWhileRequestPending++;this.formulaAssistanceTelemetryManager.FPa(["argumentAssistanceComputation","argumentAssistanceOverall"]);Kd.shouldRequestAutocompleteOnCommit?this.YVg(cd,ne):this.$Dk(cd,ne)};
this.ng=()=>{this.isCellContentOnlyEqualDuringEdit&&(this.formulaAssistanceTelemetryManager.BR.isCellContentOnlyEqualDuringEditCounter++,this.isCellContentOnlyEqualDuringEdit=!1);this.K1d&&(this.formulaAssistanceTelemetryManager.BR.isCellContentFormulaCounter++,this.K1d=!1);Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:6103891_dismissControlOnEditEnded")&&this.uJd()};this.xMa=(cd,Kd)=>{(0,Od.d)(()=>{this.eIk(Kd.newValue)})};this.Kj=()=>{this.qHe()};this.qHe=()=>{const cd=this.Iob?this.JUi():this.vli.wli;
this.pluginScheduler.notifier().setDefinedNamesInfo(cd);Ma.ULS.sendTraceTag(512278605,0,50,`FormulaAssistanceManager.updateDefinedNamesList updated defined names info with ${cd?.length} names}`)};this.kqg=(cd,Kd)=>{this.pluginScheduler.notifier().setActiveCellFormat(Kd)};this.yB=Ta;this.formulaAssistanceUIControl=ja;this.pluginScheduler=K;this.U=Ga.f(this.J);this.Iob=Ya.EwaSettings.iLc()&&(0,vd.b)(this.Iy);this.vli=new rf(W);this.Iob?this.Iy.iaf(this.R1j):this.U.va.ht(this.Kj);this.qHe();this.Kbb=
new Ae(this.J,this.formulaAssistanceUIControl,this.formulaAssistanceTelemetryManager);this.wia=new Cd(this.J,this.formulaAssistanceUIControl,this.formulaAssistanceTelemetryManager);this.d5k=Hc.a.nob(W);this.Bsj=Ya.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.AuthoringPerCharExp",!1);this.pDj=Ya.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.x10AutocompleteWrapperPluginIsEnabled",!1);this.Nbb=new Ce(this.J,this.pluginScheduler,this,this.formulaAssistanceTelemetryManager);this.Wd=
ob;this.moj();this.U.cellTextEditBox.fr(this.ng);this.yB.cqc(this.onFunctionInfoLoaded);this.yB.uma?this.Leh():this.yB.tjb({})}get tva(){return this.wia}get RCc(){return this.Kbb}get wB(){return this.Nbb}get B5a(){return this.ed.jBj?Fc.Nha.Python:Fc.Nha.Excel}get ed(){return this.U.vj}get ub(){return this.U.ub}dispose(){if(this.J){const W=this.U;W&&(W.da&&W.da.Oza(this.onActiveCellChanged),!this.Iob&&W.va&&W.va.Ir(this.Kj));this.J.Xo(this.Yc)}this.Wd?.dyk(this.kqg);this.U.cellTextEditBox.rq(this.ng);
this.wia.Kyk(this.Jqg);this.yB&&this.yB.iqe(this.onFunctionInfoLoaded);this.ed&&this.ed.XYc(this.xMa);ua.a.hb(this.Kbb);ua.a.hb(this.wia);this.wia=this.Kbb=this.yB=this.J=null}GEk(){this.JOc=-1;this.E_b=null}uJd(){this.wia.visible=!1;this.Kbb.visible=!1}gl(){this.xoa();return!1}xoa(){if(this.U.isEditing&&!this.ed.rW)if(this.formulaAssistanceTelemetryManager.$yd.formulaAssistanceRequestAttemptedCounter++,this.NYk()){var W=this.ed,Ta=W.text;W=W.Ya.caretPosition;Ta.startsWith("=")&&(this.K1d=!0,1===
Ta.length&&(this.isCellContentOnlyEqualDuringEdit=!0));this.formulaAssistanceTelemetryManager.FPa("argumentAssistanceComputation autoCompleteComputation autoCompleteComputationNoResult argumentAssistanceOverall autoCompleteOverall autoCompleteOverallSmartOnly autoCompleteOverallSimpleOnly autoCompleteOverallSimpleAndSmart".split(" "));this.YVg(Ta,W);this.Bsj&&this.mEk(Ta,W)}else this.formulaAssistanceTelemetryManager.$yd.formulaAssistanceRequestOptimizedCounter++}YVg(W,Ta){const ob=this.pluginScheduler.batchRequester().functionSuggestionAndArgumentAssistance({functionSuggestion:{content:W,
caretPosition:Ta},argumentAssistance:{content:W,caretPosition:Ta},inCellSuggestion:{content:W,caretPosition:Ta}},this.B5a,null);this.Rna+=1;this.E_b=W;this.JOc=Ta;ob.then(K=>{--this.Rna;"Done"===K.kind&&(this.GXf(K.payload.argumentAssistance),this.hdj(K.payload.functionSuggestion,W));return null})}mEk(W,Ta){Ta={content:W,caretPosition:Ta,enableAutocompleteWrapperPlugin:this.pDj&&!this.d5k};Ta=this.pluginScheduler.requester().runPerCharacterExperiment(Ta,this.B5a,null);this.Rna+=1;Ta.then(ob=>{--this.Rna;
if("Done"===ob.kind)for(const K of ob.payload.results)K.kind===Fc.sLe.AutocompleteWrapperPluginResult&&this.U.EHa.HYg(K.value,W);return null})}$Dk(W,Ta){const ob={content:W,caretPosition:Ta};this.E_b=W;this.JOc=Ta;W=this.pluginScheduler.requester().argumentAssistance(ob,this.B5a,null);this.Rna+=1;W.then(K=>{--this.Rna;"Done"===K.kind&&this.GXf(K.payload)})}NYk(){var W=this.ed;const Ta=W.text;W=W.Ya.caretPosition;return this.wia.visible&&Ib.a.equals(Ta,this.E_b,!0)&&!Ac.d(Ta)&&W===this.JOc?!1:!0}lIk(){void this.pluginScheduler.requester().runExperiment({},
this.B5a,null)}GXf(W){W&&this.ed.isEditing?(this.formulaAssistanceTelemetryManager.H2(["argumentAssistanceComputation"]),this.Kbb.show(W)):this.Kbb.dismiss()}hdj(W,Ta){W&&0<W.items.length&&this.ed.isEditing&&this.ed.text===this.E_b?this.ub.AV(this.U.da.la.activeCell)?(this.formulaAssistanceTelemetryManager.BR.smartSuggestionWouldSuggestInsidePivotCounter++,this.wia.dismiss()):(this.formulaAssistanceTelemetryManager.H2(["autoCompleteComputation"]),this.wia.show(W)):this.wia.dismiss();this.U.EHa.HYg(W,
Ta);W&&0!==W.items.length||this.formulaAssistanceTelemetryManager.H2(["autoCompleteComputationNoResult"])}eIk(W){W={content:W,isCellContentOnlyEqualDuringEdit:this.isCellContentOnlyEqualDuringEdit};void this.pluginScheduler.requester().runAuthoringExperiment(W,this.B5a,null)}Uog(W){const Ta=this.U.da.la.activeCell;if(Ta){var ob=this.Wd.fNb(Ta,!1);if(ob){var K=this.J.ma,ja=ob.sheet.index;0>=K.count||0>ja||ja>=K.count?Ma.ULS.sendTraceTag(512278608,0,50,`FormulaAssistanceManager.NotifyActiveCellChanged invalid sheet index. ewaSheetsCount = ${K.count}, currentSheetIndex = ${ja}.`):
(ja=K=null,void 0!==this.Wd&&null!==this.Wd&&(W=W?.cell??this.U.va.Bt(Ta))&&(W=this.Wd.DSf(W.$h),void 0!==W&&null!==W&&(K=W.FormatString,ja=W.Builtin)),this.pluginScheduler.notifier().setActiveCell({colIndex:ob.range.col,rowIndex:ob.range.row,sheetIndex:this.J.ma.getItem(ob.sheet.index).sheetId,docName:ob.sheet.document.name,docPath:ob.sheet.document.path,formatString:K,builtIn:ja}),Ma.ULS.sendTraceTag(512278607,0,50,`FormulaAssistanceManager.NotifyActiveCellChanged sent notification to the scheduler. col: ${ob.range.col}, row: ${ob.range.row}`))}else Ma.ULS.sendTraceTag(537162002,
0,50,"FormulaAssistanceManager.NotifyActiveCellChanged ISheetGridCell location is null")}else Ma.ULS.sendTraceTag(512278609,0,50,"FormulaAssistanceManager.NotifyActiveCellChanged activeCell range is null")}Leh(){const W=this.yB.aLf;this.pluginScheduler.notifier().setFunctionsInfo(W);Ma.ULS.sendTraceTag(512278606,0,50,`FormulaAssistanceManager.updateSchedulerFunctionList update functions info with ${W?.length} functions}`)}moj(){this.U.da.eFa(this.onActiveCellChanged);this.Wd.NJh(this.kqg);const W=
this.U.Db(null);this.Uog(W);this.ed.PIb(this.xMa);this.lIk();this.wia.DKh(this.Jqg);this.pluginScheduler.setServerDataProvider(new Ne(this.yp,this.J));this.xoa();this.J.Dj(this.Yc)}JUi(){const W=this.Iy.getItems(Ta=>(0,vd.b)(Ta));return(0,vd.c)(W)?[]:W.map(Ta=>{var ob=Ta.name;a:switch(Ta.type){case jf.a.NamedRange:case jf.a.Table:var K=Ta.referenceSheetName&&Ta.topLeft&&Ta.bottomRight?`${Ta.referenceSheetName}!${Ta.topLeft}:${Ta.bottomRight}`:Ta.reference;break a;default:K=Ta.comment}var ja=k(Ta);
a:switch(Ta.type){case jf.a.NamedRange:case jf.a.Table:var ub=(0,Sb.F)(Ta.topLeft);const Cb=(0,Sb.F)(Ta.bottomRight);ub={top:ub.top,left:ub.left,bottom:Cb.bottom,right:Cb.right,maxRows:ub.maxRows,maxColumns:ub.maxColumns,sheetName:Ta.referenceSheetName};break a;default:ub=null}return{name:ob,tooltip:K,type:ja,namedRange:ub,sheetName:Ta.referenceSheetName,reference:Ta.reference}})}}(0,ya.a)(Jb,"FormulaAssistanceManager",null,[354,2]);var zc;let Tc=zc=class{constructor(W,Ta){this.ariaLiveNotifier=W;
this.J=Ta;this.vZa=this.wIa=this.sva=null;this.oyg=(ob,K)=>{this.nrk(K.functionName,K.bLf)};this.qyg=(ob,K)=>{this.krk(K.bLf,K.JVg,K.gOl)};this.pyg=(ob,K)=>{ob=[];for(var ja of K.JVg)void 0!==ja&&null!==ja&&(K=ja.trim())&&ob.push(K);if(ob.length){ja="";for(K=0;K<ob.length;K++){const ub=this.rAd(ob[K]),Cb=zc.Bke(K,ob.length);ja+=ub+Cb;Cb&&(ja+=this.ariaLiveNotifier.B3a)}this.ariaLiveNotifier.readText(ja)}};this.ryg=(ob,K)=>{this.ariaLiveNotifier.prk(K.wM,K.description,K.selectedIndex.toString(),K.length.toString())};
this.kyg=(ob,K)=>{this.ariaLiveNotifier.lKg(K.description,K.length)};this.$tg=()=>{this.ariaLiveNotifier.ONa(Lc.a.instance.ea(884),Ra.a.DFa)};this.Otg=()=>{this.ariaLiveNotifier.readText(Lc.a.instance.ea(885))};this.Wtg=()=>{this.ariaLiveNotifier.readText(Lc.a.instance.ea(886))}}dispose(){this.QGe();this.vZa=this.wIa=this.sva=null}ZSh(W){W&&(this.sva=W,this.sva.qLh(this.oyg),this.sva.sNh(this.qyg),this.sva.rNh(this.pyg))}$Sh(W){W&&(this.wIa=W,this.wIa.pLh(this.$tg),this.wIa.lLh(this.Otg),this.wIa.oLh(this.Wtg))}aTh(W){W&&
(this.vZa=W,this.vZa.tNh(this.ryg),this.vZa.Rvd(this.kyg))}QGe(){this.sva&&(this.sva.rzk(this.oyg),this.sva.gBk(this.qyg),this.sva.fBk(this.pyg));this.vZa&&(this.vZa.hBk(this.ryg),this.vZa.sqe(this.kyg));this.wIa?.qzk(this.$tg);this.wIa?.mzk(this.Otg);this.wIa?.pzk(this.Wtg)}nrk(W,Ta){if(Ta){let ob="";for(let K=0;K<Ta.length;K++)ob+=W+this.ariaLiveNotifier.B3a+this.rAd(Ta[K])+zc.Bke(K,Ta.length);ob+=Lc.a.instance.ea(883)+this.ariaLiveNotifier.B3a;this.ariaLiveNotifier.readText(ob)}}krk(W,Ta,ob){if(W){let ja=
"",ub=0;if(Ta){for(let Cb=0;Cb<Ta.length;Cb++){if(ob>=W[Cb].split(this.J.listSeparator).length){ub++;continue}var K=Ta[Cb].trim();if(!K)return;K=this.rAd(K);const Jc=zc.Bke(Cb-ub,Ta.length-ub);ja+=K+Jc;Jc&&(ja+=this.ariaLiveNotifier.B3a)}this.ariaLiveNotifier.readText(ja)}}}rAd(W){if(!W)return"";var Ta=W.split(this.J.listSeparator);W="";for(const ob of Ta){if(zc.Fvj(ob))W+=ob;else{const K=(Ta=zc.gAj(ob))?ob.replace("[","").replace("]",""):ob;W+=String.format(Ta?Lc.a.instance.yb(59):Lc.a.instance.yb(58),
K)}W+=this.ariaLiveNotifier.B3a}return W}static Bke(W,Ta){return W>=Ta||1===Ta?(Ma.ULS.shipAssertTag(537161997,0,W<Ta,"FormulaAssistanceControl.PositionInList: requested item index >= list length."),""):String.format(Lc.a.instance.yb(55),W+1,Ta)+"\r\n"}static Fvj(W){return Ib.a.contains(W,Df.a.byf,!0)}static gAj(W){return W.trimStart().startsWith(Df.a.tek)||W.trimEnd().endsWith(Df.a.sek)}};Tc=zc=(0,Ba.__decorate)([(0,yc.d)(Mc.Xec),(0,Ba.__param)(0,(0,Mc.th)()),(0,Ba.__param)(1,(0,Mc.ra)())],Tc);(0,
ya.a)(Tc,"FormulaAssistanceReadoutHandler",null,[356,2]);const kd={selectByArrowKeyCounter:0,selectByMouseHoverCounter:0,commitByTabKeyCounter:0,commitByEnterKeyCounter:0,commitByMouseClickCounter:0,commitWhileRequestPending:0,dismissSmartSuggestionExplicitlyCounter:0,dismissSmartSuggestionImplicitlyCounter:0},Bd={formulaAssistanceRequestAttemptedCounter:0,formulaAssistanceRequestOptimizedCounter:0},qe={argumentAssistanceCardInitialMode:void 0,argumentAssistanceCollapseCounter:0,argumentAssistanceExpandCounter:0,
argumentAssistanceLearnMoreCounter:0,argumentAssistanceDragCounter:0,argumentAssistanceDragTotalCounter:0,argumentAssistanceMoveCounter:0,argumentAssistanceMoveTotalCounter:0,argumentAssistanceCardIsInitialModeDefault:!1},se={smartSuggestionShownCounter:0,smartSuggestionSelectedCounter:0,smartSuggestionCommittedCounter:0,smartSuggestionKeptCounter:0,smartSuggestionChangedCounter:0,smartSuggestionDeletedCounter:0,smartSuggestionRevertedCounter:0,isCellContentOnlyEqualDuringEditCounter:0,isCellContentFormulaCounter:0,
smartSuggestionWouldSuggestInsidePivotCounter:0},Qe={parenthesesCouplingCounter:0,formulaHighlightsCounter:0},Kf={dialogCommittedCounter:0,dialogShownCounter:0,argsDialogOpenedByRibbonCounter:0,argsDialogOpenedByDialogCounter:0,argsDialogCommittedCounter:0},Jf={argumentAssistanceFlight:void 0,autoCompleteUIFlight:void 0,smartFormulaBarAutoCompletePluginFlight:void 0,anyPluginInitialized:void 0,formulaAssistanceRedesignFlight:void 0,smartFormulaSuggestionsFeatureEnabled:void 0,parenthesesCouplingFlight:void 0,
coloredReferencesFlight:void 0,uILocale:void 0,dataLocale:void 0,country:void 0,formulaAssistanceUiPositionFlight:void 0,argumentAssistanceUxFlight:void 0};var mg;(function(W){W.RenderDown="rd";W.RenderUp="ru";W.Expand="e";W.Collapse="c";W.Drag="d";W.Move="m";W.GiveFeedback="gf";W.InitialModeExpanded="ie";W.InitialModeCollapsed="ic";W.LearnMore="lm";W.ESC="esc";W.SecondESC="2ndEsc"})(mg||(mg={}));(0,ya.b)("argumentAssistanceUsageActions",mg);var Ze=a(29838),Ue=a(36913),Ia=a(94591);class Rb{constructor(W){this.Dmg=
W;this.u_={...Pb};this.Zib=[];this.OQc=-1;(this.Cmg=Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:5999949_formulaTelemetryMetriThresholds"))&&W&&(this.u_.countAboveThresholds={},W.forEach(Ta=>this.u_.countAboveThresholds[Ta]=0))}static get e6c(){return Ia.a.ob.$d.m}L8a(){this.OQc=Rb.e6c}G2(W,Ta=null){if(-1!==this.OQc||(0,vd.b)(Ta))W?(this.Zud(Rb.e6c-(Ta||this.OQc)),this.OQc=-1):this.u_.failedCount++}mOd(){this.u_.excludingFirstAction=Rb.iIf(this.Zib);this.Zib.push(this.u_.firstAction);this.u_.includingFirstAction=
Rb.iIf(this.Zib)}Zud(W){this.u_.count?1E3>this.u_.count&&this.Zib.push(W):this.u_.firstAction=W;this.Cmg&&this.Dmg&&this.Dmg.forEach(Ta=>{W>Ta&&this.u_.countAboveThresholds[Ta]++});this.u_.count++}static iIf(W){const Ta={...Cc};0<W.length&&(Ue.b(W),Ta.median=W[Math.floor(.5*W.length)],Ta.P75=W[Math.floor(.75*W.length)],Ta.P95=W[Math.floor(.95*W.length)],Ta.max=W[W.length-1],Ta.average=W.reduce((ob,K)=>ob+K)/W.length);return Ta}}(0,ya.a)(Rb,"PerformanceMeasurement",null,[]);const Cc={average:0,max:0,
median:0,P75:0,P95:0},Pb={count:0,countAboveThresholds:void 0,failedCount:0,firstAction:0,includingFirstAction:{...Cc},excludingFirstAction:{...Cc}};var dc=a(22389),Yc=a(1156);const Md={["argumentAssistanceOverall"]:[50,80,100,130,150,170,200],["autoCompleteOverall"]:[50,80,100,130,150,170,200,250,300,350,400],["autoCompleteOverallSimpleAndSmart"]:[50,80,100,130,150,170,200],["autoCompleteOverallSmartOnly"]:[50,80,100,130,150,170,200],["autoCompleteOverallSimpleOnly"]:[50,80,100,130,150,170,200],
["tryUpdateHighlightsFromCellContentEditor"]:[50,80,100,130,150,170,200],["autoCompleteComputation"]:[50,80,100,130,150,170,200,250,300,350,400],["autoCompleteComputationNoResult"]:[50,80,100,130,150,170,200,250,300,350,400]};let we=class{constructor(W,Ta){this.J=W;this.X4g=Ta;this.kLa=Hc.a.KLc();this.OL=null;this.$Oc=-1;this.u9d=null;this.v9d=this.aPc=0;this.Bja={...qe};this.BR={...se};this.kta={...kd};this.$yd={...Bd};this.eQd={...Qe};this.IP={...Jf};this.rKb={};this.Kkb={...Kf};this.aKb=[];this.Lrc=
Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:7376612_argumentAssistanceOrderedActionsTelemetry");this.IXa={};this.ng=(ob,K)=>{null!=this.OL&&(1==Math.abs(this.$Oc-this.J.Z.Ee)&&(ob=this.J.ma.ja.sheetId,K.committed&&K.Gj.equals(this.OL.Gj)&&this.u9d===ob&&this.OL.cellText!==K.cellText&&this.aPc++),1<=Math.abs(this.$Oc-this.J.Z.Ee)&&(this.OL=null,this.$Oc=-1,this.u9d=null));0<Object.keys(this.IXa).length&&(Ma.ULS.sendTraceTag(509658956,0,50,`FormulaAssistanceTelemetryManager.onEditEnded: current edit's completion items data: ${JSON.stringify(this.IXa)}`),
this.IXa={})};this.Yc=(ob,K)=>{K.dg||K.bob||(this.GZg(),this.xTk(),this.J.sendBeaconTraceTag(88392384,50,!1,"{0}",this.getJsonForLogging()))};this.rtb=new Yc.a;W.Dj(this.Yc);this.kLa||Ga.f(this.J).vj.fr(this.ng);this.GZg();this.zNj()}dispose(){!this.kLa&&this.J&&Ga.f(this.J).vj.rq(this.ng)}FPa(W){W.forEach(Ta=>{this.rtb.qb(Ta)||this.rtb.$(Ta,new Rb(Md[Ta]));this.rtb.na(Ta).L8a()})}H2(W,Ta=!0){W.forEach(ob=>{this.rtb.qb(ob)&&this.rtb.na(ob).G2(Ta)})}zOk(W){this.nja(W?"ie":"ic")}yOk(){this.Bja.argumentAssistanceCardIsInitialModeDefault=
!0}TPb(W){window.requestAnimationFrame(()=>{this.H2([W])})}aDk(W){W.forEach(Ta=>{Ta=Fc.F$c[Ta.kind];this.Lgh(Ta);this.rKb[Ta].shownCounter++;this.IXa[Ta].shownCounter++})}$Ck(W){W=Fc.F$c[W];this.Lgh(W);this.rKb[W].committedCounter++;this.IXa[W].committedCounter++}nja(W){if(this.Lrc){const Ta=this.aKb.length;0===Ta||this.aKb[Ta-1][0]!==W?this.aKb.push([W,1]):this.aKb[Ta-1][1]++}else switch(W){case "e":this.Bja.argumentAssistanceExpandCounter++;break;case "c":this.Bja.argumentAssistanceCollapseCounter++;
break;case "d":this.Bja.argumentAssistanceDragCounter++;break;case "m":this.Bja.argumentAssistanceMoveCounter++;break;case "lm":this.Bja.argumentAssistanceLearnMoreCounter++;break;case "ie":this.Bja.argumentAssistanceCardInitialMode="Expanded";break;case "ic":this.Bja.argumentAssistanceCardInitialMode="Collapsed"}}wRk(W){this.X4g.zAg(W)}zNj(){Ma.ULS.sendTraceTag(509140996,0,50,`FormulaAssistanceTelemetryManager.SessionDetails: ${Ze.a.Ac(this.IP)}`)}getJsonForLogging(){return"{"+this.EU("SessionDetails",
this.IP)+","+this.EU("ArgumentAssistanceUsage",this.Bja)+","+this.EU("argumentAssistanceOrderedActions",this.aKb)+","+this.EU("FormulaSuggestionsUsage",this.BR)+","+this.EU("FunctionDialogUsage",this.Kkb)+","+this.EU("AutocompleteCardInteraction",this.kta)+","+this.EU("AutocompleteRenderOptimization",this.$yd)+","+this.EU("AutocompleteUsageByKind",this.rKb)+","+this.EU("FormulaHighlightsUsage",this.eQd)+","+this.y6i()+"}"}xTk(){if(this.kLa){var W=this.X4g.PTd();this.BR.smartSuggestionKeptCounter=
W.suggestionsKept;this.BR.smartSuggestionChangedCounter=W.suggestionsChanged;this.BR.smartSuggestionDeletedCounter=W.suggestionsDeleted;this.BR.smartSuggestionRevertedCounter=W.suggestionsReverted}else this.BR.smartSuggestionChangedCounter=this.aPc,this.BR.smartSuggestionDeletedCounter=this.v9d,this.BR.smartSuggestionKeptCounter=this.BR.smartSuggestionCommittedCounter-this.aPc-this.v9d;for(W=0;W<this.BR.smartSuggestionKeptCounter;W++)(0,Hd.c)(ac)}GZg(){this.IP.argumentAssistanceFlight="T";this.IP.autoCompleteUIFlight=
this.KPf("Microsoft.Office.Excel.","AutoCompleteNewUI");this.IP.smartFormulaBarAutoCompletePluginFlight="T";this.IP.formulaAssistanceRedesignFlight="T";this.IP.coloredReferencesFlight="T";this.IP.parenthesesCouplingFlight="T";this.IP.formulaAssistanceUiPositionFlight="T";this.IP.smartFormulaSuggestionsFeatureEnabled=Hc.a.nob(this.J);this.IP.argumentAssistanceUxFlight="T";this.IP.uILocale=this.J.uiCultureTag;this.IP.dataLocale=this.J.dataCultureTag;this.IP.country=JSON.parse(this.J.pa.SessionStartInfoJson).LocationCountry}y6i(){const W=
[];for(const Ta of this.rtb)Ta.value.mOd(),W.push(`"${Ta.key}":${Ze.a.Ac(Ta.value.u_)}`);return`"PerfMeasurements": {${W.join(",")}}`}KPf(W,Ta){return Ib.a.contains(this.J.pa.FlightHolder.FlightId,Ta,!0)?Ya.EwaSettings.getBooleanFeatureGate(W+Ta,!1)?"T":"C":"None"}EU(W,Ta){return`"${W.toString()}":${dc.c(Ta)}`}Lgh(W){this.rKb[W]||(this.rKb[W]={shownCounter:0,committedCounter:0});this.IXa[W]||(this.IXa[W]={shownCounter:0,committedCounter:0})}};we=(0,Ba.__decorate)([(0,yc.d)(Mc.z0),(0,Ba.__param)(0,
(0,Mc.ra)()),(0,Ba.__param)(1,(0,Mc.nRa)())],we);(0,ya.a)(we,"FormulaAssistanceTelemetryManager",null,[355]);var De=a(97710),df=a(8476);(0,yc.b)(Mc.t6,{Sd:"singleton"})(async W=>{const Ta=await yc.a.resolve(Mc.ra,W),ob=(await yc.a.resolve(Mc.Yec,W)).FormulaAssistanceUIFactoryGlobal.create({isFeedbackAllowed:Ta.isFeedbackEnabled});Ta.quc(()=>{ob.updateContext({isFeedbackAllowed:Ta.isFeedbackEnabled})});return ob});class Le extends De.a{constructor(W){super();this.oKk="formulaAssistance";this.J=W;this.Vo()}create(){let W=
this.J.za.tc(448);W?this.Jk(W):void(0,df.b)(this.oKk,{ua:this.Ie}).then(()=>{W=this.J.za.tc(448);W||(W=this.J.za.Bd(448,formulaAssistance.FormulaAssistanceUIFactoryGlobal.create({isFeedbackAllowed:this.J.isFeedbackEnabled})),this.J.quc(()=>{const Ta={};Ta.isFeedbackAllowed=this.J.isFeedbackEnabled;W.updateContext(Ta)}));this.Jk(W)})}static Qa(W){W.za.Bd(449,new Le(W))}}(0,ya.a)(Le,"FormulaAssistanceUIControlFactory",De.a,[]);let kf=class{constructor(W){this.formulaAssistanceValuePreview=W}Rc(){return!1}executeCommand(W,
Ta){W=!1;Ta=Ta.command;switch(Ta){case -46938080:this.formulaAssistanceValuePreview.trigger(),W=!0}return W?Qc.Task.Xa(!0):lc.a(Ta)}Ec(W,Ta){return-46938080===Ta.command}Zc(){return!1}};kf=(0,Ba.__decorate)([(0,yc.d)(Mc.CAb),(0,Ba.__param)(0,(0,Mc.Kha)())],kf);(0,ya.a)(kf,"FormulaAssistanceValuePreviewCommandHandler",null,[50]);var Af=a(22453),mf=a(82957),Ud=a(13923);const Sf=(W,Ta,ob,K,ja,ub,Cb=null)=>{Cb=W.Za(1,Cb);Cb.evaluationParameters=Ta;return Ud.h(W,"EvaluatePartialFormula",Cb,ob,K,ja,ub,
128)};class Vf{constructor(W,Ta){this.J=W;this.U=Ta;this.isEnabled=Ya.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ValuePreviewValidation",!1)}get MKi(){(0,vd.c)(this.MSe)&&(this.MSe=yc.a.resolve(Mc.kRa,{ua:1}));return this.MSe}async D3h(W,Ta,ob,K,ja){if(this.isEnabled&&("Success"===Ta.kind||"Failure"===Ta.kind)){var ub=Ta.evaluatedFormula;if(!(0,vd.c)(ub)&&""!==ub){var Cb={};Cb.locale=this.HRf();var Jc=this.U.da.la.activeCell;(0,vd.b)(Jc)?Cb.anonymizationOrigin="activeCell":(Cb.anonymizationOrigin=
"A1",Jc=wb.Range.pc(0,0));try{const cd=await this.MKi;Cb.formula=cd.anonymize(W.text,Jc);Cb.subFormula=cd.anonymize(ub,Jc)}catch{Cb.formula="FAIL",Cb.subFormula="FAIL"}Cb.clientResult=this.tL(Ta);try{const cd=this.eWd(),Kd=await K(W.text,ub,ja),ne=this.eWd();Cb.serverResult=this.tL(Kd);Cb.diagnostics=this.p8h(Cb.clientResult,Cb.serverResult);Cb.stateId={beforeX10:ob,beforeServer:cd,server:Kd.stateId,afterServer:ne}}catch(cd){Cb.diagnostics={kind:"error",message:cd}}"Success"===Ta.kind&&(Cb.isVolatile=
Ta.isVolatile);c(Cb);Ma.ULS.sendTraceTag(508831819,1,20,`ValuePreviewResultValidator.checkClientResultVsServer, result: ${JSON.stringify(Cb)}`)}}}eWd(){return{latest:this.J.Z.Ee,successful:this.J.Z.Tv}}HRf(){const W={ui:this.J.uiCultureTag,data:this.J.dataCultureTag},Ta=yc.a.kb(Mc.ov);(0,vd.b)(Ta)&&(W.calcLcid=Ta.qe.Lcid);return W}tL(W){switch(W.kind){case "Failure":return{kind:"failure",reason:W.reason};case "Success":return{kind:"success",value:W.value,unformattedValue:W.unformattedValue,operKind:W.operKind};
default:return{kind:"unexpected"}}}p8h(W,Ta){return"unexpected"===W.kind||"unexpected"===Ta.kind?{kind:"unexpected"}:"success"===W.kind&&"success"===Ta.kind?this.t8h(W,Ta):"failure"===W.kind&&"failure"===Ta.kind?{kind:"equal"}:{kind:"failure",source:"failure"===W.kind?"client":"server"}}t8h(W,Ta){const ob=b(W.value,Ta.value);if("equal"===ob.kind)return ob;const K=W.unformattedValue,ja=Ta.unformattedValue,ub=b(K,ja);return 2===W.operKind&&2===Ta.operKind&&2===Math.abs(K.length-ja.length)&&(W=K.length>
ja.length?"client":"server",K.trim()===ja.trim())?{kind:"padded",source:W}:{kind:"different",diff:ob.diff,unformatted:ub}}}(0,ya.a)(Vf,"ResultValidator",null,[]);var Nf=a(21175);class hg{constructor(W){this.J=W;this.mR=this.gOb=null;this.usage={};this.s_c={};this.performance={};this.details={};this.Una=-1;this.Yc=(Ta,ob)=>{ob.dg||ob.bob||this.J.sendBeaconTraceTag(388818255,50,!1,this.Wbc())};this.editBox=(0,Ga.f)(this.J).Jb;W.Dj(this.Yc)}static getInstance(W){return hg.instance||(hg.instance=new hg(W))}set trigger(W){this.gOb=
W;this.Una=Rb.e6c}set jSg(W){this.mR=W}F7b(W){(0,vd.c)(this.details.color)&&(this.details.color={});(0,vd.c)(this.details.color[W])&&(this.details.color[W]=0);this.details.color[W]++}setResult(W,Ta){if((0,vd.c)(this.gOb))Ma.ULS.sendTraceTag(512258439,0,15,"ValuePreviewTelemetry.setResult - currentTrigger undefined");else if("Failure"!==W.kind||W.timeout){var ob=Ta===this.editBox?"cellEditor":"formulaBar",K=this.gOb;Ta=this.mR;var ja=this.Una;(0,vd.c)(this.usage[ob])&&(this.usage[ob]={});(0,vd.c)(this.usage[ob][K])&&
(this.usage[ob][K]={success:0,error:0,loading:0,timeout:0});ob=this.usage[ob][K];switch(W.kind){case "Success":8===W.operKind?ob.error++:(this.Xsk(W.value),ob.success++);this.gOb=this.mR=null;this.Una=-1;this.H2(Ta,ja);break;case "Loading":ob.loading++;break;case "Failure":this.gOb=this.mR=null,this.Una=-1,W.timeout&&ob.timeout++}}}Xsk(W){if(!(0,vd.c)(this.mR)){(0,vd.c)(this.s_c[this.mR])&&(this.s_c[this.mR]=[]);var Ta=this.s_c[this.mR];1E3>Ta.length&&Ta.push(W.length)}}H2(W,Ta){if(-1!==Ta){W=W??
"cache";this.GTb(`${W}_request`).G2(!0,Ta);var ob=this.GTb(`${W}_overall`);window.requestAnimationFrame(()=>{ob.G2(!0,Ta)})}}GTb(W){return this.performance[W]=this.performance[W]||new Rb(hb)}Wbc(){const W={};Object.keys(this.performance).forEach(Ta=>{this.performance[Ta].mOd();var ob=this.performance[Ta];W[Ta]={metrics:ob.u_,durations:ob.Zib}});return`{"usage":${JSON.stringify(this.usage)},"resultLengths":${JSON.stringify(this.s_c)},"performance":${JSON.stringify(W)},"details":${JSON.stringify(this.details)}}`}}
(0,ya.a)(hg,"ValuePreviewTelemetry",null,[]);const hb=[50,80,100,130,150,170,200],ic=(W,Ta=!1)=>{const ob=hg.instance;if((0,vd.c)(W))return Ta&&ob.F7b("none"),null;if("string"==typeof W){W=Nf.a.xRc[W.toLowerCase()];if((0,vd.c)(W))return Ta&&ob.F7b("badString"),null;Ta&&ob.F7b("string");return W}if("number"==typeof W)return Ta&&ob.F7b("number"),null;Ta&&ob.F7b("other");return null};class Dc{constructor(W,Ta){this.J=W;this.pluginScheduler=Ta;this.vP=new Fb(l);this.j3c=!0;this.IAf=async(ob,K,ja)=>new Promise((ub,
Cb)=>{const Jc={Formula:K,IsWholeFormula:ob===K,ActiveCell:this.U6i(ja)};Sf(this.J.ia.oa,Jc,this.pak(ub),this.oak(Cb),null,null)});this.pak=ob=>K=>{if((0,vd.c)(K.Result))ob({kind:"Failure",reason:"No result",stateId:K.StateId});else{var ja=K.Result,ub=f(ja.Value);(0,vd.b)(ub)?ob({kind:"Failure",reason:ub,stateId:K.StateId}):ob({kind:"Success",value:ja.Value,unformattedValue:ja.UnformattedValue,operKind:ja.OperKind,color:ja.Color,stateId:K.StateId})}};this.oak=ob=>K=>{K=Af.a.ke(K.data);K=mf.a.kc(K);
ob(`Request failed, Errors: ${K}`)};this.U=(0,Ga.f)(this.J);this.vB=yc.a.kb(Mc.LH);this.lSg=new Vf(this.J,this.U);this.jv=hg.getInstance(W)}clearCache(){this.vP.clear()}async fse(W,Ta,ob=!1){this.j3c=ob;W=this.request(W);let K;ob=new Promise(ja=>{K=window.setTimeout(()=>{ja({kind:"Failure",timeout:!0})},Ta)});return Promise.race([W,ob]).finally(()=>{window.clearTimeout(K)})}async request(W){return d(this.vP,W,async()=>{const Ta=(0,Sb.r)(this.U.da.la.activeCell,this.J);var ob={...W,activeCell:{sheetName:this.J.ja?.sheetId,
namedObjectName:null,firstRow:Ta.FirstRow,firstColumn:Ta.FirstColumn}};const K=this.lSg.eWd();ob=await this.pluginScheduler.requester().valuePreview(ob,this.vB?this.vB.B5a:Fc.Nha.Excel,null);if("Done"!==ob.kind)return"Superseded"===ob.kind&&this.vP.delete(W),null;ob=ob.payload;if((0,vd.c)(ob))return{kind:"Failure"};this.j3c&&(this.jv.jSg="client",void this.lSg.D3h(W,ob,K,this.IAf,Ta));switch(ob.kind){case "Failure":return this.vP.delete(W),{kind:"Failure"};case "Success":return ob.isVolatile&&this.vP.delete(W),
this.Gpl(ob);case "Unavailable":return void this.$Nj(W.text,ob),this.vP.delete(W),this.hEk({text:W.text,index:ob.index,length:ob.length},W,W.text,ob.evaluatedFormula,Ta,!ob.isVolatile)}})}Gpl(W){W={...W,color:ic(W.color,this.j3c)};const Ta=f(W.value);return(0,vd.b)(Ta)?(Ma.ULS.sendTraceTag(509871621,1,15,`FormulaAssistanceValuePreviewRequester.validateClientSuccessResult: formula failure:${Ta}, kind:${W.kind}`),{kind:"Failure"}):W}async hEk(W,Ta,ob,K,ja,ub){return m(this.vP,W,Ta,ub,()=>(new Promise(async(Cb,
Jc)=>{try{const cd=await this.IAf(ob,K,ja);this.j3c&&(this.jv.jSg="server");"Success"===cd.kind?Cb({kind:"Success",value:cd.value,index:W.index,length:W.length,color:cd.color,operKind:cd.operKind}):(Ma.ULS.sendTraceTag(508831818,1,50,`FormulaAssistanceValuePreviewRequester.requestFromServer: evaluatePartialFormula failed, ${cd.reason}`),Cb({kind:"Failure"}))}catch(cd){Ma.ULS.sendTraceTag(520495426,1,15,`FormulaAssistanceValuePreviewRequester.requestFromServer: evaluatePartialFormula rejected, ${cd}`),
Jc(cd)}})).catch(()=>{this.vP.delete(W);this.vP.delete(Ta);return{kind:"Failure"}}))}async $Nj(W,Ta){var ob=await yc.a.resolve(Mc.kRa,{ua:1});const K=wb.Range.pc(0,0);W=ob.anonymize(W,K);ob=ob.anonymize(Ta.evaluatedFormula,K);Ma.ULS.sendTraceTag(507799744,1,50,`FormulaAssistanceValuePreviewRequester.logUnavailableResult: ${JSON.stringify({formula:W,evaluatedFormula:ob,reason:Ta.reason})}`)}U6i(W){var Ta=(0,Sb.r)(this.U.da.la.activeCell,this.J);(0,vd.b)(W)&&(Ta=(0,Sb.g)(W,Ta),0<Ta.length&&Ma.ULS.sendTraceTag(507777487,
1,20,`FormulaAssistanceValuePreviewRequester.getSheetCell: cell diffs: ${Ta.join(",")}`));return W}}(0,ya.a)(Dc,"FormulaAssistanceValuePreviewRequester",null,[]);class Fb{constructor(W){this.n6c=W;this.map=new Map}has(W){W=this.n6c(W);return this.map.has(W)}get(W){W=this.n6c(W);return this.map.get(W)}set(W,Ta){W=this.n6c(W);this.map.set(W,Ta);return this}delete(W){W=this.n6c(W);return this.map.delete(W)}clear(){this.map.clear()}}(0,ya.a)(Fb,"RequestMap",null,[]);(0,yc.b)(Mc.jCa,{Sd:"singleton"})(async W=>
{const Ta=await yc.a.resolve(Mc.ra,W);W=await yc.a.resolve(Ca.c,W);return new Dc(Ta,W)});var jc=a(15258);class Uc{constructor(W,Ta,ob){this.J=W;this.vKf=Ta;this.ariaLiveNotifier=ob;this.qmj();this.editBox=(0,Ga.f)(this.J).Jb}get jv(){return hg.getInstance(this.J)}get zoomManager(){this.XUa||(this.XUa=(0,bd.a)());return this.XUa}dispose(){this.hide()}show(W,Ta,ob,K){K={...Ta,Fv:W,WJe:ob,source:K};if(!this.qPa(K))return!1;this.apa(K)&&this.hide();this.jr=K;this.jv.setResult(Ta,W);this.R5();ob&&this.Qij();
return!0}hide(W){if(!this.jr||(0,vd.b)(W)&&W!==this.jr.Fv)return!1;W=this.jr.WJe;this.Roi();W&&this.pxk();this.jr=void 0;return!0}qPa(W){return!this.jr||!e(this.jr,W)}apa(W){return this.jr&&!n(this.jr,W)}Qij(){const W=this.jr.length;0!==W&&this.jr.Fv.Ya.formatText(this.jr.index,W,{background:"rgba(202,234,216,0.6)"})}pxk(){const W=this.jr.Fv;W.Ya.formatText(0,W.text.length,{background:!1});W.hX(null)}R5(){let W;switch(this.jr.kind){case "Success":W={isLoaded:!0,value:this.jr.value,textColor:this.jr.color};
break;case "Loading":W={isLoaded:!1,value:null,textColor:null};break;default:return}this.dnl();this.vKf.renderValuePreview(this.dw,this.hcc,W);this.nhk(W)}Roi(){this.vKf.dismiss(this.dw)}qmj(){this.dw=document.createElement("div");this.hcc=document.createElement("div");this.hcc.style.position="absolute";this.hcc.style.visibility="hidden";this.J.domElement.appendChild(this.hcc)}dnl(){var W=this.jr.Fv;const Ta=this.jr.index,ob=this.jr.length;var K=this.jr.source;let ja;switch(K.trigger){case "hover":ja=
W.Ya.getBounds(K.index,1);break;case "shortcut":ja=W.Ya.getBounds(K.index);break;case "selection":K=W.text.substring(Ta,Ta+ob).indexOf("\n"),-1!==K?ja=W.Ya.getBounds(Ta,K):(K=W.Ya.getBounds(Ta),W=W.Ya.getBounds(Ta,ob),ja={left:K.left,top:K.top,width:W.right-K.left,height:W.height})}this.cnl(ja)}cnl(W){const Ta=new jc.a(this.hcc.style);Ta.jC.left=this.P3c(W.left);Ta.jC.top=this.P3c(W.top);Ta.jC.width=this.P3c(W.width);Ta.jC.height=this.P3c(W.height);Ta.I7()}P3c(W){var Ta=this.jr.Fv;Ta=(0,vd.b)(this.zoomManager)&&
Ta===this.editBox;return Ua.HelperMethods.Wc(Ta?this.zoomManager.uh(W):W)}nhk({isLoaded:W,value:Ta}){W?this.ariaLiveNotifier.readText(String.format(Lc.a.instance.yb(179),Ta)):this.ariaLiveNotifier.readText(Lc.a.instance.ea(866))}}(0,ya.a)(Uc,"FormulaAssistanceValuePreviewControl",null,[2]);class Ka{constructor(W){this.cache=W}clearCache(){this.cache=void 0}}(0,ya.a)(Ka,"Cacheable",null,[]);class Qb extends Ka{constructor(W,Ta){super();this.J=W;this.callbacks=Ta;this.F4a=(ob,K)=>{const ja=this.U.vj;
if(!(0<(ja.isEditing?ja.Ya.selection:{index:0,length:0}).length))switch(K.state){case 0:this.onHoverEnter(ob,K.event);break;case 1:this.onHoverLeave(ob);break;case 2:this.o6j(ob);break;default:return Ma.ULS.shipAssertTag(521446489,0,!1,"FormulaAssistanceValuePreviewHandler.onHoverChange unxpected HoverState"),K}};this.E4a=(ob,K)=>{const ja=K.selection;K={source:"selection",text:K.text,index:ja.index,length:ja.length};if(0<ja.length)this.onSelectionChange(ob,K);else this.Phe(ob,K)};this.U=(0,Ga.f)(this.J);
this.editBox=this.U.cellTextEditBox;this.si(this.editBox);this.formulaBar=(0,ma.a)(this.J);(0,vd.b)(this.formulaBar)?this.si(this.formulaBar):(0,ma.b)(this.J,ob=>{this.formulaBar=ob;this.si(this.formulaBar);Ma.ULS.sendTraceTag(509870663,1,50,"FormulaAssistanceValuePreviewHandler: formulaBar async")})}get jv(){return hg.getInstance(this.J)}dispose(){this.Dh(this.editBox);this.Dh(this.formulaBar)}trigger(){const W=this.U.vj,Ta=W.Ya.selection;this.onSelectionChange(W,{source:"shortcut",text:W.text,index:Ta.index,
length:Ta.length})}si(W){W.XIb(this.F4a);W.TIb(this.E4a)}Dh(W){W?.V6b(this.F4a);W?.Yub(this.E4a)}onHoverEnter(W,Ta){Ta=new Sys.UI.Point(Ta.clientX,Ta.clientY);Ta=h(Ta,W.Ya.ig);if(-1!==Ta)this.onSelectionChange(W,{source:"hover",text:W.text,index:Ta,length:0})}onHoverLeave(W){this.Phe(W)}o6j(W){this.Phe(W)}onSelectionChange(W,Ta){this.N2c(Ta)&&!W.Jea&&(this.cache=Ta,this.callbacks.OMa(W,{index:Ta.index,length:Ta.length,trigger:Ta.source}),this.jv.trigger=Ta.source)}Phe(W,Ta){this.VXk(Ta)&&(this.clearCache(),
this.callbacks.hP(W))}N2c(W){return!this.cache||!v(this.cache,W)}VXk(W){return this.cache&&W?"shortcut"!==this.cache.source||!v(this.cache,W):!0}}(0,ya.a)(Qb,"FormulaAssistanceValuePreviewHandler",Ka,[2]);class Ec{constructor(W){this.J=W;this.eac=0;this.c9a=!1;this.Yxa=null;this.ng=()=>{this.U.cellTextEditBox.uW(this.ng);this.Faa()};this.U=(0,Ga.f)(W)}onShow(){this.c9a||(this.Yxa=performance.now())}onHide(){this.c9a||null===this.Yxa||(400<performance.now()-this.Yxa&&(this.eac++,this.Yxa=null),2===
this.eac&&this.SFe())}SFe(){this.U.isEditing?this.U.cellTextEditBox.BK(this.ng):this.Faa()}Faa(){this.J.uc(1684822464,-1,0,null);this.c9a=!0}}(0,ya.a)(Ec,"ValuePreviewSurveyHandler",null,[]);let fd=class{constructor(W,Ta,ob,K){this.J=W;this.requester=Ta;this.B1k=200;this.JQg=3E3;this.lvj=Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:9045704_ValuePreviewDontShowStaleResults");this.OMa=async(ja,ub)=>{const Cb={text:ja.text,index:ub.index,length:ub.length};void this.eHg(Cb,this.xEk(Cb),ja,0===Cb.length,
ub.trigger)};this.hP=()=>{this.hide()};this.reset=()=>{this.handler.clearCache();this.requester.clearCache();this.hide()};this.kz=()=>{this.handler.clearCache();this.requester.clearCache()};this.Wt=()=>{this.hide(this.U.Jb)};this.TSc=ja=>{this.hide(ja)};this.U=(0,Ga.f)(this.J);this.control=new Uc(this.J,ob,K);this.handler=new Qb(this.J,{OMa:this.OMa,hP:this.hP});this.xaa=new Ec(this.J);this.si()}get jv(){return hg.getInstance(this.J)}trigger(){this.handler.trigger()}dispose(){this.Dh();this.handler.dispose();
this.control.dispose()}si(){this.U.Jb.BK(this.reset);this.U.da.add_activeCellChanged(this.reset);this.J.Z.fG(this.kz);this.U.view.jt(this.Wt);this.U.cellTextEditBox.w$e(this.TSc);(0,ma.b)(this.J,W=>{W.w$e(this.TSc)})}Dh(){this.U.Jb.uW(this.reset);this.U.da.remove_activeCellChanged(this.reset);this.J.Z.jH(this.kz);this.U.view.Qs(this.Wt);this.U.cellTextEditBox.iOg(this.TSc);(0,ma.a)(this.J)?.iOg(this.TSc)}async eHg(W,Ta,ob,K,ja){this.fl=W={...W,Fv:ob,P2c:K,trigger:ja};Ta=await Ta;(0,vd.c)(Ta)||this.I5d(W)&&
void this.nYd(Ta)}async nYd(W){const Ta=this.fl.text,ob=this.fl.Fv,K=this.fl.P2c,ja=this.fl.trigger;switch(W.kind){case "Failure":this.jv.setResult(W,ob);this.hide();break;case "Success":this.show(W);break;case "Loading":this.show(W);void this.eHg({text:Ta,index:W.index,length:W.length},W.promise,ob,K,ja);break;default:return W}}xEk(W){const Ta=this.requester.fse(W,this.JQg,!0);let ob;const K=new Promise(ja=>{ob=window.setTimeout(()=>{ja({...W,kind:"Loading",promise:Ta})},this.B1k)});return Promise.race([Ta,
K]).finally(()=>{window.clearTimeout(ob)})}show(W){const Ta=this.fl.index,ob=this.fl.Fv,K=this.fl.P2c,ja=this.fl.trigger;this.fl=void 0;if(this.dCj(W)&&this.control.show(ob,W,K,{trigger:ja,index:Ta}))this.xaa.onShow()}hide(W){W=this.control.hide(W);this.fl=void 0;if(W)this.xaa.onHide()}I5d(W){var Ta;if(Ta=this.fl)Ta=this.fl,Ta=Ta.text===W.text&&Ta.index===W.index&&Ta.length===W.length&&Ta.Fv===W.Fv&&Ta.P2c===W.P2c;return Ta&&(!this.lvj||W.text===W.Fv.text)}dCj(W){switch(W.kind){case "Success":return(0,
vd.b)(W.value)&&""!==W.value;case "Loading":return!0;default:return W}}};fd=(0,Ba.__decorate)([(0,yc.d)(Mc.Kha),(0,Ba.__param)(0,(0,Mc.ra)()),(0,Ba.__param)(1,(0,Mc.jCa)()),(0,Ba.__param)(2,(0,Mc.t6)()),(0,Ba.__param)(3,(0,Mc.th)()),(0,Ba.__param)(4,(0,Mc.LH)())],fd);(0,ya.a)(fd,"FormulaAssistanceValuePreview",null,[357,2]);(0,yc.b)(Mc.U$a)(async W=>{await yc.a.resolve(Mc.iqa,W);return excelOnlineCalc.FormulaAuthoringHelperSingletonGlobal.instance()});var td;let Ad=td=class extends ee.a{constructor(W){super(W,
td.featureName);this.N3f=!0}get jf(){return Ee.a.aQd}show(W,Ta,ob,K,ja,ub=null,Cb=null,Jc){return this.zxb(Cb,cd=>{appChrome.renderFormulaSuggestionCard(W,Ta,this.domElement,cd.y,cd.x,cd.y+cd.height,cd.x+cd.width,ob,K,ja,ub,this.Pwb,Jc?{explanationKey:Jc.explanationKey,replacements:Jc.explanationReplacements,notifyExplanationSuccessful:Jc.WSc}:void 0)})}UAe(W,Ta,ob,K,ja,ub,Cb,Jc,cd,Kd,ne){return this.zxb(ne,Ve=>{appChrome.renderRowNumberingSuggestionCard(W,Ta,this.domElement,Ve.y,Ve.x,Ve.y+Ve.height,
Ve.x+Ve.width,ob,K,ja,ub,Cb,Jc,cd,Kd,this.Pwb)})}XW(W,Ta,ob){Ya.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FBEPluginDebugUI",!1)&&(this.p2&&W.equals(this.k9d)||(this.p2&&document.body.removeChild(this.p2),this.k9d=W,W=this.grid.Db(W),W=this.grid.getCellBounds(W.cell,!0),this.p2=document.createElement("div"),this.p2.setAttribute("style",`position:fixed;
        left: ${W.x+W.width}px;
        top: ${W.y+W.height/2}px`),document.body.appendChild(this.p2)),W=new oc.a(-847286761,0,this.J.jc,0,null),this.J.Ga.vb(W,{["CalloutName"]:15,["Target"]:this.p2,["NewState"]:Ta,["Reason"]:ob}))}};Ad=td=(0,Ba.__decorate)([(0,yc.d)(Mc.Zec),(0,Ba.__param)(0,(0,Mc.ra)())],Ad);(0,ya.a)(Ad,"FormulaByExampleCardUIControl",ee.a,[362]);class ge{constructor(W,Ta,ob){this.pluginScheduler=W;this.Rq=Ta;this.sab=ob;this.lId=Ya.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FBEPluginDebugUI",!1)}async BQg(W,
Ta,ob){let K={status:"failure"};this.Rq.Bha(ob,0);Ta={context:(0,Sb.NHc)(W),skipOriginCell:Ta};this.lId&&this.sab.j2k(W);Ta=await this.pluginScheduler.requester().columnFormulaSuggestion(Ta,Fc.Nha.Excel,ob.toString());if("Done"===Ta.kind&&Ta.payload?.suggestions&&Ta.payload.suggestions[0]){Ta=Ta.payload.suggestions[0];const ja="ColumnFormulaSuggestion"===Ta.kind,ub=Ta.metadata;Ma.ULS.sendTraceTag(506581653,306,20,`FormulaByExamplePluginCommunicator.requestFormulaByExample: suggestion.kind = ${Ta.kind}, ${"ColumnFormulaSuggestion"===
Ta.kind?"":"suggestion.reason: "+Ta.reason+","} metadata: ${JSON.stringify(ub)}`);ja?(this.Rq.Bha(ob,5,{formula:ub.rawFormula,zR:ub.anonymizedFormula,uM:ub.seenCount??null,J3:ub.isCacheHit??null,Rma:ub.latestOutcome??null}),K=this.NXi(Ta),this.lId&&this.sab.A3g(W,`formula found: "${Ta.metadata.rawFormula||Ta.formula}"`)):("no formula found"===Ta.reason?this.Rq.Bha(ob,1,{errorMessage:null,uM:ub.seenCount,J3:ub.isCacheHit,Rma:ub.latestOutcome}):this.Rq.Bha(ob,1,{errorMessage:Ta.reason,uM:null,J3:null,
Rma:null}),K.flowId=Number(Ta.suggestionID),this.lId&&this.sab.A3g(W,Ta.reason))}this.Rq.mjb(ob);return K}async ipg(W,Ta){await this.pluginScheduler.eventEmitter().FBEOutcomeUpdate({flowId:W,suggestionOutcome:{outcome:Ta}});return!0}NXi(W){if(!W||!W.evalResults)return{status:"failure",flowId:W?Number(W.suggestionID):void 0};const Ta=W.evalResults.map(ob=>{if("FormulaSuggestionEvalFailureResult"===ob.kind)return{kind:"Failure",cell:(0,Sb.wKd)(ob.cell),value:ob.error};let K,ja;switch(ob.value.kind){case "number":ja=
"Success";K=ob.value.num;break;case "string":ja="Success";K=ob.value.text;break;case "boolean":ja="Success";K=ob.value.flag;break;case "error":ja="ExcelAppError",K=ob.value.errorValue}return{kind:ja,cell:(0,Sb.wKd)(ob.cell),value:K,format:ob.formatted}});return{status:"success",flowId:Number(W.suggestionID),columnRange:(0,Sb.wKd)(W.columnRange),tableName:W.tableName,tableColumnName:W.tableColumnName,suggestions:[{formula:W.formula,zR:W.metadata.formulaAnonymized,cells:Ta,tableName:W.tableName,explanation:{explanationKey:W.metadata.explanationKey,
explanationReplacements:W.metadata.explanationReplacements},metadata:W.metadata}]}}}(0,ya.a)(ge,"FormulaByExamplePluginCommunicator",null,[686]);var Pe=a(60104);class Lb{constructor(W,Ta){this.U=W;this.Wd=Ta;this.Xxf=new Set;this.kF=(ob,K)=>{if(ob=this.U.ub.Zf(K.Gj,!1))if(K=this.S9i(ob,K.Gj.left))this.Xxf.has(K)?(this.cFh(),this.U.Jb.uW(this.kF)):this.Xxf.add(K)};this.cFh=()=>{Pe.a.r4("XLS-FormulaByExample-Treatment;XLS-FormulaByExample-Control")};this.S9i=(ob,K)=>{const ja=this.Wd.y_a(ob);if(!ja)return null;
const ub=ob.usedRange,Cb=K-ub.left;return 0>Cb||Cb>=ja.length?(Ma.ULS.sendTraceTag(537161876,306,10,`FormulaByExampleSuggestionCache.getUniqueTableColumnIdentifier: invalid inputs. tableRange: ${ub}, columnNumber: ${K}, `+`areAllTableHeadersAvailable: ${this.Wd.tbf(ob,ja)}`),null):(K=ja[Cb])?ob.name+"_"+K:null};this.U.Jb.BK(this.kF)}}(0,ya.a)(Lb,"FormulaByExampleScorecardTriggerReporter",null,[]);var bc;(function(W){W.PreviewAlreadyShowing="PreviewAlreadyShowing";W.StrictDataMismatch="StrictDataMismatch";
W.LackingPrefetchedResults="LackingPrefetchedResults";W.RangeNotLoaded="RangeNotLoaded";W.InvalidCalcResults="InvalidCalcResults";W.ErrorsInEvaluation="ErrorsInEvaluation";W.InternalPreviewError="InternalPreviewError";W.WorkbookModelUpdateFailed="WorkbookModelUpdateFailed";W.FailedToPreviewActiveCell="FailedToPreviewActiveCell";W.Unknown="Unknown"})(bc||(bc={}));(0,ya.b)("FormulaPreviewErrorKind",bc);var Oc=a(11280);class nd{constructor(){this.xRb=new Map}static getInstance(){nd.instance||(nd.instance=
new nd);return nd.instance}jql(W){this.xRb.has(W)||this.xRb.set(W,new Map)}mark(W,Ta,ob=performance.now()){Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:8883232_FormulaByExample_AllowPerformanceTracker")&&(this.jql(W),this.xRb.get(W).set(Ta,ob))}measure(W,Ta,ob){if(!Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:8883232_FormulaByExample_AllowPerformanceTracker"))return null;var K=this.xRb.get(W);if(K){const ja=K.get(Ta);K=K.get(ob);if(ja&&K)return K-ja}Ma.ULS.sendTraceTag(507278856,306,10,`FormulaByExamplePerformanceTracker.measure: Failed to measure time between ${Ta} and ${ob} for flow ${W}`);
return null}b5h(W){Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:8883232_FormulaByExample_AllowPerformanceTracker")&&this.xRb.delete(W)}}(0,ya.a)(nd,"FormulaByExamplePerformanceTracker",null,[]);const Zd=nd;class Nd{constructor(W,Ta,ob){this.J=W;this.Ugb=Ta;this.cQd=ob;this.dx=null;this.U4=Zd.getInstance();this.Z0c=()=>{Ma.ULS.sendTraceTag(537161889,306,50,"FormulaByExampleManager.SendByExampleFeedback: opening send feedback dialog after click on card.");const K={};K[Ra.a.CG]="FormulaByExampleCard";
this.J.uc(802602464,0,8,K)};this.yUb=()=>{};this.Ifa=(K,ja)=>{0===ja.Tq&&576!==ja.Wf.operation.operationName&&(this.dx&&this.dx.t9(`UserOperation: ${Oc.a(ja.Wf.operation.operationName)}`),this.J.Ba.kn(this.Ifa))}}async X2k(W,Ta,ob,K,ja=!1){const ub={wAe:!1,q7f:!1,EFa:{softIgnoreCount:0,softIgnoreReasons:[],didReshow:!1,didPrime:!1},gaa:null};try{const Cb=(0,Sb.H)(Ta.columnRange),Jc=ob.cells.findIndex(uf=>uf.cell.FirstRow===K.bottom),cd=ob.cells.slice(0,Jc).map(u),Kd=await this.cQd.Z2k(ob.formula,
Cb,W,uf=>{this.yUb(uf,W,Ta,ob)},{stateId:0,results:cd},ja);if(!Kd.success)return{wle:{y_:"UNSEEN",Ggb:`FormulaByExampleUIManager.showSuggestionPreview failed: ${JSON.stringify(Kd.error)}`},SNd:ub};this.dx=Kd.dx;(0,Od.f)(()=>{this.U4.mark(Ta.flowId,"SuggestionShown")},this.J.Ma);const ne=this.J.isFeedbackEnabled?this.Z0c:null;let Ve;if(w(ob.zR)){ub.gaa={isAcceptAsValues:!1,maxTooltipOpenDurationMS:0,isFurtherExplanationHyperlinkClicked:!1,disableApplyAsValue:1E4<ob.cells.length};const uf=ub.gaa;Ve=
()=>this.Ugb.UAe(ob.formula,Cb.toString(),()=>{this.dx.isa("CardUI")},()=>{uf.isAcceptAsValues=!0;this.dx.isa("CardUI")},uf.disableApplyAsValue,()=>this.dx.eHa("CardUI"),sf=>{uf.maxTooltipOpenDurationMS=Math.max(uf.maxTooltipOpenDurationMS,sf)},()=>{uf.isFurtherExplanationHyperlinkClicked=!0},ne,()=>ub.wAe=!0,W)}else Ve=()=>this.Ugb.show(ob.formula,Cb.toString(),()=>this.dx.isa("CardUI"),()=>this.dx.eHa("CardUI"),ne,()=>ub.wAe=!0,W,ob.explanation&&ob.explanation.explanationReplacements?{...ob.explanation,
WSc:uf=>{ub.q7f=uf}}:void 0);Ve();this.dx.jaf((uf,sf)=>{ub.EFa.softIgnoreCount++;ub.EFa.softIgnoreReasons.push(sf.reason);this.Ugb.hide()});this.dx.hwd(()=>{ub.EFa.didReshow=!0;Ve()});ub.EFa.didPrime=this.dx.didPrime;this.J.Ba.Up(this.Ifa);return this.dx.d8b.then(uf=>{this.U4.mark(Ta.flowId,"UserResponded");this.Ugb.hide();this.J.Ba.kn(this.Ifa);(0,Od.f)(()=>{this.U4.mark(Ta.flowId,"SuggestionHidden");const sf=this.U4.measure(Ta.flowId,"UserResponded","SuggestionHidden");Ma.ULS.sendTraceTag(507274432,
306,20,`FormulaByExampleManager.showSuggestionPreview: UserResponded_SuggestionHidden took ${sf} MS for flow ${Ta.flowId}`);this.U4.b5h(Ta.flowId)},this.J.Ma);return{wle:uf,SNd:ub}})}catch(Cb){return{wle:{y_:"UNSEEN",Ggb:`FormulaByExampleUIManager.showSuggestionPreview failed: ${Cb}`},SNd:ub}}}j2k(W){this.Ugb.XW(W,7)}A3g(W,Ta){this.Ugb.XW(W,8,Ta)}}(0,ya.a)(Nd,"FormulaByExampleUIManager",null,[]);var La=a(44838);(0,yc.b)(Mc.$ec)(async W=>{const Ta=await yc.a.resolve(Mc.ra,W),ob=await yc.a.resolve(Mc.bfc,
W),K=await yc.a.resolve(Mc.Rl,W),ja=await yc.a.resolve(Mc.Zec,W),ub=Ga.f(Ta);let Cb=null;if(await Hc.a.J1a(Ta)){var Jc=await yc.a.resolve(Mc.JT,W);!Ya.EwaSettings.HL()||Jc?Cb=Jc.dwa():Ma.ULS.sendTraceTag(507093954,0,15,"TableIntelligenceManagerService is not available due to null dependency")}W=await yc.a.resolve(Ca.c,W);Jc=await yc.a.resolve(Mc.V$a);return new Ob(Ta,ub,new Lb(ub,K),ja,Cb,ob,W,Jc,K)});class Ob{constructor(W,Ta,ob,K,ja,ub,Cb,Jc,cd){this.J=W;this.U=Ta;this.IC=K;this.wbc=ja;this.cQd=
ub;this.Wd=cd;this.U4=Zd.getInstance();this.ZFa=null;this.$pb=0;this.C8k=Ya.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginSuggestionShowing",!1);this.BMa=(Kd,ne)=>{const Ve=performance.now(),uf=ne.c3.range,sf=ne.XMc;let Rf=!0;const Gf=()=>{Rf=!1;this.U.Jb.rq(Gf)},Eg=this.yVd();this.U.Jb.fr(Gf);void this.A5a.BQg(uf,!0,Eg).then(Wf=>{Rf&&"failure"!==Wf.status&&(this.U4.mark(Wf.flowId,"EventTriggered",Ve),void this.XTc(Wf,uf,Eg,sf,{gwf:"EditStart"}))})};this.kF=(Kd,ne)=>
{Kd=performance.now();ne.committed&&this.sWg(ne.Gj,this.yVd(),!1,"EditEnd",Kd)};this.onPaste=(Kd,ne)=>{Kd=performance.now();var Ve=ne.Suf;Ve&&1===Ve.length&&(Ve=Ve[0],Ve.EV&&(ne=ne.Ni)&&1804571062!==ne&&1766348718!==ne&&this.U.az(Ve)&&this.sWg(Ve.center,this.yVd(),!0,"Paste",Kd))};this.Jge=(Kd,ne,Ve)=>{Ma.ULS.sendTraceTag(528023709,306,20,`FormulaByExampleManager.onImmediateUndo: undo operation queued following a formula by example suggestion application. flowId=${Kd} originalFlowId=${ne} isTableSuggestion=${Ve}`);
void this.A5a.ipg(Kd,"UNDO")};this.hQg=(Kd,ne,Ve)=>{Ma.ULS.sendTraceTag(506554128,306,20,`FormulaByExamplePluginTriggersManager.reportPreviewDisplayFailed: ${Kd}, flowId=${ne} formulaAnonymized=${Ve}`)};this.FDk=(Kd,ne)=>{Ma.ULS.sendTraceTag(506554127,306,20,`FormulaByExamplePluginTriggersManager.reportOutcomeNotificationFailed: flowId=${Kd} formulaAnonymized=${ne}`)};if(this.aLi=Hc.a.CKa(this.J))this.jTg=Ya.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleRowsBelowRangeTableToQuery",
1),this.sab=new Nd(this.J,this.IC,this.cQd),this.A5a=new ge(Cb,Jc.tWf("Plugin"),this.sab),this.U.Jb.GN(this.BMa),this.U.Jb.BK(this.kF),this.J.za.Hd(254,Kd=>{Kd.rqc(this.onPaste)})}yVd(){return++this.$pb}sWg(W,Ta,ob=!0,K,ja){this.S7b();this.ZFa=this.U.va.HMa(()=>{const ub=()=>{this.Wd.Q6b(ub);void this.A5a.BQg(W,!1,Ta).then(Cb=>{this.U4.mark(Cb.flowId,"EventTriggered",ja);ob&&void this.XTc(Cb,W,Ta,!1,{gwf:K})})};this.Wd.OIb(ub)})}async XTc(W,Ta,ob,K=!1,ja){if("failure"!==W.status){this.U4.mark(W.flowId,
"PluginResponded");var ub=this.U4.measure(W.flowId,"EventTriggered","PluginResponded");if(ob===this.$pb&&W.suggestions&&0<W.suggestions.length){ob=W.suggestions[0];if(!(2E3>ub)){var Cb=ob.metadata.augloopTime;Ma.ULS.sendTraceTag(507070214,306,20,"FormulaByExamplePluginTriggersManager.onPluginResponse: Plugin response with formula took too long to arrive. Data: "+JSON.stringify({["flowId"]:W.flowId,["formulaAnonymized"]:ob.zR,["timeToPluginResponse"]:ub,["augloopTime"]:Cb}));if(2E3<Cb)return}ub=(0,
Sb.H)(W.columnRange);Cb=this.G_i(ub);if(!Cb)this.hQg("Failed to get loaded column range",W.flowId,ob.zR);else if(this.C8k){var {wle:Jc,SNd:cd}=await this.sab.X2k(Ta,W,ob,Cb,K),Kd=null!=ob.tableName&&""!==ob.tableName,ne=ob.metadata.bOl;"UNSEEN"===Jc.y_?this.hQg(Jc.Ggb,W.flowId,ob.zR):("ACCEPT"===Jc.y_&&(cd.gaa?.isAcceptAsValues?this.CRh(ub,ob.cells,W.tableName):this.lRh(ub,ob.formula,Ta),this.T4a=(Ve,uf)=>{0===uf.Tq&&(170===uf.Wf.operation.operationName&&this.Jge(W.flowId,ne,Kd),this.J.Ba.kn(this.T4a),
this.T4a=null)},this.J.Ba.Up(this.T4a)),await this.A5a.ipg(W.flowId,Jc.y_)||this.FDk(W.flowId,ob.zR),Ta={["flowId"]:W.flowId,["originalFlowId"]:ne,["caller"]:Jc.Ggb,["displayTrigger"]:ja.gwf,["formulaAnonymized"]:ob.zR,["originalFormulaAnonymized"]:ob.zR,["suggestionOutcome"]:Jc.y_,["annotationRange"]:ub.toString(),["isFullyInViewport"]:this.U.az(ub),["isCachedSuggestion"]:ob.metadata.J3,["showFormulaClicked"]:cd.wAe,["seenCount"]:ob.metadata.uM+1,["Performance"]:{["EventTriggered_PluginResponded"]:this.U4.measure(W.flowId,
"EventTriggered","PluginResponded"),["PluginResponded_SuggestionShown"]:this.U4.measure(W.flowId,"PluginResponded","SuggestionShown"),["SuggestionShown_UserResponded"]:this.U4.measure(W.flowId,"SuggestionShown","UserResponded")},["isSuggestionOnTable"]:Kd,["sheetId"]:(0,$b.d)(this.J.ma.ja),["dataCulture"]:this.J.uiCultureTag,["UICulture"]:this.J.dataCultureTag,["previewEvents"]:{["softIgnoreCount"]:cd.EFa.softIgnoreCount,["softIgnoreReasons"]:cd.EFa.softIgnoreReasons,["didReshow"]:cd.EFa.didReshow,
["didPrime"]:cd.EFa.didPrime},["formulaExplanation"]:{explanationSuccessful:cd.q7f,explanationKey:ob.explanation?.explanationKey},["RowNumbering"]:cd.gaa?{["isAcceptAsValues"]:cd.gaa.isAcceptAsValues,["maxTooltipOpenDurationMS"]:cd.gaa.maxTooltipOpenDurationMS,["isFurtherExplanationHyperlinkClicked"]:cd.gaa.isFurtherExplanationHyperlinkClicked,["disableApplyAsValue"]:cd.gaa.disableApplyAsValue}:null,["IsPlugin"]:!0},Ma.ULS.sendTraceTag(388780100,306,20,`FormulaByExampleManager.handlePreviewResult: FormulaByExample flow results: ${JSON.stringify(Ta)}`))}}}}lRh(W,
Ta,ob){this.U.setCell({Text:Ta,TextRuns:null,Fonts:null},ob,1,127,null,0,{range:W,origin:ob},2)}CRh(W,Ta,ob){W={FirstRow:W.top-1,FirstColumn:W.left-1,LastRow:W.bottom-1,LastColumn:W.right-1,SheetName:this.J.ma.ja.name,NamedObjectName:ob};Ta=Ta.map(K=>[K.value.toString()]);this.Lbd(W,Ta)}Lbd(W,Ta){const ob=new La.a(163,0,(K,ja,ub)=>{const Cb=this.J.ia.oa,Jc=Cb.Za(0);Jc.rangeToSet=W;Jc.rangeValues=Ta;return Ud.h(Cb,"SetRange",Jc,(cd,Kd,ne)=>{K(cd,Kd,ne)},(cd,Kd,ne)=>{ja(cd,Kd,ne)},ub,this.J.ia.oa.Yb(),
0)},65);this.J.Ba.enqueueOperation(ob,null)}G_i(W){return W.Qe(this.U.Hk)}S7b(){this.ZFa?.();this.ZFa=null}}(0,ya.a)(Ob,"FormulaByExamplePluginTriggersManager",null,[]);const mc={P_:null,pga:null,formula:null,zR:null,errorMessage:null,J3:null,uM:null,Rma:null};let uc=class{constructor(){this.H4b=new Map;this.V_b=new Map;this.gPd=new Map}tWf(W){return new X(this,W)}Bha(W,Ta,ob,K){Ta=Ta?this.H4b:this.V_b;if(!Ta.has(W))if(0===ob)Ta.set(W,{...mc});else return;const ja=Ta.get(W);switch(ob){case 0:ja.P_=
performance.now();break;case 2:Ta.set(W,{...ja,...K});break;case 3:case 1:case 5:ja.pga=performance.now();Ta.set(W,{...ja,...K});break;case 4:ja.J3||(ja.pga=performance.now(),Ta.set(W,{...ja,...K}))}}mjb(W){if("BothComplete"===this.lGc(W))this.Chg(W);else{const Ta=window.setTimeout(()=>{"BothComplete"!==this.lGc(W)&&(this.H4b.has(W)||this.V_b.has(W))&&this.Chg(W)},15E3);this.gPd.set(W,Ta)}}Chg(W){var Ta=this.H4b.get(W);const ob=this.V_b.get(W),K=ob?.errorMessage||Ta?.J3===ob?.J3&&Ta?.uM===ob?.uM&&
Ta?.Rma===ob?.Rma;"BothComplete"===this.lGc(W)&&K&&Ta?.formula===ob?.formula&&Ta?.errorMessage===ob?.errorMessage||"AwaitTask failed - no annotation found"===Ta?.errorMessage&&ob?.P_&&!ob?.pga?Ma.ULS.sendTraceTag(84165970,306,20,`FBE plugin validator compared successfully: ${JSON.stringify({["flowID"]:W,["pluginStartTime"]:Ta.P_,["pluginEndTime"]:Ta.pga,["legacyStartTime"]:ob.P_,["legacyEndTime"]:ob.pga,["pluginRequestDuration"]:Ta.pga-Ta.P_,["legacyRequestDuration"]:ob.pga-ob.P_,["firstStartReported"]:Ta.P_<
ob.P_?"Plugin":"Legacy",["error"]:Ta.errorMessage,["formula"]:Ta.zR,["isCacheHit"]:Ta.J3,["seenCount"]:Ta.uM,["latestOutcome"]:Ta.Rma})}`):this.Uyj(ob?.errorMessage)&&(Ta={["flowId"]:W,["pluginStartTime"]:Ta?.P_,["pluginEndTime"]:Ta?.pga,["legacyStartTime"]:ob?.P_,["legacyEndTime"]:ob?.pga,["successfulFlows"]:this.lGc(W),["pluginError"]:Ta?.errorMessage,["legacyError"]:ob?.errorMessage,["pluginFormula"]:Ta?.zR,["legacyFormula"]:ob?.zR,["pluginCacheHit"]:Ta?.J3,["legacyCacheHit"]:ob?.J3,["pluginSeenCount"]:Ta?.uM,
["legacySeenCount"]:ob?.uM,["pluginLatestOutcome"]:Ta?.Rma,["legacyLatestOutcome"]:ob?.Rma},Ma.ULS.sendTraceTag(84165957,306,50,`FBE plugin validator comparison failure: ${JSON.stringify(Ta)}`));this.H4b.delete(W);this.V_b.delete(W);if(Ta=this.gPd.get(W))clearTimeout(Ta),this.gPd.delete(W)}lGc(W){var Ta=this.V_b.get(W),ob=this.H4b.get(W);W=ob?.P_;ob=ob?.pga;const K=Ta?.P_,ja=Ta?.pga;Ta=null!==Ta?.J3||null!==Ta?.errorMessage;return W&&ob&&K&&ja&&Ta?"BothComplete":W&&ob?"PluginComplete":K&&ja&&Ta?"LegacyComplete":
"NoneComplete"}Uyj(W){return"signal lock"!==W&&"AL is undefined"!==W&&"tableRange does not intersect loaded range"!==W&&"table return null for table suggestion"!==W&&"column has non uniform data"!==W&&"consistent block cache callback cancelled"!==W}};uc=(0,Ba.__decorate)([(0,yc.d)(Mc.V$a)],uc);(0,ya.a)(uc,"FormulaByExamplePluginValidator",null,[]);class X{constructor(W,Ta){this.vgh=W;this.xMc="Plugin"===Ta;this.xMc||(this.ufg=new Map)}Bha(W,Ta,ob){(W=this.sWf(W))&&this.vgh.Bha(W,this.xMc,Ta,ob)}mjb(W){(W=
this.sWf(W))&&this.vgh.mjb(W)}b_g(W,Ta){this.xMc||this.ufg.set(W,Ta)}sWf(W){return this.xMc?W:this.ufg.get(W)}}(0,ya.a)(X,"FormulaByExamplePluginValidatorProxy",null,[]);var jb=a(93187);(0,yc.b)(Mc.W$a,{Sd:"singleton"})(async W=>{const Ta=await yc.a.resolve(Mc.ra,W),ob=await Hc.a.J1a(Ta),[K,ja,ub,Cb,Jc]=await Promise.all([yc.a.resolve(Mc.Rl,W),yc.a.resolve(Mc.uy,W),ob?yc.a.resolve(Mc.JT,W):Promise.resolve(null),yc.a.resolve(Mc.Zq,W),Ya.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FBEPersistentCache",
!1)?yc.a.resolve(Mc.qX):Promise.resolve(null)]);if(Ya.EwaSettings.HL()&&(!ub||!ja))return null;let cd,Kd;cd=await yc.a.resolve(Mc.$ec,W);Kd=await yc.a.resolve(Mc.V$a,W);W=Ya.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginSuggestionShowing",!1)?await yc.a.resolve(Ca.c,W):null;return new jb.a(Ta,K,ja,ub,Cb,cd,ob,Jc,Kd,W)});class Kb extends Map{constructor(W){super();this.o$=W}set(W,Ta){if(!this.has(W)&&this.size>=this.o$){const [ob]=this.entries().next().value;this.delete(ob)}return super.set(W,
Ta)}has(W){if(super.has(W)){const Ta=this.get(W);this.delete(W);super.set(W,Ta);return!0}return!1}}(0,ya.a)(Kb,"LimitedSizeHotMap",Map,[]);const Ic=W=>`${W.top}_${W.left}`;let xd=class{constructor(W){this.Qb=W;this.u5a=new Map;this.mtb=new Map;this.ASj=Ya.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleMinRowsForLocks",3);this.CRj=Ya.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleMaxLocksPerSession",3);this.iPa=new Kb(this.CRj);this.Bsc=!1;this.Uak=(Ta,
ob,K)=>{if(K.reduce((Cb,Jc)=>Cb+Jc.bottom-Jc.top+1,0)<this.ASj)Ma.ULS.sendTraceTag(508036641,0,50,"FormulaByExampleSignalLocksManager.onSignalSent: not enough rows to lock by");else{this.iPa.has(ob)&&this.iPa.delete(ob);for(const Cb of K){var ja=this.Qb.eua("FormulaByExampleSignalLocksManager.onSignalSent",Cb);const Jc={Mgg:Cb,s$d:new Map};try{for(;ja.$$mn();){const cd=ja.$$cu(),Kd=cd.Nh.value;Jc.s$d.set(Ic(cd.range),Kd)}}finally{ja&&ja.dispose()}if(ub)ub.Ngg.push(Jc);else{ja=K[0].clone();K.reduce((cd,
Kd)=>{cd.union(Kd);return cd},ja);var ub={sheetId:jb.a.nZ(this.Qb.ja),columnId:ob,F5k:ja,Ngg:[Jc]}}}this.u5a.set(Ta,ub);this.mtb.set(Ta,window.setTimeout(()=>{this.u5a.has(Ta)&&(this.u5a.delete(Ta),this.mtb.delete(Ta),Ma.ULS.sendTraceTag(508036640,0,50,`FormulaByExampleSignalLocksManager.onSignalSent: pending lock timed out, deleting lock for column ${ub.columnId}`))},2E4))}};this.T3j=Ta=>{const ob=this.mtb.get(Ta);ob&&(window.clearTimeout(ob),this.mtb.delete(Ta));this.u5a.has(Ta)&&(Ma.ULS.sendTraceTag(508036639,
0,50,`FormulaByExampleSignalLocksManager.onFormulaFound: pending lock found and deleted for column ${this.u5a.get(Ta).columnId}`),this.u5a.delete(Ta))};this.U3j=Ta=>{const ob=this.mtb.get(Ta);ob&&(window.clearTimeout(ob),this.mtb.delete(Ta));if(Ta=this.u5a.get(Ta))this.iPa.set(Ta.columnId,Ta),Ma.ULS.sendTraceTag(508036638,0,50,`FormulaByExampleSignalLocksManager.onFormulaNotFound: pending lock found, column locked: ${Ta.columnId}`),this.Hgh()};this.onBlockCacheItemChanged=(Ta,ob)=>{ob=ob.Ud.block;
Ta=ob.od;ob=this.K_i(Ta,jb.a.nZ(ob.ja));for(const K of ob){ob=K.Ngg;for(const ja of ob)if(ja.Mgg.$c(Ta)){ob=ja.Mgg.clone().Qe(Ta);ob=this.Qb.eua("FormulaByExampleSignalLocksManager.onBlockCacheItemChanged",ob);try{for(;ob.$$mn();){const ub=ob.$$cu(),Cb=ub.Nh.value,Jc=Ic(ub.range);ja.s$d.has(Jc)&&ja.s$d.get(Jc)!==Cb&&(this.iPa.delete(K.columnId),Ma.ULS.sendTraceTag(508036637,0,50,`FormulaByExampleSignalLocksManager.onBlockCacheItemChanged: existing lock's rows content changed, column unlocked: ${K.columnId}, columnChanged: ${ub.range.left}`),
this.Hgh())}}finally{ob&&ob.dispose()}}}}}Stj(W){return this.iPa.has(W)}Hgh(){!this.Bsc&&0<this.iPa.size?(this.Qb.su(this.onBlockCacheItemChanged),this.Qb.Qeb(this.onBlockCacheItemChanged),this.Bsc=!0):this.Bsc&&0===this.iPa.size&&(this.Qb.$u(this.onBlockCacheItemChanged),this.Qb.M6b(this.onBlockCacheItemChanged),this.Bsc=!1)}K_i(W,Ta){const ob=[];for(const K of this.iPa.values())K.sheetId===Ta&&K.F5k.$c(W)&&ob.push(K);return ob}};xd=(0,Ba.__decorate)([(0,yc.d)(Mc.afc),(0,Ba.__param)(0,(0,Mc.W$a)())],
xd);(0,ya.a)(xd,"FormulaByExampleSignalLocksManager",null,[358]);var Vd=a(72320),ae=a(63584),Ke=a(69568),Oe=a(89040);(0,yc.b)(Mc.bfc,{Sd:"singleton"})(async W=>{const [Ta,ob,K]=await Promise.all([yc.a.resolve(Mc.ra,W),yc.a.resolve(Mc.Zq,W),yc.a.resolve(Mc.Rl,W)]);W=Ga.f(Ta);return new cf(W,W.vJ,K,ob)});class cf{constructor(W,Ta,ob,K){this.U=W;this.vJ=Ta;this.Wd=ob;this.Ge=K;this.UOb=[];this.kJd=[]}async Z2k(W,Ta,ob,K,ja,ub=!1){if(this.vJ.isActive)return nf("PreviewAlreadyShowing");let Cb;if(ja)Cb=
ja;else{ja=await this.HAf(Ta,W,ob,!0,void 0);if(!ja.success)return ja.error;Cb=ja.results}ja=this.Qgh(Cb);if(!ja.success)return nf("StrictDataMismatch",ja.r6b);if(!this.w8c(Cb).isSuccess)return nf("WorkbookModelUpdateFailed");ja=Cb.results.find(Jc=>"Success"===Jc.kind&&Jc.value.cell.row+1===this.U.da.la.activeCell.top&&Jc.value.cell.col+1===this.U.da.la.activeCell.left);if(!ja)return nf("FailedToPreviewActiveCell");try{const Jc=await this.vJ.P5(Ta,cd=>this.yUb(cd,W,ob,Ta,!0,!0,Jc,K),{PreviewCellsRange:{FirstRow:Ta.top,
FirstColumn:Ta.left,LastRow:Ta.bottom,LastColumn:Ta.right},RetainCellTextOnPreview:!0},this.U.Jb.isEditing?{iM:Xf(ja.value).toString(),z3c:ub}:void 0);Jc.hwd(()=>{this.w8c(Cb,!1)});void Jc.d8b.then(cd=>{"ACCEPT"===cd.y_&&this.w8c(Cb,!0)});return{success:!0,dx:Jc}}catch(Jc){return nf("InternalPreviewError",Jc)}}async HAf(W,Ta,ob,K,ja){W=W.Qe(this.U.Hk);if(!W)return{success:!1,error:nf("RangeNotLoaded")};const ub=await this.Wd.O2(null,W,ob,Ta,!0);if(!this.kLc(ub))return{success:!1,error:nf("InvalidCalcResults")};
const Cb=this.wAf(ub);return 0===Cb.size||1===Cb.size&&Cb.has("Unavailable")?{success:!0,results:ub}:K?this.dwi(Cb,Ta,ja,W,ob):{success:!1,error:nf("ErrorsInEvaluation",Cb)}}async dwi(W,Ta,ob,K,ja){if(!(1===W.size&&W.has("PreviousFailure")||2===W.size&&W.has("PreviousFailure")&&W.has("Unavailable")))return{success:!1,error:nf("ErrorsInEvaluation",W)};W=this.Dlh(ob);Ta=await this.Wd.O2(W,K,ja,Ta,!0);if(!this.kLc(Ta))return{success:!1,error:nf("InvalidCalcResults")};K=this.wAf(Ta);return 0===K.size||
1===K.size&&K.has("Unavailable")?{success:!0,results:Ta}:{success:!1,error:nf("ErrorsInEvaluation",K)}}yUb(W,Ta,ob,K,ja,ub,Cb,Jc){const cd=W.Ud.block,Kd=K.Qe(cd.od);if(!Kd)return!1;this.UOb.push(cd);this.kJd.push(Kd);this.N2f&&!this.N2f.contains(Kd)&&this.SIh(Kd);void Cb.d8b.then(()=>{this.CNg(Kd)});const ne=async()=>{const Ve=await this.n_j(Ta,ob,ja,ub);Jc?.(W,Ve);this.Wd.Q6b(ne)};this.Wd.OIb(ne);return!1}SIh(W){this.Pjf(W,!0)}CNg(W){this.Pjf(W,!1)}Pjf(W,Ta){for(let K=W.top;K<=W.bottom;K++)for(let ja=
W.left;ja<=W.right;ja++){var ob=wb.Range.pc(K,ja);if(ob=this.U.Db(ob))ob.cell.WAe=Ta&&!ob.cell.iM}}async n_j(W,Ta,ob,K){if(!this.UOb.length)return null;const ja=()=>{this.UOb=[];this.kJd=[]},ub=this.kJd.reduce((Cb,Jc)=>{Cb.union(Jc);return Cb});W=await this.HAf(ub,W,Ta,K,this.UOb.map(Cb=>Cb.od));if(!W.success)return ja(),nf("ErrorsInEvaluation",W.error);if(ob&&!this.Qgh(W.results).success)return ja(),nf("StrictDataMismatch");ob=this.w8c(W.results);if(!ob.isSuccess)return ja(),nf("WorkbookModelUpdateFailed");
this.CNg(ub);if(ob.isDirty)for(const Cb of this.UOb)this.vJ.a1b(Cb);ja();return null}w8c(W,Ta=!1){let ob=!1;for(const Jc of W.results){if(!(0,Vd.a)(Jc)){if("Unavailable"===Jc.reason.kind)continue;return{isSuccess:!1,isDirty:ob}}if(W=this.U.Db(qf(Jc.value.cell)))if(Ta)W.cell.text=W.cell.iM,W.cell.f5b?.HorizontalAlignment&&W.cell.WW(W.cell.f5b.HorizontalAlignment,!0,!0);else{var K=Jc.value.formatted,ja=Of(Jc.value.value.kind);K=this.Ge.K8(K,ja,Ke.a,W);if((0,ae.c)(K)){ja=W.cell;if(ja.M5a){var ub=ja.M5a;
var Cb=K.value.numFmt;ub=ub.Start===Cb.Start&&ub.End===Cb.End&&ub.Separator===Cb.Separator}else ub=ja.iM===K.value.text;ub||(ob=!0);ja.iM=K.value.text;ja.M5a=K.value.numFmt;ub=W.Nh.type===je.e.Number?parseFloat(W.Nh.value):W.Nh.value;Cb=Xf(Jc.value);ja.mSg=Cb===ub;ja.f5b={HorizontalAlignment:W.cell.horizontalAlignment===je.k.Automatic?K.value.horizontalAlignment:null,VerticalAlignment:je.F.Top,ID:0,RefCount:0,GlobalId:0,BackgroundColor:null,Gradient:null,IsPattern:!1,Indentation:0,ReadingOrder:null,
ShrinkToFit:!1,NamedStyleId:0,FontID:0,GlobalFontID:0,IsUnlocked:!1,IsHidden:!1,VerticalText:!1,Orientation:0,PatternStyle:null,PatternColor:null}}else return{isSuccess:!1,isDirty:ob}}}this.N2f=void 0;return{isSuccess:!0,isDirty:ob}}Qgh(W){const Ta=new Set;W=W.results;for(const [K,ja]of W.entries()){if(!(0,Vd.a)(ja)){var ob=qf(ja.reason.cell);if(this.U.Oc.Uea(ob)){W.splice(K,1);Ta.add("Contains hidden rows");continue}if(!this.U.az(ob)){W.splice(K,1);Ta.add("Contains unavailable cells outside of view");
continue}return{success:!1,r6b:["Unexpected unavailable cell"]}}ob=ja.value;const ub=this.U.Db(qf(ob.cell));if(!ub)continue;const Cb=ub.Nh.type;if(Cb!==je.e.None)if(Cb===je.e.String){if(2!==ob.value.kind||ob.value.value!==ub.Nh.value)return{success:!1,r6b:["String value mismatch"]}}else{if(Cb===je.e.Number&&(1!==ob.value.kind||ob.value._valueXL!==parseFloat(ub.Nh.value)))return{success:!1,r6b:["Number value mismatch"]};if(Cb===je.e.Error&&(8!==ob.value.kind||ob.value.type!==parseFloat(ub.Nh.value)))return{success:!1,
r6b:["Error value mismatch"]}}}return{success:!0,r6b:Array.from(Ta)}}Dlh(W){const Ta=[];for(const ob of W){W=new Oe.a("FormulaColumnPreviewManager.GenerateConstantCellsCloneWrites",this.U,ob);try{for(;W.moveNext();){const K=W.get_current();Ta.push({row:K.cell.mD,column:K.cell.LG,Nh:K.Nh,formulaBarText:K.Nh.value,text:K.cell.text,$h:K.cell.$h})}}finally{W&&W.dispose()}}return Ta}wAf(W){const Ta=new Set;W=W.results;for(const ob of W)(0,Vd.a)(ob)||Ta.add(ob.reason.kind);return Ta}kLc(W){return(W=W.results)&&
W.length?!0:!1}}(0,ya.a)(cf,"FormulaColumnPreviewManager",null,[364]);const nf=(W,Ta)=>({success:!1,error:{kind:W,data:Ta}}),qf=W=>new wb.Range(W.row+1,W.col+1,W.row+1,W.col+1,!0,!0),Of=W=>{switch(W){case 1:return je.e.Number;case 2:return je.e.String;case 8:return je.e.Error;case 4:return je.e.Boolean;default:return je.e.None}},Xf=W=>{W=W.value;return 1===W.kind?W._valueXL:8===W.kind?kb.a.Ajb[W.type-1]:W.value};var ng=a(86608),Ig=a(65360),Dg=a(73647);(0,yc.b)(Mc.pX,{Sd:"singleton"})(async W=>{W=
await yc.a.resolve(Mc.ra,W);return new ab(W)});class ab extends ng.a{constructor(W){super();this.yuh=[];this.dLf={};this.yQd={};this.W0=null;this.xia=[];this.wZa={};this.u3d=this.vkd=!1;this.tug=(Ta,ob)=>{Ma.ULS.sendTraceTag(537161987,0,50,"FunctionInfoManager.OnGetFunctionListPartialSucceeded");this.eug(Ta,!!ob&&1!==ob.FilterType,!0)};this.sug=()=>{Ma.ULS.sendTraceTag(537161986,0,50,"FunctionInfoManager.OnGetFunctionListPartialFailed -  reset varaible to ensure we will re-issue the webservice call");
this.W0=null};this.dug=Ta=>{Ma.ULS.sendTraceTag(537161985,0,50,"FunctionInfoManager.OnFullFunctionListLoaded - full list was loaded");this.roe(Ta.yva,!0,!1)};this.rug=Ta=>{Ma.ULS.sendTraceTag(537161984,0,50,"FunctionInfoManager.OnGetFunctionListFullSucceeded");this.eug(Ta,!0,!1)};this.Fb=W}cqc(W){this.addHandler("FunctionInfoLoaded",W)}iqe(W){this.removeHandler("FunctionInfoLoaded",W)}get uma(){return this.vkd}get aLf(){return this.W0}get XCc(){return this.xia}get J(){return this.Fb}dispose(){const W=
yc.a.kb(Mc.ov);W&&W.jqe(this.dug);this.Fb=null;super.dispose()}lse(){this.vkd=!1;this.W0=null;this.u3d=!0;this.tjb(null)}tjb(W,Ta=!1){if(this.uma)this.EIg();else{Ma.ULS.sendTraceTag(537161991,0,50,`Retrieving the list of function names for culture '${this.J.pa.UICultureTag}' from the server.`);let K=null;(K=yc.a.kb(Mc.ov))||Ma.ULS.sendTraceTag(537161990,0,50,"instantaneousSupportInformationManager == null");if(K?.yva&&0<K.yva.length)Ya.EwaSettings.Ua(114)?K.tKi(this.rug):this.roe(K.yva,!0,!1);else{var ob=
this.J.ia.oa.Yb();W&&(this.J.Z.qc||Ta)&&!this.u3d&&(Ta?Ig.a(this.J.Ba,(ja,ub,Cb)=>Ud.o(this.J.ia.oa,W,Dg.c(ja,this.tug),Dg.b(ub,this.sug),Cb,W,ob),ja=>new La.a(130,0,ja,16),null):Ud.o(this.J.ia.oa,W,this.tug,this.sug,null,W,ob));!this.uma&&this.J.Z.qc&&(K?(Ma.ULS.sendTraceTag(537161989,0,50,`FunctionInfoManager.EnsureFunctionInfoAsync - Functions not loaded yet, wait for them. IsFullyLoaded=${this.uma}, IsSessionActive=${this.J.Z.qc}`),K.B$e(this.dug)):(Ma.ULS.sendTraceTag(537161988,0,50,"FunctionInfoManager.EnsureFunctionInfoAsync - instantaneousSupportInformationManager is null"),
Ud.o(this.J.ia.oa,{FilterType:0},this.rug,null,null,null,ob),this.u3d=!1))}}}fQf(W){return 0>W||W>=this.W0.length?null:this.W0[W]}gQf(W){return xc.a.Cd(this.yQd,W.toUpperCase())}Dlb(W){return xc.a.Cd(this.wZa,W)}e8f(W){return!W.GroupUI}eug(W,Ta,ob){const K=ud.a(W);Ma.ULS.sendTraceTag(537161955,0,50,`FunctionInfoManager.OnFunctionListSucceeded: areNonStatusMessagesPresentInResult=${K}`);K?(Ga.f(this.J).endEdit(!1,"FunctionInfoManager.OnFunctionListSucceeded"),this.J.Z.Gr(W.Errors)):this.roe(W.Result,
Ta,ob)}roe(W,Ta,ob){Ma.ULS.sendTraceTag(537161954,0,50,`FunctionInfoManager.RefreshFunctionList: functionsInfo count = ${W.length}, isCategorized = ${Ta}, partialResult = ${ob} IsFullyLoaded = ${this.uma}`);this.uma||(this.W0=W,this.cXh(Ta),this.vkd=!ob,this.EIg())}EIg(){this.raiseEvent("FunctionInfoLoaded")}cXh(W){var Ta=Lc.a.instance.ea(1032),ob=[];this.wZa={};this.xia=[];this.wZa[Ta]=ob;const K=Lc.a.instance.ea(1033),ja=[];this.xia.push(Ta);this.xia.push(K);for(let Cb=0,Jc=this.W0.length;Cb<Jc;Cb++){Ta=
this.W0[Cb];Ta.IsCompatibility||ja.push(Ta);var ub=Ta.NameUI;const cd=Ta.NameDataStrings;this.dLf[cd.toUpperCase()]||(this.dLf[cd.toUpperCase()]=Ta);this.yQd[ub.toUpperCase()]||(this.yQd[ub.toUpperCase()]=Ta);if(!this.e8f(Ta)){if(W){ub=Ta.GroupUI;let Kd=xc.a.Cd(this.wZa,ub);Kd||(Kd=[],this.wZa[ub]=Kd,this.xia.push(ub));Kd.push(Ta)}Ta.IsCommonlyUsed&&ob.push(Ta);Ta.IsCompatibility||this.yuh.push(cd)}}this.wZa[K]=ja;W&&(ab.wMg(ob,[2,3,0,5,4,9,1,7,8,6]),ob=Array(14),ob[0]=0,ob[1]=1,ob[2]=7,ob[3]=11,
ob[4]=5,ob[5]=2,ob[6]=6,ob[7]=10,ob[8]=9,ob[9]=3,ob[10]=4,ob[11]=13,ob[12]=12,ob[13]=8,ab.wMg(this.xia,ob),ob=[],ob.push(...this.xia),ob.splice(13,1),this.xia=ob);ob=(Cb,Jc)=>Cb.NameUI.localeCompare(Jc.NameUI);this.W0=[...this.W0];this.W0.sort((Cb,Jc)=>Cb.NameDataStrings.localeCompare(Jc.NameDataStrings));for(let Cb=1,Jc=this.xia.length;Cb<Jc&&W;Cb++)this.wZa[this.xia[Cb]].sort(ob);for(let Cb=0,Jc=this.W0.length;Cb<Jc;Cb++)this.W0[Cb].FunctionIndex=Cb}static wMg(W,Ta){const ob=[...W];for(let K=0;K<
ob.length&&K<Ta.length;K++)W[K]=ob[Ta[K]]}}(0,ya.a)(ab,"FunctionInfoManager",ng.a,[359,360,2]);const Va=(W,Ta,ob,K)=>(ja,ub,Cb)=>{const Jc=Ga.f(W),cd=W.ia.oa.Yb();ja=Dg.c(ja,$c(ob,K));ub=Dg.b(ub,le(K));return W.ma.ja?Ud.w(W.ia.oa,Ta,W.ma.ja.name,ja,ub,Cb,Jc,cd):Ud.x(W.ia.oa,Ta,-1,ja,ub,Cb,Jc,cd)},$c=(W,Ta)=>ob=>{ud.a(ob)?Ta(ob):(ob=ob.Result,ob=Sb.n(ob.Ranges[0],ob.SheetName),W(ob))},le=W=>Ta=>{W(Ta)};class We{constructor(W){this.pluginScheduler=W;this.Wfc=new bf;this.h1c=new Map}async q6j(W){W=this.p6j(W);
let Ta;const ob=new Promise(K=>{Ta=window.setTimeout(()=>{Ma.ULS.sendTraceTag(507127896,0,15,"GotoCtrlClickRequester.onHoverRequestWithTimeout: request timed out after 1000ms");K({kind:Fc.bE.Failure})},1E3)});return Promise.race([W,ob]).finally(()=>{window.clearTimeout(Ta)})}async p6j(W){var Ta=this.Wfc.get(W.index);if(Ta)return Ta;Ta=await this.pluginScheduler.requester().gotoCtrlClick(W,Fc.Nha.Excel,null);if("Done"!==Ta.kind)return"Superseded"===Ta.kind&&this.Wfc.delete(W.index),null;W=Ta.payload;
if((0,vd.c)(W))return{kind:Fc.bE.Failure};switch(W.kind){case Fc.bE.RangeResolutionFailure:case Fc.bE.NoReferenceFound:case Fc.bE.Failure:return W;case Fc.bE.ReferenceFound:return this.Wfc.set(W.span,W),W;default:return Ma.ULS.sendTraceTag(507339545,0,15,"GotoCtrlClickRequester.request: unexpected GotoCtrlClickResultKind"),null}}R6i(W,Ta,ob,K){this.h1c.has(Ta)?ob(this.h1c.get(Ta)):z(W,Ta,ja=>{this.h1c.set(Ta,ja);ob(ja)},K)}clearCache(){this.Wfc.clear();this.h1c.clear()}}(0,ya.a)(We,"GotoCtrlClickRequester",
null,[]);class bf{constructor(){this.map=new Map}D5k(W){return JSON.stringify({start:W.start,end:W.end})}L6g(W){const {start:Ta,end:ob}=JSON.parse(W);return{start:Ta,end:ob}}get(W){for(const Ta of this.map.keys()){const ob=this.L6g(Ta);if(W>=ob.start&&W<=ob.end)return this.map.get(Ta)}}set(W,Ta){W=this.D5k(W);this.map.set(W,Ta);return this}delete(W){for(const Ta of this.map.keys()){const ob=this.L6g(Ta);if(W>=ob.start&&W<=ob.end)return this.map.delete(Ta)}return!1}clear(){this.map.clear()}}(0,ya.a)(bf,
"RequestCache",null,[]);class xf{constructor(W,Ta,ob,K){this.J=W;this.OMa=Ta;this.hP=ob;this.HSc=K;this.E4a=ja=>{this.hP(ja)};this.F4a=(ja,ub)=>{switch(ub.state){case 0:(ub=this.getSelection(ub.event,ja))?(this.rHd=ub,this.OMa(ja,ub)):(this.oXb=void 0,this.Duc());break;case 1:this.Duc();this.hP(ja);break;case 2:break;default:return ub}};this.QSc=ja=>{this.oXb!==ja.ctrlKey&&(this.oXb=ja.ctrlKey,this.HSc(this.oXb))};this.U=(0,Ga.f)(this.J);this.editBox=this.U.cellTextEditBox;this.formulaBar=(0,ma.a)(this.J);
this.si()}Duc(){this.rHd=void 0}dispose(){this.Dh()}NFe(){const W=this.U.vj,Ta=W.Ya.selection;this.HSc(!0);this.onSelectionChange(W,Ta)}si(){this.editBox.XIb(this.F4a);this.editBox.TIb(this.E4a);this.formulaBar.XIb(this.F4a);this.formulaBar.TIb(this.E4a);document.addEventListener("keyup",this.QSc,{capture:!0});document.addEventListener("keydown",this.QSc,{capture:!0})}Dh(){this.editBox.V6b(this.F4a);this.editBox.Yub(this.E4a);this.formulaBar.V6b(this.F4a);this.formulaBar.Yub(this.E4a);document.removeEventListener("keyup",
this.QSc,{capture:!0});document.removeEventListener("keydown",this.QSc,{capture:!0})}onSelectionChange(W,Ta){this.N2c(Ta)&&this.OMa(W,Ta,!0)}getSelection(W,Ta){W=new Sys.UI.Point(W.clientX,W.clientY);Ta=A(W,Ta.Ya.ig);if(!Ta||-1===Ta)return null;Ta={index:Ta,length:0};return this.N2c(Ta)?Ta:null}N2c(W){return!this.rHd||!this.Jvi(this.rHd,W)}Jvi(W,Ta){return W.index===Ta.index&&W.length===Ta.length}}(0,ya.a)(xf,"GotoCtrlClickHandler",null,[2]);var Lf;(function(W){W.client="client";W.server="server"})(Lf||
(Lf={}));(0,ya.b)("ResultOrigin",Lf);const ag=[50,80,100,130,150,170,200];class Qf{constructor(W){this.J=W;this.mR=null;this.usage={};this.t_c={};this.performance={};this.Una=-1;this.Yc=(Ta,ob)=>{ob.dg||ob.bob||this.J.sendBeaconTraceTag(104412034,50,!1,this.Wbc())};this.editBox=(0,Ga.f)(this.J).Jb;W.Dj(this.Yc)}static getInstance(W){return Qf.instance||(Qf.instance=new Qf(W))}eXf(W){(0,vd.c)(this.mR)||((0,vd.c)(this.t_c[this.mR])&&(this.t_c[this.mR]={success:0,error:0}),this.t_c[this.mR][W?"success":
"error"]++,this.ERj(W),this.mR=null)}setResult(W,Ta){Ta=this.OWd(Ta);switch(W.kind){case Fc.bE.NoReferenceFound:Ta.noRef++;break;case Fc.bE.ReferenceFound:Ta.resolvedRef++;break;case Fc.bE.RangeResolutionFailure:Ta.unresolvedRef++;break;case Fc.bE.Failure:Ta.failure++}}ibj(W,Ta){this.Una=Rb.e6c;this.mR=Ta;this.OWd(W).click++}formatApplied(W){this.OWd(W).formatApplied++}ERj(W){if(-1!==this.Una){var Ta=this.mR??"cache";this.GTb(`${Ta}_request`).G2(W,this.Una);var ob=this.GTb(`${Ta}_overall`);window.requestAnimationFrame(()=>
{ob.G2(W,this.Una)});this.Una=-1}}OWd(W){W=W===this.editBox?"cellEditor":"formulaBar";(0,vd.c)(this.usage[W])&&(this.usage[W]={noRef:0,resolvedRef:0,unresolvedRef:0,failure:0,formatApplied:0,click:0});return this.usage[W]}GTb(W){return this.performance[W]=this.performance[W]||new Rb(ag)}Wbc(){const W={};Object.keys(this.performance).forEach(Ta=>{this.performance[Ta].mOd();var ob=this.performance[Ta];W[Ta]={metrics:ob.u_,durations:ob.Zib}});return`{"usage":${JSON.stringify(this.usage)},"resultSourceCount":${JSON.stringify(this.t_c)},"performance":${JSON.stringify(W)}}`}}
(0,ya.a)(Qf,"GotoCtrlClickTelemetry",null,[]);const Kg={underline:!0,bold:!0};class Ag{constructor(W){this.J=W;this.zCg=void 0}dispose(){this.hide()}show(W,Ta){W={...Ta,Fv:W};this.qPa(W)&&(this.apa(W)&&this.hide(),this.jr=W,this.mRh())}hide(){this.jr&&(this.jxk(),this.jr=void 0)}qPa(W){var Ta;if(!(Ta=!this.jr)){Ta=this.jr;if(Ta===W)W=!0;else if(Ta&&W&&Ta.Fv===W.Fv&&Ta.kind!==W.kind)if(Ta.kind===Fc.bE.ReferenceFound&&W.kind===Fc.bE.ReferenceFound){var ob=Ta.sheetRange,K=W.sheetRange;W=!!ob&&!!K&&ob.sheetName===
K.sheetName&&ob.firstColumn===K.firstColumn&&ob.firstRow===K.firstRow&&ob.lastRow===K.lastRow&&ob.lastColumn===K.lastColumn&&ob.namedObjectName===K.namedObjectName&&Ta.span.start===W.span.start&&Ta.span.end===Ta.span.end}else W=!0;else W=!1;Ta=!W}return Ta}apa(W){var Ta;if(Ta=this.jr)Ta=this.jr,Ta=!(Ta.Fv===W.Fv&&Ta.span.start===W.span.start&&Ta.span.end===W.span.end);return Ta}mRh(){const W=this.jr.Fv,Ta=this.jr.span;this.zCg=W.Ya.getFormattedText();W.Ya.formatText(Ta.start,Ta.end-Ta.start,Kg);W.Ya.style.cursor=
"pointer";Qf.getInstance(this.J).formatApplied(W)}jxk(){const W=this.jr.Fv,Ta=this.jr.span,ob=W.text;ob.length<Ta.end?Ma.ULS.shipAssertTag(507339544,0,!1,`GotoCtrlClickControl.removeGotoFormat - unexpected editor state: ${ob.length}:${Ta.start}:${Ta.end}`):(W.isEditing?this.EQk(W):W.Ya.setFormattedText(this.zCg),W.Ya.style.cursor="text")}EQk(W){W=W.Ya;W.$I=!0;const Ta=W.selection,ob=Ta.index,K=W.text.length;W.selectRange(Math.min(ob,K),Math.min(ob+Ta.length,K));this.jr.Fv.hX(null);W.$I=!1}showCallout(W){const Ta=
new oc.a(-847286761,tc.a.xb,W.jc,0,null);W.Ga.vb(Ta,{["CalloutName"]:24})}}(0,ya.a)(Ag,"GotoCtrlClickControl",null,[2]);var Og=a(8258);let eg=class{constructor(W,Ta,ob){this.J=W;this.pluginScheduler=Ta;this.U=ob;this.OMa=async(K,ja,ub)=>{this.UNb=K;this.$wc=Og.a.instance.gf(K.Ya.domElement);this.$wc.Qa("mouseup",this.mP);this.$wc.Qa("mousedown",this.bM,!0);await this.Gmk({text:K.text,index:ja.index,length:ja.length},this.requester.q6j.bind(this.requester),K);ub&&this.o3f()};this.hP=()=>{this.reset()};
this.HSc=K=>{(this.oXb=K)&&this.OXa?.kind===Fc.bE.ReferenceFound?this.show(this.fl.Fv,this.OXa):this.hide()};this.qej=async K=>{this.OXa=K;const ja=this.fl.Fv;switch(K.kind){case Fc.bE.RangeResolutionFailure:case Fc.bE.Failure:this.hide();Ma.ULS.sendTraceTag(507339546,0,15,`GotoCtrlClick.handleResult: Request Failed with error: ${Fc.bE[K.kind]}`);break;case Fc.bE.NoReferenceFound:this.hide();break;case Fc.bE.ReferenceFound:this.control.showCallout(this.J);this.oXb&&this.show(ja,K);break;default:return K}Qf.getInstance(this.J).setResult(K,
ja)};this.mP=K=>{K.ctrlKey&&this.OXa?.kind===Fc.bE.ReferenceFound&&this.o3f()};this.bM=K=>{K.ctrlKey&&(K.preventDefault(),K.stopPropagation())};this.eRg=K=>{this.UNb.isEditing&&this.UNb.endEdit(!0,"GotoCtrlClick.resetAndPerformGoto",1);this.reset();this.U.ij(K,null,null,null,60,"GotoCtrlClick");Qf.getInstance(this.J).eXf(!0)};this.nak=()=>{Ma.ULS.sendTraceTag(507331928,0,15,"GotoCtrlClick.onServerOperationFailure: Request Failed");Qf.getInstance(this.J).eXf(!1)};this.reset=()=>{this.hide();this.UNb=
this.OXa=this.fl=void 0;this.$wc?.DI();this.$wc=void 0;this.handler.Duc();this.requester.clearCache()};this.kz=()=>{this.handler.Duc();this.requester.clearCache()};this.control=new Ag(this.J);this.requester=new We(this.pluginScheduler);this.handler=new xf(this.J,this.OMa,this.hP,this.HSc);this.si()}dispose(){this.Dh();this.handler.dispose();this.control.dispose()}NFe(){this.handler.NFe()}si(){this.U.Jb.fr(this.reset);this.U.da.eFa(this.reset);this.J.Z.fG(this.kz)}Dh(){this.U.Jb.rq(this.reset);this.U.da.Oza(this.reset);
this.J.Z.jH(this.kz)}async Gmk(W,Ta,ob){this.fl=ob={...W,Fv:ob};W=await Ta(W);!(0,vd.c)(W)&&this.I5d(ob)&&await this.qej(W)}o3f(){if(this.OXa?.kind===Fc.bE.ReferenceFound){var W=Sb.n1f(this.OXa.sheetRange),Ta=W?"client":"server";Qf.getInstance(this.J).ibj(this.UNb,Ta);W?this.eRg(W):(W=this.OXa.span,this.requester.R6i(this.J,this.UNb.text.substring(W.start,W.end),this.eRg,this.nak))}}show(W,Ta){this.control.show(W,Ta)}hide(){this.control.hide()}I5d(W){return this.fl?this.fl.text===W.text&&this.fl.index===
W.index&&this.fl.length===W.length&&this.fl.Fv===W.Fv:!1}};eg=(0,Ba.__decorate)([(0,yc.d)(Mc.HAb),(0,Ba.__param)(0,(0,Mc.ra)()),(0,Ba.__param)(1,(0,Ca.c)()),(0,Ba.__param)(2,(0,Mc.ej)())],eg);(0,ya.a)(eg,"GotoCtrlClick",null,[2]);let Ug=class{constructor(W){this.gotoCtrlClick=W}Rc(){return!1}executeCommand(W,Ta){W=!1;Ta=Ta.command;switch(Ta){case -985391800:this.gotoCtrlClick.NFe(),W=!0}return W?Qc.Task.Xa(!0):lc.a(Ta)}Ec(W,Ta){return-985391800===Ta.command}Zc(){return!1}};Ug=(0,Ba.__decorate)([(0,
yc.d)(Mc.vad),(0,Ba.__param)(0,(0,Mc.HAb)())],Ug);(0,ya.a)(Ug,"GotoCtrlClickCommandHandler",null,[50]);(0,yc.b)(Mc.Ead,{Sd:"singleton"})(async()=>wg);const wg=async(W,Ta)=>{if(G(W)&&G(Ta)){var ob=F(W),K=F(Ta);Ta=await P(ob);W=await P(K);{const ja=B(ob.value,K.value);"different"!==ja.kind?ob=ja:(ob=B(ob.unformattedValue,K.unformattedValue),ob={kind:"different",diff:ja.diff,unformatted:ob})}Ta={cse:Ta,immediate:W,diagnostic:ob,cellValueFix:Ya.EwaSettings.iKc()};Ma.ULS.sendTraceTag(507646813,1,20,`ImmediateCellComparison.compareCells, result: ${JSON.stringify(Ta)}`)}};
let Pg=class{constructor(W,Ta){this.J=W;this.clearContentNotifier=Ta;this.keptData={suggestionsKept:0,suggestionsCommitted:0,suggestionsChanged:0,suggestionsReverted:0,suggestionsDeleted:0};this.ng=(ob,K)=>{this.pgh()&&K.committed&&K.Gj.equals(this.Zxa.suggestion.Gj)&&this.Zxa.suggestion.cellText!==K.cellText&&this.keptData.suggestionsChanged++};this.Kya=()=>{if(this.pgh()){var ob=this.Zxa?.suggestion.Gj;this.U.da.la.selectedRanges.some(K=>K.contains(ob))&&this.keptData.suggestionsDeleted++}};this.J4=
(ob,K)=>{0===K.Tq&&(170===K.Wf.operation.operationName&&this.keptData.suggestionsReverted++,this.J.Ba.kn(this.J4))};this.U=Ga.f(this.J)}PTd(){this.keptData.suggestionsKept=this.SZi();return this.keptData}zAg(W){this.keptData.suggestionsCommitted++;this.Zxa={suggestion:W,stateId:this.J.Z.Ee};this.si()}si(){this.U.cellTextEditBox.fr(this.ng);this.clearContentNotifier.MIb(this.Kya);this.J.Ba.Up(this.J4)}Dh(){this.U.cellTextEditBox.rq(this.ng);this.clearContentNotifier.P6b(this.Kya)}pgh(){this.Dh();if(null!==
this.Zxa&&1===this.J.Z.Ee-this.Zxa.stateId)return!0;this.Zxa=null;return!1}SZi(){return this.keptData.suggestionsCommitted-(this.keptData.suggestionsChanged+this.keptData.suggestionsDeleted+this.keptData.suggestionsReverted)}};Pg=(0,Ba.__decorate)([(0,yc.d)(Mc.nRa,{Sd:"transient"}),(0,Ba.__param)(0,(0,Mc.ra)()),(0,Ba.__param)(1,(0,Mc.gqa)())],Pg);(0,ya.a)(Pg,"KeptTelemetryHandler",null,[]);const Gg="PrefetchNotStarted;PrefetchResultCleared;Ctor;EvalInProgress;ResultUnavailable;RangeNotFoundInPrefetchResult;FinalizeNumberFormattedValueFailed;EvalOnCloneFailed;EvalFormulaRangeOnClonedModelFailed;SetCellPrefetchPluginFailed;SetCellPrefetchPluginRequestFailed;Invalid input to Plugin;SetCellPrefetchPlugin: getValueFromCellValue failed;SetCellPrefetchPlugin GetActiveCellFormat result or value is null;SetCellPrefetchPlugin EvalOnCloneResult failed;offScreenCanvasRender: renderValue failed;offScreenCanvasRender: renderHashesValue failed;Invalid OperKind;UndefinedCell;UnsupportedNonEditMode;EvalAborted-NullActiveCell;DebouncedScheduled;EvalAborted-NullLoc".split(";");
var gh;let fh=gh=class{constructor(W,Ta,ob,K){this.ot=ob;this.eIj=K;this.D1a=Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:8606468_FinalizeToPrefetchCG");this.K3=Ya.EwaSettings.iKc();this.$4b=Ya.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SetCellPrefetchPluginEnabled",!1);this.sbi=0;this.G1h=Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:9150789_CancelSuppressedRequests");this.Dna=()=>{this.$4b?this.hJ=(0,ae.a)({message:"PrefetchNotStarted"}):this.D1a?this.j4=(0,ae.a)({message:"PrefetchNotStarted"}):
this.wLa=(0,ae.a)({message:"PrefetchNotStarted"})};this.htg=(ja,ub)=>{ja=this.U.da.la.activeCell;var Cb=this.U.Db(ja);if(null!=Cb){var Jc=Cb.cell.$h;Cb=Cb.cell.CB.Hsc;var cd=this.U.J.activeItemName;this.$4b?this.prefetch({text:ub.text,range:ja,ifmt:Jc,stateId:Cb,sheetName:cd}):(this.hJ=(0,ae.a)({message:"DebouncedScheduled",key:{text:ub.text,range:ja,ifmt:Jc,stateId:Cb,sheetName:cd}}),this.ekk(ja,ub.text,Jc,Cb,cd))}};this.Wd=W;this.U=Ta;this.j4=(0,ae.a)({message:"Ctor"});this.wLa=(0,ae.a)({message:"Ctor"});
this.hJ=(0,ae.a)({message:"Ctor"});W=Ya.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.SetCellEstimationPrefetchMsDebounce",100);this.ekk=Ed.a((ja,ub,Cb,Jc,cd)=>this.prefetch({text:ub,range:ja,ifmt:Cb,stateId:Jc,sheetName:cd}),W);this.U.Jb.Tp(this.Dna);this.U.vj.TIb(this.htg)}dispose(){this.U.vj.Yub(this.htg);this.U.Jb.Kp(this.Dna);this.llf()}uNf(W){if((0,ae.b)(this.wLa))return(0,ae.a)(this.wLa.reason.message);if(gh.Wxd(W,this.wLa.value.key)){for(const Ta of this.wLa.value.results.results)if((0,
ae.c)(Ta)&&gh.cCj(W,Ta))return Ta;return(0,ae.a)("RangeNotFoundInPrefetchResult")}return(0,ae.a)("ResultUnavailable")}tNf(W,Ta){return this.$4b?(0,ae.b)(this.hJ)?(0,ae.a)(this.hJ.reason.message):gh.Wxd(W,this.hJ.value.key)?(0,ae.c)(this.hJ)?Ta?(0,ae.d)({key:this.hJ.value.key,cRb:void 0,evaluatedResult:this.hJ.value.evaluatedResult}):this.hJ:(0,ae.a)("RangeNotFoundInPrefetchResult"):(0,ae.a)("ResultUnavailable"):(0,ae.b)(this.j4)?(0,ae.a)(this.j4.reason.message):gh.Wxd(W,this.j4.value.key)?(0,ae.c)(this.j4)?
Ta?(0,ae.d)({key:this.j4.value.key,cRb:void 0,evaluatedResult:this.j4.value.evaluatedResult}):this.j4:(0,ae.a)("RangeNotFoundInPrefetchResult"):(0,ae.a)("ResultUnavailable")}llf(){this.$4b?this.hJ=(0,ae.a)({message:"PrefetchResultCleared"}):this.D1a?this.j4=(0,ae.a)({message:"PrefetchResultCleared"}):this.wLa=(0,ae.a)({message:"PrefetchResultCleared"})}prefetch(W){if(this.$4b)if(this.U.J.isEditMode){this.hJ=(0,ae.a)({message:"EvalInProgress",key:W});const Ta=this.U.Db(W.range);Ta?.cell?void this.eIj(1).then(ob=>
{if(Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:8910435_MoveActiveCellToPrefetcherPlugin")){var K=this.U.da.la.activeCell;if(K.top!==W.range.top||K.left!==W.range.left){this.hJ=(0,ae.a)({message:"EvalAborted-NullActiveCell",key:W});return}K=this.U.J.ma.getItemByName(W.sheetName);const ja=this.Wd.fNb(W.range,!1);if(!ja?.sheet){this.hJ=(0,ae.a)({message:"EvalAborted-NullLoc",key:W});return}ob.notifier().setActiveCell({colIndex:W.range.left-1,rowIndex:W.range.top-1,sheetIndex:$b.d(K),docPath:ja.sheet.document.path,
docName:ja.sheet.document.name})}K={text:W.text,textMaxWidth:Ta.cell.textMaxWidth,ifmt:W.ifmt,font:Ta.cell.k2};ob.requester().setCellPrefetch(K,Fc.Nha.Excel,this.G1h?(this.sbi++).toString():void 0)?.then(ja=>{"Done"===ja.kind&&ja.payload?this.nfj(W,ja.payload):this.hJ=(0,ae.a)({message:"SetCellPrefetchPluginFailed",key:W})})?.catch(ja=>{this.hJ=(0,ae.a)({message:"SetCellPrefetchPluginRequestFailed",key:W});Ma.ULS.sendTraceTag(507610177,0,50,`SetCellEstimationPrefetcher.prefetch: setCellPrefetch request rejected with error ${ja}`)})}):
this.hJ=(0,ae.a)({message:"UndefinedCell",key:W})}else this.hJ=(0,ae.a)({message:"UnsupportedNonEditMode",key:W});else this.D1a?this.j4=(0,ae.a)({message:"EvalInProgress",key:W}):this.wLa=(0,ae.a)({message:"EvalInProgress",key:W}),this.Wd.O2([],W.range,W.range,W.text,!0).then(Ta=>{if(this.D1a){var ob=this.U.Db(W.range);Ta=Ta.results[0];if("Success"===Ta.kind&&ob){const K=this.ot.ySb(Ta.value);let ja=void 0;this.K3&&(ja=this.ot.xSb(Ta.value,this.Wd.config.mathpack));ob=this.Wd.K8(Ta.value.formatted,
K,ob.cell.textMaxWidth,ob.cell.k2,W.ifmt,!1,ja);this.j4="Success"===ob.kind?(0,ae.d)({key:W,cRb:ob.value,evaluatedResult:Ta.value}):(0,ae.a)({message:"FinalizeNumberFormattedValueFailed"})}else this.j4=(0,ae.a)({message:"EvalOnCloneFailed"})}else this.wLa=(0,ae.d)({key:W,results:Ta})}).catch(Ta=>{this.j4=(0,ae.a)({message:"EvalFormulaRangeOnClonedModelFailed"});Ma.ULS.sendTraceTag(509219811,0,50,`SetCellEstimationPrefetcher.prefetch: evalFormulaRangeOnClonedModel promise rejected with error ${Ta}`)})}nfj(W,
Ta){if(Ta.failureMessage&&void 0!==Ta.failureMessage)this.QAj(Ta.failureMessage)&&(this.hJ=(0,ae.a)({message:Ta.failureMessage}));else{const ob={cell:{row:Ta.evaluatedResult.cell.firstRow,col:Ta.evaluatedResult.cell.firstColumn},value:Ta.evaluatedResult.value.value,formatted:Ta.evaluatedResult.formatted};Ta=this.jHi(W,ob,Ta.numberFormattedText);this.hJ=(0,ae.d)({key:W,cRb:Ta,evaluatedResult:ob})}}jHi(W,Ta,ob){const K=this.ot.ySb(Ta);var ja={units:Ta.formatted.units,color:Ta.formatted.color,alignment:Ta.formatted.alignment};
const ub=this.ot.JQf(ja),Cb=this.ot.UPf(ja),Jc=this.ot.TPd(Ta.formatted,ja);ja=excelOnlineCalc.numfmt.isHashesValue(ja);let cd=void 0;this.K3&&(cd=this.ot.xSb(Ta,this.Wd.config.mathpack));return{text:ob,valueType:K,fontColor:Cb,format:W.ifmt,horizontalAlignment:ub,numFmt:Jc,isHashesValue:ja,cellValue:cd}}QAj(W){const Ta=0<=Gg.findIndex(ob=>ob===W);if(!Ta)throw Error(`SetCellEstimationPrefetcher.handleSetCellResponse: failureMessage ${W} is not a valid failure message.`);return Ta}static Wxd(W,Ta){return W.text===
Ta.text&&W.range.toString()===Ta.range.toString()&&W.ifmt===Ta.ifmt&&W.stateId===Ta.stateId&&W.sheetName===Ta.sheetName}static cCj(W,Ta){return W.range.top-1===Ta.value.cell.row&&W.range.left-1===Ta.value.cell.col}};fh=gh=(0,Ba.__decorate)([(0,yc.d)(Mc.nBb),(0,Ba.__param)(0,(0,Mc.Rl)()),(0,Ba.__param)(1,(0,Mc.ej)()),(0,Ba.__param)(2,(0,Mc.eCa)()),(0,Ba.__param)(3,(0,Ca.c)({ga:!0}))],fh);(0,ya.a)(fh,"SetCellEstimationPrefetcher",null,[361,2]);var lh=a(71106);class pc extends De.a{constructor(W){super();
this.J=W;this.Vo()}create(){(W=>yc.a.resolve(Mc.Rl).then(Ta=>setTimeout(()=>W(Ta),0)))(W=>{W=this.J.za.tc(294)||this.J.za.Bd(294,new lh.RelativeAndAbsoluteReferencesManager(W));this.Jk(W)})}static Qa(W){W.za.Bd(295,new pc(W))}}(0,ya.a)(pc,"RelativeAndAbsoluteReferencesManagerFactory",De.a,[]);var id=a(85350),Ja=a(82283),I=a(50178),la=a(21714),Sa=a(88200);class rb{constructor(W){this.scheduler=W;this.zBb=void 0}async h2f(){this.zBb||(this.zBb=await yc.a.resolve(Mc.uy));return this.zBb}async registerOnAnnotation(W,
Ta,ob,K){const ja=(Cb,Jc)=>{(0,this.scheduler.alAnnotationNotifier()[W])(Jc.annotation).catch(cd=>{Ma.ULS.sendTraceTag(508048724,0,10,`IALInterop.onAnnotationReceived: Failed to send annotation to x10 handlers. ${cd}`)})},ub=this.zBb??await this.h2f();return ub?.register(ub.mO().NP(ob).KP(()=>{}).activateAnnotation({annotationType:Ta,Nn:K,SV:ja}).build())}async sendSignal(W){return(this.zBb??await this.h2f())?.cbc(W)}}(0,ya.a)(rb,"ALProvider",null,[]);class Da{constructor(W){this.fql=W;this.value=
void 0}getValue(){void 0===this.value&&(this.value=this.fql());return this.value}reset(){this.value=void 0}}(0,ya.a)(Da,"ResettableLazy",null,[]);class Xa extends Da{constructor(W,Ta,ob=Date.now){super(async()=>{var K=ob(),ja=W();const ub=ob()-K;ja=await ja;K=ob()-K-ub;this.log(ub,K);return ja});this.name=Ta}log(W,Ta){Ma.ULS.sendTraceTag(507314634,0,50,`TrackableAsyncLazy(EWA): name: ${this.name}, syncTime: ${W}, asyncTime: ${Ta}`)}reset(){throw Error("Resetting a TrackableAsyncLazy is not allowed");
}}(0,ya.a)(Xa,"TrackableAsyncLazy",Da,[]);class zb{constructor(){this.yMc=new Map;this.fIj=new Da(async()=>(await yc.a.resolve(Mc.JT,{ua:0})).dwa());this.yMc.set(Fc.Afc.FormulaByExamplePlugin,new Da(async()=>{const W=await yc.a.resolve(Mc.ra);return Hc.a.J1a(W)}));this.yMc.set(Fc.Afc.InCellControlsAutodetectionPlugin,new Da(async()=>Hc.a.M8f()));this.yMc.set(Fc.Afc.TestPlugin,new Da(async()=>!0))}async getRecognizedRangeTablesInfo(W,Ta,ob,K,ja){if(!(await this.yMc.get(K)?.getValue()??!1))return Ma.ULS.sendTraceTag(507794771,
306,50,`x10TableIntelligenceService.getRecognizedRangeTablesInfo: plugin ${K} is not licensed for user`),[];W=Ta?new gf.a((0,Sb.E)(Ta),W):null;a:{switch(ob){case Fc.tRa.Valid:ob=2;break a;case Fc.tRa.Invalid:ob=4;break a;case Fc.tRa.All:ob=6;break a}ob=void 0}return(await this.fIj.getValue()).QTb(W,ob,ja).map(U)}}(0,ya.a)(zb,"X10TableIntelligenceProvider",null,[]);class Id extends De.a{constructor(W){super();this.J=W;this.IGd=null;this.cwk=new Xa(...[async()=>{const Ta=await this.cpj.getValue();this.J.za.Bd(413,
Ta);return Ta},"registeredPluginScheduler"]);this.cpj=new Xa(...[async()=>{await yc.a.resolve(Mc.iqa,{ua:this.Ie});const Ta=excelOnlineCalc.PluginSchedulerSingletonGlobal.instance();var ob=await yc.a.resolve(Mc.x0,{ua:this.Ie});excelOnlineCalc.x10.resolveScriptLoaderPromise(ob.Wy());Ta.registerALProvider(new rb(Ta));Ta.registerTableIntelligenceProvider(new zb);excelOnlineCalc.x10.setX10Features(this.HWf());ob=(await Promise.all([excelOnlineCalc.x10.ensureGroupAttached(Fc.bBb.Core),Hc.a.nob(this.J)?
excelOnlineCalc.x10.ensureGroupAttached(Fc.bBb.SmartSuggestionsAutoComplete):0])).reduce((K,ja)=>K+ja,0);(await yc.a.resolve(Mc.z0,{ua:this.Ie})).IP.anyPluginInitialized=0<ob;return Ta},"initializedPluginScheduler"]);this.Vo()}create(){Ma.ULS.sendTraceTag(537154643,0,50,"PluginSchedulerFactory.Create: Loading scheduler slice");Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:8763136_UseNewXPlatEwaX10Init")?this.cwk.getValue().then(W=>{this.Jk(W)},W=>{Ma.ULS.sendTraceTag(507381790,0,10,"PluginSchedulerFactory.Create: Error loading scheduler slice: "+
W)}):Ja.a.then(this.wgi(),W=>{this.Jk(W)})}wgi(){if(this.IGd)return this.IGd;const W=la.a.ONb(I.a.none,"LoadResource","x10Scheduler loading",Ya.EwaSettings.qh()?null:Sa.telemetryManager());(Ta=>yc.a.resolve(Mc.Rl,{ua:this.Ie}).then(ob=>setTimeout(()=>Ta(ob),0)))(()=>{this.vJj(Ta=>{const ob=excelOnlineCalc.PluginSchedulerSingletonGlobal.instance();Ta=Ta.Wy();Ta=Fe.b(Qc.Task.Xa(Ta));ob.registerALProvider(new rb(ob));Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:8479330_enableTableIntelligenceInX10")&&
ob.registerTableIntelligenceProvider(new zb);const K=this.HWf();Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:7913510_sendSchedulerFeaturesNOtification")&&ob.notifier().setSchedulerFeatures(K.map(ja=>Fc.ALe[ja]));Promise.all([excelOnlineCalc.x10.ensureGroupAttachedLegacy(Ta,Fc.bBb.Core,K),Hc.a.nob(this.J)?excelOnlineCalc.x10.ensureGroupAttachedLegacy(Ta,Fc.bBb.SmartSuggestionsAutoComplete,K):0]).then(ja=>ja.some(ub=>0<ub)).then(ja=>{this.J.za.Bd(413,ob);W.setResult(ob);Mc.z0.tb()?void yc.a.Tc(Mc.z0).then(ub=>
{ub.IP.anyPluginInitialized=ja}):this.J.za.Hd(491,ub=>{ub.IP.anyPluginInitialized=ja})})})});return this.IGd=W.task}vJj(W){void yc.a.resolve(Mc.x0,{ua:this.Ie}).then(Ta=>W(Ta))}HWf(){const W=[];be.forEach((Ta,ob)=>{Ta(this.J)&&W.push(ob)});return W}static Qa(W){W.za.Bd(414,new Id(W))}}(0,ya.a)(Id,"PluginSchedulerFactory",De.a,[]);const be=new Map([["ArgumentAssistance",()=>!0],["SimpleAutoComplete",()=>!0],["SmartSuggestionsAutoComplete",W=>Hc.a.nob(W)],["ValuePreview",()=>Hc.a.tma()],["ColoredReferences",
()=>!0],["ParenthesisCoupling",()=>!0],["SyntaxErrors",()=>Hc.a.OXb()],["EnumAutoComplete",()=>!0],["GotoCtrlClick",()=>Hc.a.QXb()]]);class pe extends De.a{constructor(W){super();this.J=W;this.Vo()}static Qa(W){W.za.Bd(492,new pe(W))}create(){void yc.a.resolve(Mc.nRa).then(W=>{this.Jk(this.J.za.tc(491)??this.J.za.Bd(491,new we(this.J,W)))})}}(0,ya.a)(pe,"FormulaAssistanceTelemetryManagerFactory",De.a,[]);var $d=a(80135),Re=a(95138),vf=a(4588);class ef extends ee.a{constructor(W){super(W,ef.featureName);
this.N3f=Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:8582031_FormulaByExampleAsYouType")}static init(W){ef.Va?Ma.ULS.sendTraceTag(509122372,1,15,"FormulaSuggestionUIControl.init: unexpected call after already being inited."):ef.Va=new ef(W)}static instance(){return ef.Va}get jf(){return Ee.a.aQd}show(W,Ta,ob,K,ja,ub=null,Cb=null,Jc){return this.zxb(Cb,cd=>{appChrome.renderFormulaSuggestionCard(W,Ta,this.domElement,cd.y,cd.x,cd.y+cd.height,cd.x+cd.width,ob,K,ja,ub,this.Pwb,Jc?{explanationKey:Jc.explanationKey,
replacements:Jc.explanationReplacements,notifyExplanationSuccessful:Jc.WSc}:void 0)})}UAe(W,Ta,ob,K,ja,ub,Cb,Jc,cd,Kd,ne){return this.zxb(ne,Ve=>{appChrome.renderRowNumberingSuggestionCard(W,Ta,this.domElement,Ve.y,Ve.x,Ve.y+Ve.height,Ve.x+Ve.width,ob,K,ja,ub,Cb,Jc,cd,Kd,this.Pwb)})}XW(W,Ta,ob){Ya.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FBECurtainLifterCalloutForTestingOnlyEnabled",!1)&&(this.p2&&W.equals(this.k9d)||(this.p2&&document.body.removeChild(this.p2),this.k9d=W,W=this.grid.Db(W),
W=this.grid.getCellBounds(W.cell,!0),this.p2=document.createElement("div"),this.p2.setAttribute("style",`position:fixed;
        left: ${W.x+W.width}px;
        top: ${W.y+W.height/2}px`),document.body.appendChild(this.p2)),W=new oc.a(-847286761,0,this.J.jc,0,null),this.J.Ga.vb(W,{["CalloutName"]:15,["Target"]:this.p2,["NewState"]:Ta,["Reason"]:ob}))}}(0,ya.a)(ef,"FormulaByExampleCardUIControl",ee.a,[362]);class Mf extends $d.a{constructor(W){super(W)}zY(){Ma.ULS.sendTraceTag(528758224,0,50,"FormulaByExampleCommandHandlerFactory.CreateCommandHandlersAsync: FormulaByExampleCommandHandler init flow started.");const W=Ie.GetServiceTaskFactory.Ek(this.J.za,
453,454,1),Ta=(0,Fe.d)(yc.a.resolve(Mc.W$a,{ua:this.Ie})),ob=(0,Fe.d)(yc.a.resolve(Mc.afc,{ua:this.Ie}));Re.TaskExtensions.lb(Re.TaskExtensions.eu([W,Ta,ob],this.Ma),()=>{if(!Ya.EwaSettings.HL()||W.result&&Ta.result&&ob.result){var K=new vf.a(Ta.result,W.result,ef.instance(),ob.result);this.ZL([K]);Ma.ULS.sendTraceTag(537161924,0,50,"FormulaByExampleCommandHandlerFactory.CreateCommandHandlersAsync: FormulaByExampleCommandHandler initialized successfully")}else this.ZL([])},this.Ma)}static Qa(W){$d.a.Dca(455,
new Mf(W))}}(0,ya.a)(Mf,"FormulaByExampleCommandHandlerFactory",$d.a,[]);var sg=a(40347),yf=a(92462);class Ff{constructor(W,Ta,ob,K,ja){this.kind=W;this.value=Ta;this.formatted=ob;this.numFmt=K;this.cellStyle=ja}get displayText(){return this.formatted??this.value}}(0,ya.a)(Ff,"CloneEvaluatedEdit",null,[]);class Vg{constructor(W,Ta=null,ob){this.status=W;this.nQb=Ta;this.Vtb=ob}}(0,ya.a)(Vg,"FormulaByExampleFormulaEvalResult",null,[]);var ch=a(84609),mh;(function(W){W[W.none=0]="none";W[W.number=1]=
"number";W[W.string=2]="string";W[W.boolean=4]="boolean";W[W.error=8]="error";W[W.range=16]="range";W[W.array=32]="array";W[W.missing=64]="missing";W[W.blank=128]="blank";W[W.rich=256]="rich"})(mh||(mh={}));(0,ya.b)("OperKind",mh);var vg;(function(W){W[W.NoMismatch=0]="NoMismatch";W[W.Mismatch=1]="Mismatch";W[W.HashesValueMismatch=2]="HashesValueMismatch"})(vg||(vg={}));(0,ya.b)("EcsMismatchResult",vg);class Jg extends Set{constructor(W){super();this.o$=W}add(W){if(this.has(W))return this;if(this.size>=
this.o$){const Ta=this.entries().next().value[0];this.delete(Ta)}return super.add(W)}has(W){const Ta=super.has(W);return Ta?(this.delete(W),super.add(W),!0):Ta}}(0,ya.a)(Jg,"LimitedSizeSet",Set,[]);class ph{constructor(W,Ta){this.Qb=null;this.E0g=this.W7f=this.xH=!1;this.q9d=null;this.cme=(ob,K,ja)=>{if(!this.kLc(ob))return(0,yf.h)(K,"Result object from EvalOnClone API is empty or null.",this.hj,8),new Vg(2);const ub=this.Cpl(ob,K);if(!ja&&"OnlyPreviousFailureFound"===ub.reason)return new Vg(4);if(!ub.success)return(0,
yf.h)(K,`Evaluated results from calc do not match the user data in the grid or had errors from calc. reason: ${ub.reason}`,this.hj,8),Ma.ULS.sendTraceTag(537161880,0,50,"FormulaByExampleModelUpdater:EvalFormulaRangeOnClone:Formula results from Calc.ts do not match grid data."),new Vg(2);this.hj.mq(K.flowId,11);Ma.ULS.sendTraceTag(537161879,0,50,"FormulaByExampleModelUpdater:EvalFormulaRangeOnClone: EvalFormulaRange CSE: Result received from calc.");return new Vg(0,ob.results,ub.Vtb)};this.Qb=W;this.xH=
Ta;this.hj=ch.a.getInstance(this.Qb);this.W7f=Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:6327953_FormatOutputResultsOfFBE_V2");this.E0g=Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:7549840_DontShowFBESuggestionsWithErrorInTriggerCell")}lre(W){this.q9d&&this.Udh(this.q9d,!0,void 0,void 0,W)}HQk(W,Ta,ob=null,K=!1,ja){Ta=W.range.Qe(Ta);return Ta?this.FAf(W,Ta,ob).then(ub=>{this.xH&&!K&&W.flowId&&(0,yf.f)("CALCULATIONED",W.flowId,ja);if(2===ub.status)return ub;Ma.ULS.sendTraceTag(537161881,0,50,"FormulaByExampleModelUpdater:setFormulaPreviewOnRangeModel: evalFormulaRangeOnClone CSE: Result received from calc.");
this.q9d=ub;return this.Udh(ub,K,W.flowId,ja)}).catch(ub=>{(0,yf.h)(W,`failed to setFormulaPreviewOnRangeModel, error in calc API: ${ub.toString()}`,this.hj,8);return Promise.reject(`FormulaByExampleModelUpdater:setFormulaPreviewOnRangeModel: Unable to EvalFormulaRange, e: ${ub.toString()}`)}):((0,yf.h)(W,"Annotation range does not intersect loaded range",this.hj,6),Promise.reject("FormulaByExampleModelUpdater:setFormulaPreviewOnRangeModel: Annotation range does not intersect loaded range."))}async FAf(W,
Ta,ob=null){let K,ja;ob=ph.HKi(ob);this.hj.mq(W.flowId,7);try{return Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:7974673_FBECircularReferenceFixCalcMitigation")?(K=await this.Qb.O2(null,Ta,W.originCell,W.formula,!0),ja=this.cme(K,W,!1),4===ja.status&&(Ma.ULS.sendTraceTag(508683744,0,50,`FormulaByExampleModelUpdater:EvalFormulaRangeOnClone: previous failure found, with no other errors, retry with cloneWrites. flow id: ${W.flowId}`),K=await this.Qb.O2(ob,Ta,W.originCell,W.formula,!0),ja=this.cme(K,
W,!0))):(K=await this.Qb.O2(ob,Ta,W.originCell,W.formula,!0),ja=this.cme(K,W,!0)),ja}catch(ub){return(0,yf.h)(W,`failed to EvalFormulaRangeOnClone, error in calc API: ${ub.toString()}`,this.hj,8),Promise.reject(`FormulaByExampleModelUpdater:EvalFormulaOnRange: Unable to EvalFormulaRange, e: ${ub.toString()}`)}}edf(W,Ta,ob){if(W){var K=[];for(const Cb of W){if(!jb.a.IKc(Cb))continue;var ja=Cb;W=T(ja.value.cell);var ub=this.Qb.Db(W);if(!ub)continue;ja=this.DSd(ja);ub=ub.cell;const Jc=ub.iM;ja.cellStyle?.HorizontalAlignment&&
ub.WW(ja.cellStyle.HorizontalAlignment,!0,!0);Jc||Ma.ULS.sendTraceTag(508179167,0,50,`FormulaByExampleModelUpdater:applyFormulaCSE: cell CSE failed for flow ${ob}`);ub.text=Jc;ub.formulaBarText=Ta;K.push({text:Jc,value:ja.value,kind:ja.kind,range:W})}L(this.Qb,K,ob)}}static HKi(W){const Ta=ob=>({row:ob.cell.mD,column:ob.cell.LG,Nh:ob.Nh,formulaBarText:ob.Nh.value,text:ob.cell.text,$h:ob.cell.$h});return W?W.map(Ta):null}kLc(W){return(W=W.results)&&W.length?!0:!1}Udh(W,Ta,ob,K,ja){var ub=W.nQb;for(const Cb of ub){if(!jb.a.IKc(Cb)){"Unavailable"!==
Cb.reason.kind&&(W.status|=2);continue}ub=Cb.value.cell;if(!ub){W.status|=2;continue}ub=T(ub);if(ja&&!ub.$c(ja))continue;ub=this.Qb.Db(ub);if(!ub){W.status|=2;continue}const Jc=ub.cell,cd=this.DSd(Cb);Jc.iM=cd.displayText;Jc.M5a=cd.numFmt;Jc.f5b=cd.cellStyle;Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:8618122_NLNPreviewChange")&&(Jc.mSg=Z(ub,Cb));W.status|=1}this.xH&&!Ta&&ob&&(0,yf.f)("MODELUPDATED",ob,K);return W}Cpl(W,Ta){let ob=null,K=!1,ja=!1,ub=!1,Cb=!1,Jc=!1,cd=!1,Kd=!1,ne=!1,Ve=!1;W=W.results;
const uf=new Jg(5);var sf=W.entries();for(const Rf of sf){sf=Rf[0];const Gf=this.Dpl(Rf[1],Ta);Gf.qpb&&(K=Gf.SOb);Gf.d7d&&(ja=!0,ub||(ub=Gf.isInViewport),Jc||(Jc=Gf.isInViewport&&!Gf.aYb));Cb||(Cb=Gf.aYb);cd||(cd=Gf.QZf);ob=ob??Gf.KWa;Kd||(Kd=Gf.U$f);ne||(ne=Gf.$9f);Gf.SOb&&(Gf.lcf||Gf.kcf)&&uf.add(`grid: ${Gf.lcf}, clone: ${Gf.kcf}`);(Gf.d7d||Gf.aYb)&&W.splice(sf,1);Ve||Gf.slg||(Ve=!0)}K?this.hj.mq(Ta.flowId,10):this.hj.mq(Ta.flowId,9);return ob?{success:!1,reason:ob}:Kd?{success:!1,reason:"OnlyPreviousFailureFound"}:
{success:!0,Vtb:{["hasUnavailableCells"]:ja,["hasUnexpectedUnavailableCellsInViewport"]:Jc,["hasHiddenRows"]:Cb,["hasUnavailableCellsInViewport"]:ub,["hasErrorCells"]:cd,["hasNumFmtInSuggestion"]:ne,["formattedResultsGridComparisons"]:[...uf],["renderedPreviewIsDirty"]:Ve}}}Dpl(W,Ta){const ob={qpb:!1,d7d:!1,isInViewport:!1,aYb:!1,U$f:!1,KWa:null,QZf:!1,SOb:!1,$9f:!1,slg:!1};if(!jb.a.IKc(W)){W=W.reason;var K=wb.Range.pc(W.cell.row+1,W.cell.col+1);ob.qpb=K.equals(Ta.originCell);this.YHf(ob,K);if("Unavailable"===
W.kind)return ob.d7d=!0,ob;if("PreviousFailure"===W.kind)return ob.U$f=!0,ob;ob.KWa=JSON.stringify({kind:W.kind,innerKind:W.innerKind});ob.KWa=ob.KWa??"failure in calc";return ob}var ja=T(W.value.cell);ob.qpb=ja.equals(Ta.originCell);this.YHf(ob,ja);K=this.Qb.Db(ja);if(!K){if(ob.isInViewport&&!ob.aYb)return ob.KWa="formatted grid cell is null",ob;Ma.ULS.sendTraceTag(509682371,0,50,"FormulaByExampleModelUpdater:validateCalcResultMatchesCellData: did not fail suggestion when a formatted grid cell is null as this cell is hidden or not in view.");
return ob}const ub=this.DSd(W,this.W7f?K:null);if(8===ub.kind)return ob.QZf=!0,this.E0g&&ob.qpb&&(ob.KWa=`suggestion has error of kind ${ub.value} in cell.`),ob;const Cb=K.text;if(!Cb)return ob.SOb=!0,ob;const Jc=ub.displayText;ob.SOb=Z(K,W);ob.kcf=Ib.a.eY(Jc);ob.lcf=Ib.a.eY(Cb);ob.slg=K.cell.M5a?K.cell.M5a===W.value.value.numFmt:K.cell.iM===W.value.value.formattedText;ob.SOb||(ja=Ta.i7f(ja)?ob.qpb?"MODIFIEDEXAMPLE":"EXAMPLE":ob.qpb?"MODIFIEDRESTOFRANGE":"RESTOFRANGE",(0,yf.g)(ob.$9f?"numFmtMismatch":
"textMismatch",Cb,Jc.toString(),K.cell.$h,"evalFormulaOnCloneToShowPreview",Ta,ja,Z(K,W),K.cell.numFmt,ub.numFmt),ob.KWa="data strings do not match");return ob}YHf(W,Ta){W.isInViewport=this.Qb.az(Ta);W.aYb=this.Qb.Oc.Uea(Ta)}DSd(W,Ta){const ob=W.value.value,K=jh(W).toString();if(Ta&&!ob.formattedText&&""!==ob.formattedText){W=W.value.formatted;const ja=lg(ob.kind);W=this.Qb.K8(W,ja,Ke.a,Ta);(0,ae.c)(W)&&(ob.formattedText=W.value.text,ob.numFmt=W.value.numFmt,ob.cellStyle={HorizontalAlignment:Ta.cell.horizontalAlignment===
je.k.Automatic?W.value.horizontalAlignment:null,VerticalAlignment:je.F.Top,ID:0,RefCount:0,GlobalId:0,BackgroundColor:null,Gradient:null,IsPattern:!1,Indentation:0,ReadingOrder:null,ShrinkToFit:!1,NamedStyleId:0,FontID:0,GlobalFontID:0,IsUnlocked:!1,IsHidden:!1,VerticalText:!1,Orientation:0,PatternStyle:null,PatternColor:null})}return new Ff(ob.kind,K,ob.formattedText,ob.numFmt,ob.cellStyle)}}(0,ya.a)(ph,"FormulaByExampleModelUpdater",null,[]);const jh=W=>{W=W.value.value;return 1===W.kind?W._valueXL:
8===W.kind?kb.a.Ajb[W.type-1]:W.value},lg=W=>{switch(W){case 1:return je.e.Number;case 2:return je.e.String;case 8:return je.e.Error;case 4:return je.e.Boolean;default:return je.e.None}};var dg=a(66108),zh=a(71351);class ug extends zh.a{constructor(W,Ta,ob,K){super(W,Ta,ob,K);this.kind="Table"}get table(){void 0===this.Sdb&&(this.Sdb=this.Qb.Zf(this.originCell,!1));return this.Sdb}set table(W){this.Sdb=W}get qx(){return this.table?jb.a.vJa(this.table):null}}(0,ya.a)(ug,"FormulaByExampleTableSuggestion",
zh.a,[1009]);var kh=a(43689),hh=a(25657),vh=a(74150),Tg=a(31669),Ih=a(35769),Bg=a(35165);class Mg{constructor(W){this.BXf=!1;this.Qb=W}bFh(W){"ACCEPT"===W?this.Qb.uc(-458824895,-1,0,null):"DECLINE"===W?this.Qb.uc(-1726708382,-1,0,null):"IGNORE"===W&&(this.BXf?this.Qb.uc(-1227021552,-1,0,null):this.BXf=!0)}}(0,ya.a)(Mg,"FormulaByExampleSurveyManager",null,[]);const Ah=[(0,Rd.d)("featureNameField","FormulaByExample"),(0,Rd.d)("ver","1.0.0")],Bh={eventName:"Office.Excel.FormulaByExample.Seen",eventFlags:Hd.a,
dataFields:[...Ah,(0,Rd.a)("isFeatureSeen",!0)]},ig={eventName:"Office.Excel.FormulaByExample.Tried",eventFlags:Hd.a,dataFields:[...Ah,(0,Rd.a)("isFeatureTried",!0)]},Ch={eventName:"Office.Excel.FormulaByExample.Succeeded",eventFlags:Hd.a,dataFields:[...Ah,(0,Rd.a)("isFeatureSucceeded",!0)]};var Dh=a(89965),ra=a(23750);class Ub extends Sys.EventArgs{constructor(W){super();this.suggestion=W}}(0,ya.a)(Ub,"FormulaByExampleAnnotationArrivedEventArgs",Sys.EventArgs,[]);class Rc{constructor(W,Ta,ob){this.formulaByExampleManager=
W;this.upa=Ta;this.hj=ob;this.xMf=K=>"Table"===K.kind?this.hj.yDc(K.table.name,K.column):this.hj.kSb(K.qx,K.column,K.sheetId);this.qge=(K,ja)=>{K=ja.suggestion;ja=this.xMf(K);this.AMb.has(ja)&&this.AMb.get(ja).qge(za(K))};this.V3j=(K,ja)=>{K=ja.suggestion;ja=this.xMf(K);let ub;this.AMb.has(ja)?(ub=this.AMb.get(ja),ub.Q$g(za(K),K.anonymizedFormula,K.flowId)):(ub=new gd(ja,K),this.AMb.set(ja,ub))};this.AMb=new Map;this.formulaByExampleManager.lKh(this.qge);this.upa.mKh(this.V3j)}}(0,ya.a)(Rc,"FormulaByExamplePostSuggestionSpiesManager",
null,[]);class gd{constructor(W,Ta){this.rxd=W;this.XOc=null;this.joe=new Map;this.Q$g(za(Ta),Ta.anonymizedFormula,Ta.flowId)}Q$g(W,Ta,ob){this.a8f(W)||(this.joe.set(W,new fe(W,Ta,ob,!0)),this.XOc=W)}qge(W){if(this.XOc){var Ta=this.RTf(this.XOc);Ta?(W!==this.XOc&&(Ta.Vsc=!0,this.Fhg(Ta)),this.a8f(W)&&(W=this.RTf(W),W.Dkj(),W.Vsc&&(W.Xse=!0),this.Fhg(W))):Ma.ULS.sendTraceTag(508687501,306,50,`FormulaByExampleColumnSpy.onFormulaAnnotationForColumn: failed to get latest rejected formula records for column ${this.rxd}`)}else Ma.ULS.sendTraceTag(508687502,
306,15,`FormulaByExampleColumnSpy.onFormulaAnnotationForColumn: unexpected state - latest rejected formula is null for column ${this.rxd}`)}RTf(W){return this.joe.get(W)}a8f(W){return this.joe.has(W)}Fhg(W){Ma.ULS.sendTraceTag(137687059,306,20,`FormulaByExampleColumnSpy.logRejectedFormulaRecords: ${JSON.stringify({["anonymousColumnId"]:this.rxd,["suggestionFlowId"]:W.B8k,["formulaAnonymized"]:W.zR,["inPatternEditsPostSuggestion"]:W.lkj,["brokePattern"]:W.Vsc,["resumedPattern"]:W.Xse,["latestEditInPattern"]:W.WOc})}`)}}
(0,ya.a)(gd,"ColumnSpy",null,[]);class fe{constructor(W,Ta,ob,K){this.tDa=W;this.Vic=Ta;this.vCh=ob;this.kUe=0;this.Lpd=this.ped=!1;this.HXe=K}get formula(){return this.tDa}get zR(){return this.Vic}get B8k(){return this.vCh}get lkj(){return this.kUe}Dkj(){this.kUe++}get Vsc(){return this.ped}set Vsc(W){if(this.ped=W)this.WOc=!1}get Xse(){return this.Lpd}set Xse(W){if(this.Lpd=W)this.WOc=!0}get WOc(){return this.HXe}set WOc(W){this.HXe=W}}(0,ya.a)(fe,"ColumnSpyFormulaRecords",null,[]);class Qd extends ng.a{constructor(W,
Ta,ob){super();this.n4g=ob;this.OL=this.gD=this.upa=this.cMa=this.Qb=null;this.A2a=this.xH=!1;this.dx=null;this.xAe=!1;this.zRb=null;this.K1g=!1;this.Xlg=2E3;this.FKf=null;this.Qfh=0;this.qyd=!1;this.VIc=[];this.Rq=null;this.EQj=1E4;this.hke=Ya.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginSuggestionShowing",!1);this.q0j=K=>{Ma.ULS.sendTraceTag(520987789,306,50,`FormulaByExampleManager.onCloseCallback: closeReason = ${Ih.a[K]}`)};this.ZKi=(K,ja)=>{Ma.ULS.sendTraceTag(528758222,
306,50,"FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation received.");var ub=ja.annotation;if(ub){var Cb=parseInt(ub.guid,10);0>Cb||Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:7417755_FormulaByExampleVerifyDuplicatedAnnotation")&&!this.hj.M7f(Cb)||(Ma.ULS.sendTraceTag(526984792,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: received annotation's flowId: ${Cb}, containsRowPlaceholder: ${ub.generatedFormula?.formula?.includes(kh.b)}`),this.hj.mq(Cb,14),K=this.pik(Cb),
ja=this.Qb,ja=K.U3?new ug(ja,ub,Cb,K):new kh.a(ja,ub,Cb,K),this.Rq&&(this.Rq.Bha(Cb,4,{formula:ub.generatedFormula?.formula,zR:ub.generatedFormula?.anonymizedFormula}),this.Rq.mjb(Cb)),this.raiseEvent("fbeaa",new Ub(ja)),(0,Bg.b)(ja)||this.Qb.J1a()?(this.xH&&!this.A2a&&(0,yf.f)("ANNOTATIONRECEIVED",ja.flowId),null!=ja.errorMessage?(Ma.ULS.sendTraceTag(527005666,306,10,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation arrived with error message: ${ja.errorMessage}, flowId: ${ja.flowId}`),
this.hj.mq(ja.flowId,15,{reason:"Annotation arrived with error message"})):ja.formula?(this.n4g?.T3j(ja.flowId),Ma.ULS.sendTraceTag(509679808,306,20,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation with a formula suggestion arrived. flowId: ${ja.flowId} isTableSuggestion: ${(0,Bg.b)(ja)}}`),this.hj.mq(ja.flowId,16,{HRc:ja.formula}),this.OL=ja,(ub=this.upa.Oca(ja))?this.K1g||1!==ja.invocationMethod?ja.Xz<vh.a?Ma.ULS.sendTraceTag(528758220,306,50,"FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation does not have enough examples to prompt a suggestion."):
(Ma.ULS.sendTraceTag(527005665,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation with formula suggestion arrived. trying to suggest/apply it. flowID: ${ja.flowId}`),0===ja.invocationMethod?this.GQk(ub):(Cb=(0,yf.c)(ja.flowId),Cb>this.Xlg?(Ma.ULS.sendTraceTag(509636688,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation arrived after the maximal wait time for suggestions. flowId: ${ja.flowId}, duration: ${Cb}`),this.hj.mq(ja.flowId,6,{reason:"annotation arrived after the maximal wait time for suggestions"})):
(Cb=this.I1g(ub,K),Cb.value?this.Fah(ub,!1,`${K?.gX?jb.a.VRd(K.gX):"UnknownCommand"} - UponAnnotationReceived`,K):(Ma.ULS.sendTraceTag(509636687,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: shouldShowPreview returned false for suggestion with flowId: ${ja.flowId}, reason: ${Cb.reason}`),this.hj.mq(ja.flowId,6,{reason:Cb.reason}))))):Ma.ULS.sendTraceTag(523850754,306,50,"FormulaByExampleManager.formulaByExampleAnnotationHandler: session supports suggestions from cache only. returning early after caching suggestion."):
Ma.ULS.sendTraceTag(509678998,306,15,`FormulaByExampleManager.formulaByExampleAnnotationHandler: failed to cache suggestion for flowId: ${ja.flowId}.`)):(Ma.ULS.sendTraceTag(528758221,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation does not have any formula suggestions. deleting existing entry, if any. flowId: ${ja.flowId}`),this.upa.zib(ja),this.gD.XW(ja.originCell,2),this.hj.mq(ja.flowId,15),this.n4g?.U3j(ja.flowId))):Ma.ULS.sendTraceTag(509204251,306,10,"FormulaByExampleManager.formulaByExampleAnnotationHandler: range table suggestions should not be created in this session."))}else Ma.ULS.sendTraceTag(537161922,
306,15,"FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation is null.")};this.Z0c=()=>{Ma.ULS.sendTraceTag(537161889,306,50,"FormulaByExampleManager.SendByExampleFeedback: opening send feedback dialog after click on card.");const K={};K[Ra.a.CG]="FormulaByExampleCard";this.Qb.uc(802602464,0,8,K)};this.fAg=K=>{this.xAe=!0;Ma.ULS.sendTraceTag(537161888,306,50,`FormulaByExampleManager.OnShowFormula: user clicked ShowFormula button in the card for flow ${K}`)};this.yUb=K=>{Ma.ULS.sendTraceTag(528758219,
306,50,"FormulaByExampleManager.HandleNewBlocksDuringPreview: new block arrived during preview mode.");const ja=K.Ud.block,ub=this.OL.qx,Cb=this.OL.range.Qe(ja.od);this.cMa.lre(Cb);const Jc=(new wb.Range(ub.top,ub.left,ub.bottom,ub.right,!0,!0)).Qe(ja.od),cd=Array.from(this.Qb.b9(Jc,ja));Ma.ULS.sendTraceTag(537161886,306,50,`FormulaByExampleManager.HandleNewBlocksDuringPreview: putting skeleton for preview cells in new block ${K.Ud.hash}.`);this.VIc.includes(K.Ud.hash)||this.bIe(Cb,!0);const Kd=()=>
{this.GAf(this.OL,Jc,cd).then(ne=>{Ma.ULS.sendTraceTag(537161885,306,50,`FormulaByExampleManager.HandleNewBlocksDuringPreview: putting calculated data into model and demanding re-render for block ${K.Ud.hash}.`);this.VIc.includes(K.Ud.hash)||this.bIe(Cb,!1);ne.Vtb.renderedPreviewIsDirty&&this.Qb.a1b(K.Ud.block);Ma.ULS.sendTraceTag(512508567,306,50,`FormulaByExampleManager.handleNewBlocksDuringPreview: new FormulaByExample suggestion block rendered during preview. results: ${JSON.stringify({["flowId"]:this.OL.flowId,
["originalFlowId"]:this.OL.hW.flowId,["formulaAnonymized"]:this.OL.anonymizedFormula,["originalFormulaAnonymized"]:this.OL.hW.anonymizedFormula,["annotationRange"]:this.OL.range.toString(),["previewCellsMetadata"]:ne.Vtb})}`);return!0}).catch(ne=>{(0,yf.h)(this.OL,`Exception when rendering new block during preview. ${ne}`);Ma.ULS.sendTraceTag(537161884,306,50,`FormulaByExampleManager.HandleNewBlocksDuringPreview: caught exception: ${ne}.`)})};if(Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:8198794_FBEPreviewAwaitsDataFlushToCalc")){const ne=
()=>{this.Qb.Q6b(ne);Kd()};this.Qb.OIb(ne)}else Kd();return!0};this.rNg=()=>{this.Qb.kn(this.T4a);this.T4a=null};this.Ifa=(K,ja)=>{0!=ja.Tq||Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:8190374_FixDDARequestCloseFBE")&&576===ja.Wf.operation.operationName||(this.A2a&&this.dx.t9(`UserOperation: ${jb.a.Unh(ja.Wf.operation.operationName)}`),this.Qb.kn(this.Ifa))};this.Jge=K=>{const ja=K.suggestion.flowId;Ma.ULS.sendTraceTag(528023709,306,20,`FormulaByExampleManager.onImmediateUndo: undo operation queued following a formula by example suggestion application. flowId=${ja} originalFlowId=${K.suggestion.hW.flowId} isTableSuggestion=${(0,
Bg.b)(K.suggestion)}`);this.upa.NZg(K,"UNDO");this.Rq&&void this.Qb.pluginScheduler.eventEmitter().FBEOutcomeUpdate({flowId:ja,suggestionOutcome:{outcome:"UNDO"}})};this.K1g=Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:6169955_ShowFormulaByExampleSuggestionsUponArrivalFromServer");this.Xlg=Ya.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleMaximalWaitingTimeForSuggestionsMs",2E3);this.qyd=Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:8582031_FormulaByExampleAsYouType");this.Qb=
W;this.zRb=new Map;this.gD=Ta;this.hj=ch.a.getInstance(this.Qb);this.xle=!1;W.mob()?this.init():Ma.ULS.sendTraceTag(537161923,306,10,"FormulaByExampleManager.Ctor: not expected to be constructed when FG is off.")}Bck(W,Ta){const ob=Ta.dVc;this.zRb.set(W,Ta);this.xle=!1;const K=this.upa.b$i(Ta,W);if(K){this.Rq&&(this.Rq.Bha(W,3,{formula:K.suggestion.formula,zR:K.suggestion.anonymizedFormula,J3:!0,uM:K.uM,Rma:K.state}),this.Rq.mjb(W));this.hj.mq(W,4);K.suggestion.flowId=W;K.suggestion.originCell=ob;
var ja=this.I1g(K,Ta);ja.value?(Ma.ULS.sendTraceTag(529109774,306,50,"FormulaByExampleManager.onUserInput: A cached formula suggestion found for current input."),this.Fah(K,!0,`${Ta.gX?jb.a.VRd(Ta.gX):"UnknownCommand"} - FromCache`,Ta)):(this.hj.mq(W,6,{reason:ja.reason}),this.rql(W,K.suggestion,ob))}else this.hj.mq(W,5),this.Rq&&this.Rq.Bha(W,2,{J3:!1,Rma:hh.b.unseen,uM:0})}lKh(W){this.addHandler("fbeaa",W)}rql(W,Ta,ob){Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:7041480_FormulaByExampleFlowAggregatorFixed")&&
this.Qb.evalFormula(Ta.formula,ob,jb.a.nZ(this.Qb.ja),excelOnlineCalc.calc.evalFormulaFormatOrigin()).then(K=>{var ja=this.Qb.Db(ob);const ub=ja.text;ja=ja.cell.$h;K=K.value.value.toString();Ib.a.equals(ub,K,!1)?this.hj.mq(W,10):((0,yf.g)("textMismatch",ub,K,ja,"evalFormulaToVeriySuggestionWithoutShowingPreview",Ta,Ta.i7f(ob)?"MODIFIEDEXAMPLE":"MODIFIEDRESTOFRANGE",null),this.hj.mq(W,9))}).catch(K=>{K=`Failed to evalFormula, error in calc API: ${K.toString()}`;Ma.ULS.sendTraceTag(512341207,306,50,
`FormulaByExampleMangaer.verifySuggestionOnEditedCell: ${K}`);this.hj.mq(W,9,{reason:K})})}dispose(){this.Qb.kn(this.Ifa);this.rNg();this.Qb.hhl();super.dispose()}init(){const {FormulaByExampleAutoSuggestActor:W}=a(48177);this.Qb.gkh(this.q0j,{annotationType:dg.a.getTypeName(),Nn:!1,SV:this.ZKi});this.xH=(0,yf.a)(this.Qb);new W(this.Qb,this.xH);this.upa=new Bg.a(this.Qb,this.gD,this.hj);this.cMa=new ph(this.Qb,this.xH);this.FKf=new Mg(this.Qb);Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:7959804_FormulaByExampleSpies")&&
new Rc(this,this.upa,this.hj);this.Rq=this.Qb.Rq;Ma.ULS.sendTraceTag(528758223,306,50,"FormulaByExampleManager.init: init complete.")}pik(W){if(!this.zRb.has(W))return null;const Ta=this.zRb.get(W);this.zRb.delete(W);return Ta}GQk(W){const Ta=W.suggestion;this.cMa.FAf(Ta,Ta.range,null).then(ob=>{this.Kxd(W,1===ob.status?ob.nQb:null,!1);return null}).catch(()=>{Ma.ULS.sendTraceTag(537161921,306,50,"FormulaByExampleManager.setFormulaOnRangeExplicit: client estimation failed for explicit by example flow.");
this.Kxd(W,null,!1)})}Fah(W,Ta,ob,K){Ma.ULS.sendTraceTag(527713160,306,20,`FormulaByExampleManager.tryDisplayFormulaSuggestionPreview: starting flow to show a formula suggestion. isFromCache: ${Ta} isTableSuggestion: ${(0,Bg.b)(W.suggestion)} flowId: ${W.suggestion.flowId})}`);const ja=W.suggestion;this.xH&&!this.A2a&&(0,yf.f)("CALCULATIONSTART",ja.flowId,Ta);const ub=this.XPf(ja.qx);var Cb=Promise.resolve();Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:8198743_FormulaByExampleTier1Langs")&&ja.formula&&
(Cb=this.Qb.localizeEnglishFormula(ja.formula,this.Qb.C2c,ja.originCell).then(Wf=>{if((0,ae.c)(Wf))return ja.eLi=Wf.value,Promise.resolve();Wf=`FormulaByExampleManager.tryDisplayFormulaSuggestionPreview: failed to print formula. error: ${JSON.stringify(Wf.reason.kind)}`;Ma.ULS.sendTraceTag(508160210,306,10,Wf);return Promise.reject(Wf)}));Cb=Cb.then(()=>this.GAf(ja,this.Qb.getLoadedRange(),ub,Ta));let Jc=0,cd=null,Kd=null,ne=!1,Ve=!1,uf=void 0,sf=!1,Rf=null,Gf=!1;const Eg=Cb.then(Wf=>{const Hf={FirstRow:ja.range.top,
FirstColumn:ja.range.left,LastRow:ja.range.bottom,LastColumn:ja.range.right};let Tf=void 0;if(this.qyd&&504848446===K.gX){const bg=Wf.nQb.find(Lg=>T(Lg.value.cell).equals(ja.originCell));Tf=jh(bg).toString()}return this.Qb.P5(ja.range,this.yUb,Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:8618122_NLNPreviewChange")?{PreviewCellsRange:Hf,RetainCellTextOnPreview:!0}:void 0,Tf?{iM:Tf,z3c:K.z3c}:void 0).then(bg=>{this.A2a=!0;this.dx=bg;this.dx.jaf((Yg,Ng)=>{this.gD.hide();Jc++;1===Jc?cd=Ng.reason:Kd=
Ng.reason});this.dx.hwd(()=>{const Yg=this.fDg(ja,ja.generatedFormula.explanationReplacements);this.cMa.lre();({H1d:Gf,gaa:Rf}=this.h2g(ja,bg,Lg,"Success"===Yg.kind?{explanationKey:ja.generatedFormula.explanationKey,explanationReplacements:Yg.explanationReplacements,WSc:Ng=>{sf=Ng}}:void 0));Gf||(this.dx.t9("CardUI failure"),this.Ase());ne=!0});if(this.dx.didPrime)this.cMa.lre(),Ve=!0;else if(Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:8560939_FormulaByExampleAsYouTypeVerifiesContentOnEndEdit")&&
Tf){const Yg=(Ng,ah)=>{Ma.ULS.sendTraceTag(6370629,306,20,JSON.stringify({flowId:ja.flowId,VGl:Tf===ah.cellText,WGl:ah.committed}));this.Qb.uW(Yg)};this.Qb.BK(Yg)}let Lg=null;Lg=Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:7858168_FBEHideFeedbackButton")?this.Qb.isFeedbackEnabled?this.Z0c:null:this.Z0c;const qh=this.fDg(ja,ja.generatedFormula.explanationReplacements);"Failure"===qh.kind&&"FG disabled"!==qh.failureReason&&Ma.ULS.sendTraceTag(507593605,306,10,`FormulaByExampleManager.tryDisplayFormulaSuggestionPreview: failed to parse explanation replacements. error: ${qh.failureReason}, flowId: ${ja.flowId}`);
({H1d:Gf,gaa:Rf}=this.h2g(ja,bg,Lg,"Success"===qh.kind?{explanationKey:ja.generatedFormula.explanationKey,explanationReplacements:qh.explanationReplacements,WSc:Yg=>{sf=Yg}}:void 0));if(Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:8329602_AbortPreviewIfCardFailedToRender")&&!Gf)return this.dx.t9("CardUI failure"),this.Ase(),Promise.reject("Failed to show card UI");this.Qb.Up(this.Ifa);this.gD.XW(ja.originCell,0);this.xH&&jb.a.BTg(()=>{(0,yf.f)("PREVIEWRENDERED",ja.flowId,Ta);const Yg={["flowId"]:ja.flowId,
["originalFlowId"]:ja.hW.flowId,["displayTrigger"]:ob,["formulaAnonymized"]:ja.anonymizedFormula,["originalFormulaAnonymized"]:ja.hW.anonymizedFormula,["annotationRange"]:ja.range.toString(),["isFullyInViewport"]:this.Qb.az(ja.range),["isCachedSuggestion"]:Ta,["exampleCount"]:ja.Xz,["originalExampleCount"]:ja.hW.Xz,["seenCount"]:W.uM,["previewCellsMetadata"]:Wf.Vtb,["previewShownDurations"]:(0,yf.e)(Ta,ja.flowId),["isSuggestionOnTable"]:(0,Bg.b)(ja),["isNewRowPrediction"]:!(0,Bg.b)(ja)&&ja.sYb,["sheetId"]:ja.sheetId,
["areAllHeadersLoaded"]:(0,Bg.b)(ja)?ja.table.Z5?.IsFullTableHeaders:"nonTableSuggestion",["tableRange"]:ja.qx?.toString(),["dataCulture"]:this.Qb.J.dataCultureTag,["UICulture"]:this.Qb.J.uiCultureTag};this.Qb.I1a()&&(uf=this.V3h(Wf.nQb,ja.originCell));Ma.ULS.sendTraceTag(84165903,306,50,`FormulaByExampleManager.TryDisplayFormulaSuggestionPreview: Suggestion shown, awaiting user decision. flowData: ${JSON.stringify(Yg)}`)},this.Qb.Ma);return bg.d8b})});Promise.all([Cb,Eg]).then(([Wf,Hf])=>{this.xle=
!0;this.xej(Wf,Hf,W,Ta,ob,{["softIgnoreCount"]:Jc,["softIgnoreReasons"]:[cd,Kd],["didReshow"]:ne,["didPrime"]:Ve},{Kvi:uf},sf,Rf)}).catch(Wf=>{(0,yf.h)(ja,`Failed to show formula preview due to a promise (model update or preview render) rejection. rejection reason: ${Wf}`);Ma.ULS.sendTraceTag(537161920,306,15,`FormulaByExampleManager.TryDisplayFormulaSuggestionPreview: failed to show formula preview due to promise rejection. rejection reason: ${Wf}`);this.gD.XW(ja.originCell,5,Wf);W.state=hh.b.unseen})}h2g(W,
Ta,ob,K){if(Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:8874300_FormulaByExample_ShowRowNumberingCard")&&this.qCj(W.anonymizedFormula)){const ja={isAcceptAsValues:!1,maxTooltipOpenDurationMS:0,isFurtherExplanationHyperlinkClicked:!1,disableApplyAsValue:W.range.Go>this.EQj};return{H1d:this.gD.UAe(W.formula,W.range.toString(),()=>{Ta.isa("CardUI")},()=>{ja.isAcceptAsValues=!0;Ta.isa("CardUI")},ja.disableApplyAsValue,()=>Ta.eHa("CardUI"),ub=>{ja.maxTooltipOpenDurationMS=Math.max(ja.maxTooltipOpenDurationMS,
ub)},()=>{ja.isFurtherExplanationHyperlinkClicked=!0},ob,()=>this.fAg(W.flowId),W.originCell),gaa:ja}}return{H1d:this.gD.show(W.formula,W.range.toString(),()=>{Ta.isa("CardUI")},()=>Ta.eHa("CardUI"),ob,()=>this.fAg(W.flowId),W.originCell,K),gaa:null}}qCj(W){const Ta=/^ROW\(\) [-+] ROW\(\w+\)( [-+] \d+)?$/;return/^ROW\(\) [-+] \d+$/.test(W)||"ROW()"===W||Ya.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleReferenceRowFormula",!1)&&Ta.test(W)}fDg(W,Ta){if(!Ya.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleExplanations",
!1))return{kind:"Failure",failureReason:"FG disabled"};if(!Ta||0===Ta.length)return{kind:"Failure",failureReason:"No explanation replacements"};const ob=[];for(const ub of Ta){if(!["ColumnName","LeftColumnName","RightColumnName","ColumnNames"].includes(ub.replacementPlaceHolder)){ob.push(ub);continue}Ta=[];"ColumnNames"!==ub.replacementPlaceHolder?Ta.push(ub.replacementValue):Ta=ub.replacementValue.split(", ");let Cb=0;for(const Jc of Ta){if((0,Bg.b)(W)){var K=this.Qb.extractReferences(`=${Jc}`,this.Qb.ja.name,
this.Qb.YJe,!0,W.originCell);if(!K||!K.Items||1!==K.Items.length)return{kind:"Failure",failureReason:`Failed to extract singular ref from column replacement. refs non null: ${!!K}, refs count: ${K?.Items?.length}`};const cd=K.Items[0];K=W.table.Z5.HeadersList.find(Kd=>Kd.Index===cd.Range.FirstColumn);if(!K)return{kind:"Failure",failureReason:`Failed to find header for column replacement index in grid. ref: ${cd.Range.FirstColumn}`};Ta[Cb]=K.Name}else{K=Jc.replace(kh.b,"");var ja=(0,Sb.F)(`${K}:${K}`);
if(!ja)return{kind:"Failure",failureReason:`Failed to parse column replacement ref. columnLetter: ${K}, columnName: ${Jc}`};ja=W.headerRow.get(ja.left);Ta[Cb]=ja?ja:K}Cb++}ob.push({replacementPlaceHolder:ub.replacementPlaceHolder,replacementValue:Ta.join(", ")})}return{kind:"Success",explanationReplacements:ob}}V3h(W,Ta){const ob=this.Qb.eua("FormulaByExampleManager:checkIfPreviewResultsEqualOtherColumn",this.OL.qx);let K=null,ja=!0,ub=0;const Cb=[Ta.left];let Jc;try{for(;ob.$$mn();){const cd=ob.$$cu();
Jc&&Jc!==cd.range.top&&(ja=!1,K=null);Jc=cd.range.top;if(ja)ub++;else if(Cb.length===ub)return!1;if(!Cb.includes(cd.range.left)){if(!K){const Kd=new wb.Range(cd.range.top,Ta.left,cd.range.bottom,Ta.left,!0,!0),ne=W.find(Ve=>T(Ve.value.cell).equals(Kd));K=jh(ne).toString()}cd.Nh.value.toString()===K||"0"===K&&""===cd.Nh.value.toString()||Cb.push(cd.range.left)}}}catch(cd){throw Error(`Error while iterating over cells: ${cd}`);}finally{ob&&ob.dispose()}return!0}GAf(W,Ta,ob=null,K){return this.cMa.HQk(W,
Ta,ob,this.A2a,K).then(ja=>{Ma.ULS.sendTraceTag(537161887,306,50,`FormulaByExampleManager.EvaluateFormulaAndUpdateModel: model update completed. result: ${ja.status}.`);switch(ja.status){case 3:case 1:return 3===ja.status&&(0,yf.h)(W,"Preview shown, but only partially. some cells failed to evaluate."),Promise.resolve(ja);case 2:return Promise.reject("Calc estimation or model update failed");default:return Promise.reject("Calc estimation failed")}})}xej(W,Ta,ob,K,ja,ub,Cb,Jc,cd){const Kd=this.xAe;
this.Ase();const ne=ob.suggestion;this.xH&&(0,yf.f)("USERINPUTARRIVED",ne.flowId,K);const Ve=Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:8215633_FixFBEFreezeFrameBigTable")?ne.range.Qe(this.Qb.getLoadedRange()):ne.range;this.bIe(Ve,!1);this.gD.hide();jb.a.BTg(()=>{this.xH&&(0,yf.f)("PREVIEWREMOVEDWITHCSE",ne.flowId,K);const uf={["flowId"]:ne.flowId,["originalFlowId"]:ne.hW.flowId,["caller"]:Ta.Ggb,["displayTrigger"]:ja,["formulaAnonymized"]:ne.anonymizedFormula,["originalFormulaAnonymized"]:ne.hW.anonymizedFormula,
["suggestionOutcome"]:Ta.y_,["annotationRange"]:ne.range.toString(),["isFullyInViewport"]:this.Qb.az(ne.range),["isCachedSuggestion"]:K,["showFormulaClicked"]:Kd,["exampleCount"]:ne.Xz,["originalExampleCount"]:ne.hW.Xz,["seenCount"]:ob.uM,["previewCellsMetadata"]:W.Vtb,["previewShownDurations"]:this.xH?(0,yf.e)(K,ne.flowId):"none",["previewRemovedDurations"]:this.xH?(0,yf.d)(K,ne.flowId):"none",["isSuggestionOnTable"]:(0,Bg.b)(ne),["isNewRowPrediction"]:!(0,Bg.b)(ne)&&ne.sYb,["sheetId"]:ne.sheetId,
["areAllHeadersLoaded"]:(0,Bg.b)(ne)?ne.table.Z5?.IsFullTableHeaders:"nonTableSuggestion",["tableRange"]:ne.qx?.toString(),["dataCulture"]:this.Qb.J.dataCultureTag,["UICulture"]:this.Qb.J.uiCultureTag,["previewEvents"]:ub,["Hypotheses"]:{["areHypothesesEnabled"]:this.Qb.I1a(),["isNewColumnHeuristic"]:ne.o8j,["previewEqualsOtherColumn"]:Cb.Kvi},["formulaExplanation"]:{explanationSuccessful:Jc,explanationKey:ne.generatedFormula.explanationKey},["RowNumbering"]:cd?{["isAcceptAsValues"]:cd.isAcceptAsValues,
["maxTooltipOpenDurationMS"]:cd.maxTooltipOpenDurationMS,["isFurtherExplanationHyperlinkClicked"]:cd.isFurtherExplanationHyperlinkClicked,["disableApplyAsValue"]:cd.disableApplyAsValue}:null,["IsPlugin"]:!1};Ma.ULS.sendTraceTag(388780100,306,Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:7896248_XLFBELogLevelImportant")?20:50,`FormulaByExampleManager.handlePreviewResult: FormulaByExample flow results: ${JSON.stringify(uf)}`);Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:7705932_FBESendsOtelEvents")&&
jb.a.sendOtelEvent(Bh);(0,yf.b)(ne.flowId)},this.Qb.Ma);Ma.ULS.sendTraceTag(523842074,306,50,`FormulaByExampleManager.handlePreviewResult: User ${Ta.y_} the formula via ${Ta.Ggb}`);this.upa.NZg(ob,Ta.y_,cd?.isAcceptAsValues);"ACCEPT"===Ta.y_?(this.Kxd(ob,W.nQb,cd?.isAcceptAsValues),this.Rq&&void this.Qb.pluginScheduler.eventEmitter().FBEOutcomeUpdate({flowId:ne.flowId,suggestionOutcome:{outcome:"ACCEPT"}}),Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:7705932_FBESendsOtelEvents")&&jb.a.sendOtelEvent(ig)):
"IGNORE"===Ta.y_?this.Rq&&void this.Qb.pluginScheduler.eventEmitter().FBEOutcomeUpdate({flowId:ne.flowId,suggestionOutcome:{outcome:"IGNORE"}}):"DECLINE"===Ta.y_&&(this.Rq&&void this.Qb.pluginScheduler.eventEmitter().FBEOutcomeUpdate({flowId:ne.flowId,suggestionOutcome:{outcome:"DECLINE"}}),this.Qfh++,3===this.Qfh&&sg.Health.instance.recordQosError(Dh.a.$Ki,[ra.a.cLi],!0,!0,!1,!1,{Iwa:!0}));this.FKf.bFh(Ta.y_);this.Qb.kn(this.Ifa)}Ase(){this.A2a=!1;this.dx=null;this.xAe=!1}Kxd(W,Ta,ob){const K=W.suggestion;
ob?(this.cMa.edf(Ta,null,K.flowId),this.Qb.O2(null,K.range,K.originCell,K.formula,!0).then(ja=>{ja=ja.results.map(ub=>[this.R$h(ub)]);this.Qb.Lbd({FirstRow:K.range.top-1,FirstColumn:K.range.left-1,LastRow:K.range.bottom-1,LastColumn:K.range.right-1,SheetName:this.Qb.C2c.name,NamedObjectName:"Table"===K.kind?K.table.name:null},ja);Ma.ULS.sendTraceTag(507604995,306,50,`FormulaByExampleManager.applyFormulaSuggestionOnRange: applied values on table, range: ${K.range}`)}).catch(ja=>{Ma.ULS.sendTraceTag(507585377,
306,10,`FormulaByExampleManager.applySuggestionOnRange: failed to apply values on table, range: ${K.range} error: ${ja}`);this.Qb.Pi()})):(this.Qb.setCell({Text:K.formula,TextRuns:null,Fonts:null},K.originCell,1,127,null,0,{range:K.range,origin:K.originCell},2),this.cMa.edf(Ta,K.formula,K.flowId),Ma.ULS.sendTraceTag(537161883,306,50,`FormulaByExampleManager.applyFormulaSuggestionOnRange: applied formula on table, range: ${K.range}`));this.T4a=(ja,ub)=>{0===ub.Tq&&(170==ub.Wf.operation.operationName?
this.Jge(W):Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:7705932_FBESendsOtelEvents")&&jb.a.sendOtelEvent(Ch),this.rNg())};this.Qb.Up(this.T4a)}R$h(W){if(!jb.a.IKc(W))throw Error("FormulaByExampleManager.convertEvalOnCloneResultToString: EvalOnCloneResult is not successful.");return jh(W).toString()}I1g(W,Ta){if(this.hke)return{value:!1,reason:"Sessions shows plugin suggestions"};const ob=W.suggestion;Ta=this.Itj(ob.flowId,Ta.gX);return Ta.value?W.state===hh.b.decline?(this.gD.XW(W.suggestion.originCell,
6,Tg.a.znh),Ma.ULS.sendTraceTag(528758217,306,50,`FormulaByExampleManager.shouldShowPreview: user declined this suggestion before, not showing again. flowId: ${ob.flowId}`),{value:!1,reason:"User declined this suggestion before."}):ob.Xz<vh.a?(this.gD.XW(W.suggestion.originCell,6,Tg.a.ymh),Ma.ULS.sendTraceTag(528758215,306,50,`FormulaByExampleManager.shouldShowPreview: cached suggestion does not have enough examples. not showing preview. flowId: ${ob.flowId}`),{value:!1,reason:"Cached suggestion does not have enough examples."}):
W.state===hh.b.ignore&&2<=W.uM?(this.gD.XW(W.suggestion.originCell,6,Tg.a.ynh),Ma.ULS.sendTraceTag(528758216,306,50,`FormulaByExampleManager.shouldShowPreview: user saw suggestion at least twice and ignored last time. not showing again. flowId: ${ob.flowId}`),{value:!1,reason:"User saw suggestion at least twice and ignored last time"}):Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:7654591_FormulaByExampleForbiddenFormulas")&&this.upa.cxj(ob)?(Ma.ULS.sendTraceTag(509195993,306,20,`FormulaByExampleManager.shouldShowPreview: suggestion is forbidden. not showing preview. flowId: ${ob.flowId}, anonymizedFormula: ${ob.anonymizedFormula}`),
{value:!1,reason:"Suggestion is forbidden as it wasn't wanted before."}):Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:7300192_FBETextCellsUnsupported")&&this.XPf(ob.range).some(K=>this.Qb.M6d(K.cell.$h))?{value:!1,reason:"At least 1 cell in the loaded suggestion range is formatted as Text"}:Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:7464540_FBENoneValueTypesUnsupported")&&ob.rli===je.e.None?{value:!1,reason:"suggestion's default value type cannot be none."}:Ya.EwaSettings.isChangeGateEnabled("OfficeVSO:7669810_ValidateRangeIsInsideTableUponShowingSuggestion")&&
(0,Bg.b)(ob)&&!ob.table?{value:!1,reason:"table suggestion's table object is null."}:{value:!0}:(this.gD.XW(W.suggestion.originCell,6,Tg.a.Zjh),{value:!1,reason:Ta.reason})}bIe(W,Ta){if(W)for(let K=W.top;K<=W.bottom;K++)for(let ja=W.left;ja<=W.right;ja++){var ob=wb.Range.pc(K,ja);if(ob=this.Qb.Db(ob))ob.cell.WAe=Ta&&!ob.cell.iM}}Itj(W,Ta){if(this.xle)return Ma.ULS.sendTraceTag(528758218,306,50,`FormulaByExampleManager.shouldShowPreview: can't show preview again as preview already was shown for the current edit. flowId: ${W}`),
{value:!1,reason:"Preview already shown for the latest edit."};if(this.A2a)return Ma.ULS.sendTraceTag(527005664,306,50,`FormulaByExampleManager.shouldShowPreview: can't show preview for this suggestion as preview is already showing. flowId: ${W}`),{value:!1,reason:"Preview is already showing."};if(this.qyd){if(504848446===Ta&&!this.Qb.isEditing())return Ma.ULS.sendTraceTag(507855E3,306,50,`FormulaByExampleManager.shouldShowPreview: AsYouType UX enabled. can't show preview for this suggestion as user is not editing. flowId: ${W}`),
{value:!1,reason:"User is not editing."};if(324156914===Ta)return Ma.ULS.sendTraceTag(507836041,306,50,`FormulaByExampleManager.shouldShowPreview: AsYouType UX enabled. preview shown only when editing, or by priming. flowId: ${W}`),{value:!1,reason:"After edit preview only handled by preview priming."}}else if(this.Qb.isEditing())return Ma.ULS.sendTraceTag(524813027,306,50,`FormulaByExampleManager.shouldShowPreview: AsYouType UX disabled. can't show preview for this suggestion as user is editing. flowId: ${W}`),
{value:!1,reason:"User is editing."};return{value:!0}}XPf(W){const Ta=[];this.VIc=[];const ob=this.Qb.c9(W,this.Qb.activeItemName);for(const K of ob)Ta.push(...this.Qb.b9(W.Qe(K.od),K)),this.VIc.push(K.Lc);return Ta}}(0,ya.a)(Qd,"FormulaByExampleManager",ng.a,[864,2]);class V extends De.a{constructor(W){super();this.J=W;this.Vo()}create(){Ma.ULS.sendTraceTag(528758214,0,50,"FormulaByExampleManagerFactory.Create: starting service creation flow.");const W=(0,Fe.d)(yc.a.resolve(Mc.afc,{ua:this.Ie})),
Ta=(0,Fe.d)(yc.a.resolve(Mc.W$a,{ua:this.Ie}));Re.TaskExtensions.lb(Re.TaskExtensions.eu([Ta,W],this.Ma),()=>{Ma.ULS.sendTraceTag(528758213,0,50,"FormulaByExampleManagerFactory.Create: augmentationLoopManager and calcManager creation tasks resolved.");if(!Ya.EwaSettings.HL()||Ta.result&&W.result){ef.init(this.J);var ob=new Qd(Ta.result,ef.instance(),W.result);this.Jk(this.J.za.tc(453)||this.J.za.Bd(453,ob));Ma.ULS.sendTraceTag(537161882,0,50,"FormulaByExampleManagerFactory.Create: FormulaByExampleManager initialized successfully")}else this.Jk(null)},
this.Ma)}static Qa(W){W.za.Bd(454,new V(W))}}(0,ya.a)(V,"FormulaByExampleManagerFactory",De.a,[]);class Na extends De.a{constructor(W){super();this.J=W;this.Vo()}static Qa(W){W.za.Bd(497,new Na(W))}create(){let W=this.J.za.tc(496);W&&this.Jk(W);const Ta=Ie.GetServiceTaskFactory.Ek(this.J.za,448,449,this.Ie),ob=(0,Fe.d)(yc.a.resolve(Mc.LH,{ua:this.Ie})),K=Ya.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FixMigrate2AriaLiveNotifier",!1)?(0,Fe.d)(yc.a.resolve(Mc.th,{ua:this.Ie})):Ie.GetServiceTaskFactory.Ek(this.J.za,
211,212,this.Ie),ja=(0,Fe.d)(yc.a.resolve(Mc.jCa));Re.TaskExtensions.lb(Re.TaskExtensions.eu([Ta,K,ja,ob],this.Ma),()=>{W=this.J.za.tc(496);W||(W=new fd(this.J,ja.result,Ta.result,K.result),this.J.za.Bd(496,W));this.Jk(W)},this.Ma,3)}}(0,ya.a)(Na,"FormulaAssistanceValuePreviewFactory",De.a,[]);class sb extends $d.a{constructor(W){super(W)}zY(){const W=Mc.Kha.tb()?(0,Fe.d)(yc.a.resolve(Mc.Kha,{ua:this.Ie})):Ie.GetServiceTaskFactory.Ek(this.J.za,496,497,this.Ie);Re.TaskExtensions.lb(W,()=>{this.ZL([new kf(W.result)])},
this.Ma)}static Qa(W){$d.a.Dca(515,new sb(W))}}(0,ya.a)(sb,"FormulaAssistanceValuePreviewCommandHandlerFactory",$d.a,[]);String($a);String(ha);window.___1722890316926_closurehack=$a;window.___1722890316926_closurehack=ha;id.a.pb(pc.Qa);(()=>{id.a.pb(W=>{Mc.t6.tb()||Le.Qa(W)})})();(()=>{id.a.pb(W=>{Id.Qa(W)})})();(()=>{id.a.pb(W=>{Mc.z0.tb()||pe.Qa(W)})})();(()=>{id.a.pb(W=>{V.Qa(W);Mf.Qa(W)})})();(()=>{id.a.pb(W=>{Mc.Kha.tb()||Na.Qa(W);Mc.CAb.tb()||sb.Qa(W)})})();String(na);String(N);String(ca);String(ea);
String(ia);String(Fa);String(Oa);String(Qa);String(Db);String(Eb);String(ha);String(Ea);String(aa);String(fa);String(ba);String(R);String(Za);String(da);String(db);String(eb);String(cb);String(Ab);String(pb);String(vb);String(mb);window.___1722890343058_closurehack=na;window.___1722890343058_closurehack=N;window.___1722890343058_closurehack=ca;window.___1722890343058_closurehack=ea;window.___1722890343058_closurehack=ia;window.___1722890343058_closurehack=Fa;window.___1722890343058_closurehack=Oa;
window.___1722890343058_closurehack=Qa;window.___1722890343058_closurehack=Db;window.___1722890343058_closurehack=Eb;window.___1722890343058_closurehack=ha;window.___1722890343058_closurehack=Ea;window.___1722890343058_closurehack=aa;window.___1722890343058_closurehack=fa;window.___1722890343058_closurehack=ba;window.___1722890343058_closurehack=R;window.___1722890343058_closurehack=Za;window.___1722890343058_closurehack=da;window.___1722890343058_closurehack=db;window.___1722890343058_closurehack=
eb;window.___1722890343058_closurehack=cb;window.___1722890343058_closurehack=Ab;window.___1722890343058_closurehack=pb;window.___1722890343058_closurehack=vb;window.___1722890343058_closurehack=mb},72320:function(ka,oa,a){a.d(oa,{a:function(){return H}});const H=r=>excelOnlineCalc.util.isSuccess(r)},48177:function(ka,oa,a){a.r(oa);a.d(oa,{FormulaByExampleAutoSuggestActor:function(){return e}});ka=a(89236);var H=a(60302),r=a(17922),Aa=a(60323),k=a(92462),y=a(4588),b=a(74150),c=a(84609),d=a(97795),
m=a(98856),l=a(93187),f=a(10531);class e{constructor(n,h){this.mWc=this.Xxd=this.xH=!1;this.ZFa=null;this.Azc=!1;this.oua=0;this.Rq=null;this.T1b=new Map;this.hke=m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginSuggestionShowing",!1);this.kF=(t,v)=>{v.committed?(this.Rq&&(this.oua++,this.Rq.b_g(this.oua,this.oua),this.Rq.Bha(this.oua,0)),this.ctg(v.Gj,324156914)):this.AW()};this.Dna=(t,v)=>{this.ctg(v.c3.range,504848446,v.XMc)};this.ctg=(t,v,u)=>{324156914===v&&this.P$g(t);
if(m.EwaSettings.isChangeGateEnabled("OfficeVSO:8680199_ValidatorReportOrderFix")&&!this.O1d(t))this.AW(),this.Qb.l5(this.oua,"cell is invalid for FormulaByExample trigger - formula cell");else{var {qx:x,U3:w,V3:z,vma:A,headerRow:C}=this.vJa(t);x&&t.$c(x)?(this.K_d(t,324156914,x,w),m.EwaSettings.isChangeGateEnabled("OfficeVSO:8680199_ValidatorReportOrderFix")||this.O1d(t)?this.rge(t,t,x,v,w,z,A,u,C):this.AW()):(this.AW(),this.Qb.l5(this.oua,x?"edited header cell":"no table found"))}};this.P$g=t=>
{if(this.Qb.I1a()){var v=new f.Range(t.top,t.left-1,t.bottom,t.left,!1,!1);(v=this.Qb.u8i(v))&&(v.usedRange.$c(t)?this.VDj(v,t.left,t)&&this.klg(v,t.left-v.usedRange.left):this.klg(v,t.left-v.usedRange.left))}};this.klg=(t,v)=>{this.T1b.has(t.name)?this.T1b.get(t.name).add(v):this.T1b.set(t.name,new Set([v]))};this.rBj=t=>{const v=this.Qb.Zf(t,!1);return v&&this.T1b.has(v.name)?this.T1b.get(v.name).has(t.left-v.usedRange.left):!1};this.rhe=(t,v)=>{t=v.destinationRange;if(1804571062===v.command||t.left!==
t.right)this.AW();else{var u=new f.Range(t.top,t.right,t.top,t.right,!1,!1),{qx:x,U3:w,V3:z,vma:A,headerRow:C}=this.vJa(u);x?(this.K_d(u,v.command,x,w),this.rge(u,t,x,v.command,w,z,A,!1,C)):this.AW()}};this.d9j=(t,v)=>{if((t=v.Suf)&&1===t.length)if(t=t[0],t.EV)if(this.Qb.az(t))if((v=v.Ni)&&1804571062!==v&&1766348718!==v){t.isSingle&&this.P$g(t);var {qx:u,U3:x,V3:w,vma:z,headerRow:A}=this.vJa(t);if(u){H.ULS.sendTraceTag(507855043,306,50,`FormulaByExampleAutoSuggestActor.onPasteSucceededInner: passed all conditions to trigger FBE event.
        ribbonCommand = ${r.a[v]}
        destinationRange.height = ${t.height}`);var C=t.center;this.K_d(C,v,u,x);this.rge(C,t,u,v,x,w,z,!1,A)}else this.AW(),H.ULS.sendTraceTag(507855044,306,50,"FormulaByExampleAutoSuggestActor.onPasteSucceededInner: no table contains the range")}else this.AW(),H.ULS.sendTraceTag(507872195,306,50,`FormulaByExampleAutoSuggestActor.onPasteSucceededInner: unsupported paste. ribbonCommand = ${r.a[v]}`);else this.AW(),H.ULS.sendTraceTag(507881249,306,50,"FormulaByExampleAutoSuggestActor.onPasteSucceededInner: destinationRange not fully contained in viewport");
else this.AW(),H.ULS.sendTraceTag(507881250,306,50,`FormulaByExampleAutoSuggestActor.onPasteSucceededInner: not single column. destinationRange.width = ${t.width}`);else this.AW(),H.ULS.sendTraceTag(508380383,306,50,`FormulaByExampleAutoSuggestActor.onPasteSucceededInner: not single range. destinationRanges?.length = ${t?.length}`)};this.DJd=()=>{var t=this.RKk(this.PL.originCell,this.PL.qx);if(0===t)this.AW(),this.hj.mq(c.b,1),this.Qb.l5(this.oua,"output column doesn't have enough distinct examples");
else{var v=this.hj.nSf();this.hj.mq(v,3);this.PL.$pb&&this.Rq&&this.Rq.b_g(v,this.PL.$pb);H.ULS.sendTraceTag(537161929,306,50,`FormulaByExampleAutoSuggestActor.tryTriggeringFormulaByExample: triggering FormulaByExample for cell edit. Trigger kind: ${t}, FlowId: ${v}`);this.xH&&(0,k.f)("EDITCOMMIT",v);var u=new Aa.a(1928326585,1,2,6,null);t={[y.b.KKd]:this.PL.originCell,[y.b.gX]:this.PL.gX,[y.b.OFe]:t,[y.b.vJf]:v,[y.b.j8g]:this.PL.qx,[y.b.O8f]:this.PL.U3,[y.b.Q9f]:this.PL.V3,[y.b.u8f]:this.PL.vma,
[y.b.l3g]:this.PL.dDj,[y.b.eog]:this.PL.U3&&this.rBj(this.PL.originCell),[y.b.I_f]:this.PL.headerRow};this.Qb.vb(u,t);this.AW()}};this.ybk=(t,v)=>{t=this.PL.G2h;v=v.Gj.toString();t.has(v)&&(t.delete(v),0===t.size&&this.DJd())};if(!m.EwaSettings.isChangeGateEnabled("OfficeVSO:8899836_FBELegacySignalsSuppressed")||!this.hke)if(this.Qb=n,this.xH=h,this.AW(),this.Qb.BK(this.kF),m.EwaSettings.isChangeGateEnabled("OfficeVSO:8582031_FormulaByExampleAsYouType")&&this.Qb.GN(this.Dna),this.Azc=m.EwaSettings.isChangeGateEnabled("OfficeVSO:8231994_FBECalcGridUnreliableFix"),
this.Rq=this.Qb.Rq,this.Azc||this.Qb.Dvd(this.ybk),m.EwaSettings.isChangeGateEnabled("OfficeVSO:7395435_FormulaByExampleTriggerOnCSEPaste")&&this.Qb.qqc(this.rhe),(this.mWc=m.EwaSettings.isChangeGateEnabled("OfficeVSO:8329262_FormulaByExamplePostPaste"))&&this.Qb.rqc(this.d9j),this.hj=c.a.getInstance(this.Qb),this.Xxd=this.Qb.J1a())this.Qb.Ulj(),this.jTg=m.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleRowsBelowRangeTableToQuery",1)}VDj(n,h,t){n=l.a.vJa(n);h=new f.Range(n.top,
h,n.bottom,h,!1,!1);h=this.Qb.eua("FormulaByExampleAutoSuggestActor:isTableColumnBlank",h);try{for(;h.$$mn();){const v=h.$$cu();if(!v.range.equals(t)&&v.Nh?.value)return!1}}finally{h&&h.dispose()}return!0}vJa(n){const h=this.Qb.Zf(n,!1);if(h)return n=h.Z5?.HeadersList,{qx:l.a.vJa(h),U3:!0,V3:!1,vma:!n};if(this.Xxd){const {vJg:t,V3:v,vma:u,headerRow:x}=this.x4i(n);if(t)return{qx:t,U3:!1,V3:v,vma:u,headerRow:x}}return{qx:null,U3:!1,V3:!1,vma:!1}}x4i(n){var h=new f.Range(n.top-this.jTg,n.left,n.bottom,
n.right,!0,!0),t=this.Qb.C9k(new d.a(h,l.a.nZ(this.Qb.ja)),6);if(!t)return null;const v=new Map;for(var u of t)for(var x of u.table.interpretations)if(2===x.orientation&&.5<x.confidence){h=new f.Range(x.tableLocation.top+x.headerRowCount,x.tableLocation.left+x.headerColumnCount,Math.max(x.tableLocation.bottom,h.bottom),x.tableLocation.right,!0,!0);n=!x.tableLocation.$c(n);t=0===x.headerRowCount;if(1===x.headerRowCount)for(x=h.left;x<=h.right;x++){u=new f.Range(h.top-1,x,h.top-1,x,!1,!1);const w=this.Qb.Db(u);
w?v.set(w.range.left,w.cell.text):H.ULS.sendTraceTag(507581085,306,50,`FormulaByExampleAutoSuggestActor.getRangeTableInnerRange: formatted cell for header row is null. table inner range: ${h} cell range: ${u}`)}return{vJg:h,V3:n,vma:t,headerRow:v}}return{vJg:null,V3:!1,vma:!1,headerRow:null}}rge(n,h,t,v,u,x,w,z,A){this.JYg(n,h,t,v,u,x,w,z,A);n=[];this.Azc&&n.push(324156914);this.mWc&&n.push(237279923,-185374993,-958589048,808159687,42074747,-875588320,264209770);n.includes(v)?(this.S7b(),this.ZFa=
this.Qb.HMa(()=>{m.EwaSettings.isChangeGateEnabled("OfficeVSO:8235022_FBEVerifyCellNotFormulaAfterConsistent")&&!this.O1d(this.PL.originCell)?(this.AW(),this.hj.mq(c.b,1),this.Qb.l5(this.oua,"cell is invalid for FormulaByExample trigger - formula cell")):this.DJd()})):(this.S7b(),this.DJd())}K_d(n,h,t,v){v?(v=this.Qb.Zf(n,!1),this.hj.Zsg(h,v.name,n.left-(this.Qb.U.rtl?t.right:t.left),n.top-t.top)):this.hj.$sg(h,t,n.left-(this.Qb.U.rtl?t.right:t.left),n.top-t.top,l.a.nZ(this.Qb.C2c))}O1d(n){var h=
this.Qb.Db(n);if(!h)return H.ULS.sendTraceTag(524120778,306,15,`FormulaByExampleAutoSuggestActor.isCellValidForTriggeringFormulaByExample: formattedCell is null. investigation hints: is cell null = ${!n}`),this.hj.mq(c.b,1,{reason:"Didn't trigger since the formattedCell is null."}),!1;if(m.EwaSettings.isChangeGateEnabled("OfficeVSO:8666049_FBEUseClientGridFormulaMetadata"))return h.cell.Mw?(this.hj.mq(c.b,1,{reason:"Didn't trigger since edited cell content is a formula."}),!1):!0;n=this.Qb.jLc(h.cell.$h,
h.RM);(h=null!==n&&!n)||this.hj.mq(c.b,1,{reason:`Didn't trigger since edited cell content is a formula or isFormulaCell returned null. isFormulaText is null:${null==n}`});return h}RKk(n,h){n=n.left;h=new f.Range(h.top,n,h.bottom,n,!0,!0);return this.QKk(h)}QKk(n){const h=new Set;let t=0;n=this.Qb.eua("FormulaByExampleAutoSuggestActor:Table",n);try{for(;n.$$mn();){const v=n.$$cu();if(v.Nh?.value&&(h.add(v.Nh.value),t++,h.size>=b.a))return 2}}finally{n&&n.dispose()}t>=b.a?(H.ULS.sendTraceTag(523368219,
306,50,"FormulaByExampleAutoSuggestActor.searchForSufficientExamplesInOutputColumn: Table has sufficient example amount - but not enough distinct examples."),this.hj.mq(c.b,1,{reason:"Didn't trigger since there aren't enough distinct outputs"})):this.hj.mq(c.b,1,{reason:"Didn't trigger since there aren't enough examples"});return 0}S7b(){this.ZFa&&(this.ZFa(),this.ZFa=null,this.Rq&&324156914===this.PL.gX&&this.Qb.l5(this.PL.$pb,"consistent block cache callback cancelled"))}AW(){this.JYg(null,null,
null,null,null,null,null);(this.mWc||this.Azc)&&this.S7b()}JYg(n,h,t,v,u,x,w,z,A){this.PL={originCell:n,G2h:new Set(h?.bef(h.Go).map(C=>C.toString())),gX:v,qx:t,U3:u,V3:x,vma:w,dDj:z,headerRow:A,$pb:324156914===v?this.oua:null}}}(0,ka.a)(e,"FormulaByExampleAutoSuggestActor",null,[])},4588:function(ka,oa,a){a.d(oa,{a:function(){return G},b:function(){return C}});ka=a(89236);var H=a(60302),r=a(10531),Aa=a(75071),k=a(63584),y=a(14449);oa=a(64627);var b=a(74370);class c extends oa.a{constructor(){super();
this.formulasCount=this.columnNames=this.additionalInputs=this.examples=null;this.invocationMethod=this.stateID=0;this.enableExplanations=this.cultureInfoNames=this.referenceRowValue=this.referenceRowExpression=this.timeoutInSeconds=this.guid=this.conditionalMinBranchExampleCount=this.enableConditional=this.supportedFunctions=null;this.H_=Object.assign(new b.a,{T_:c.getTypeName(),B_:c.getBaseTypes()})}static getTypeName(){return"AugLoop_FormulaByExample_FormulaByExampleSignal"}static getBaseTypes(){return["AugLoop_Signals_Signal"]}}
(0,ka.a)(c,"FormulaByExampleSignal",oa.a,[]);var d=a(59804),m=a(94386),l=a(92462),f=a(1176),e=a(84609),n=a(83071),h=a(74150),t=a(43689),v=a(98856),u=a(93187),x=a(59676);const w=v.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleRAILThresholdQuantum",35),z=v.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleAsyncSignalGenerationTimeoutDuration",5E3),A={TEXTSPLIT:!0,TEXTSLICE:!1,FINDN:!1,TEXTAFTER:!0,TEXTBEFORE:!0},C={KKd:"editRange",gX:"triggerCommand",OFe:"triggerKind",
vJf:"flowId",O8f:"isInExplicitTable",j8g:"tableInnerRange",Q9f:"isNewRowPrediction",u8f:"isHeaderLess",l3g:"showNow",eog:"newColumnHypothesis",I_f:"headerRow"};class G{constructor(F,B,P,U){this.bQd=U;this.xH=!1;this.Qb=F;this.formulaByExampleManager=B;this.U1h=P;this.hj=e.a.getInstance(this.Qb);this.xH=(0,l.a)(this.Qb);this.ARj=v.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleMaximalNumberOfAdditionalInputRows",30);this.m4g=null!=this.bQd;H.ULS.sendTraceTag(528758226,306,50,
"FormulaByExampleCommandHandler.ctor: FBE command handler created")}Rc(){return!1}executeCommand(F,B,P){F=!1;B=B.command;switch(B){case 1928326585:var U=P&&P[C.OFe]?P[C.OFe]:0;F=P[C.vJf];if(0===U)return H.ULS.sendTraceTag(524940245,306,15,"FormulaByExampleManager.executeCommand: triggerFormulaByExample command called for execution with NoTrigger value."),this.hj.mq(F,1),m.Task.Xa(!0);const O=!P||!P[C.KKd],L=this.IVi(P,O),T=P[C.j8g],Z=P[C.O8f],za=P[C.gX],na=P[C.Q9f],N=P[C.u8f],ca=this.BUi(L,T),ea=
P[C.l3g],ia=P[C.eog];P=P[C.I_f];P={dVc:L,U3:Z,valueType:ca,qx:T,sheetId:u.a.nZ(this.Qb.C2c),V3:na,gX:za,z3c:ea,lyj:ia,headerRow:P};O||2!==U||this.formulaByExampleManager.Bck(F,P);if(this.m4g&&(U=this.WNf(L,Z))&&this.bQd.Stj(U))return H.ULS.sendTraceTag(508036636,306,50,"FormulaByExampleCommandHandler.executeCommand: column is locked, not triggering FBE (no signal)"),this.Qb.l5(F,"signal lock"),m.Task.Xa(!0);F=this.triggerFormulaByExample(L,T,O,F,Z,N,P)}return F?m.Task.Xa(!0):(0,y.a)(B)}Ec(F,B){switch(B.command){case 1928326585:return this.Qb.mob();
default:return!1}}Zc(){return!1}BUi(F,B){if(v.EwaSettings.isChangeGateEnabled("OfficeVSO:8582031_FormulaByExampleAsYouType")){B=this.Qb.eua("FormulaByExampleCommandHandler.getDefaultColumnValueType",new r.Range(B.top,F.left,B.bottom,F.left,!0,!0));try{for(;B.$$mn();){const P=B.$$cu().cell.Fy;if(P!==f.e.None)return P}}catch(P){throw Error(`Error while iterating over cells: ${P}`);}finally{B&&B.dispose()}}return this.Qb.Db(F)?.cell.Fy}IVi(F,B){H.ULS.sendTraceTag(537161928,306,50,`FormulaByExampleCommandHandler.getEditedRange: flow triggered from: ${B?
"Ribbon":"AutoDetect"}`);return B?this.Qb.getActiveCell():F[C.KKd]}triggerFormulaByExample(F,B,P,U,O,L,T){if(!this.Qb.Xuj)return H.ULS.sendTraceTag(537161927,306,10,"FormulaByExampleCommandHandler.TriggerFormulaByExample: augmentationLoopManager instance is null"),this.hj.mq(U,13,{reason:"AugmentationLoopManager instance is null"}),this.Qb.l5(U,"AL is undefined"),!0;let Z=B;if(v.EwaSettings.isChangeGateEnabled("OfficeVSO:8180963_FBEFixColumnHeadersMetadata")&&(Z=B.Qe(this.Qb.getLoadedRange()),!Z))return H.ULS.sendTraceTag(508363683,
306,20,"FormulaByExampleCommandHandler.TriggerFormulaByExample: tableRange does not intersect loaded range"),this.hj.mq(U,13,{reason:"tableRange does not intersect loaded range"}),this.Qb.l5(U,"tableRange does not intersect loaded range"),!0;P=this.OXi(F,Z,P,U,O,L,T);void P.then(za=>{if(za){if(this.m4g){const na=this.WNf(F,O);na&&this.bXj(U,na,za.examples,B)}H.ULS.sendTraceTag(537161926,306,50,`FormulaByExampleCommandHandler.TriggerFormulaByExample: calling SubmitOperationSignal for flowId: ${U}, isInExplicitTable: ${O}.`);
this.Qb.e8k(za,"FormulaByExample");this.hj.mq(U,12);this.U1h.XW(F,1);this.xH&&(0,l.f)("SIGNALSENT",U)}else this.hj.mq(U,13,{reason:"Signal is null"})});return!0}bXj(F,B,P,U){const O=[];for(const L of P){P=new r.Range(L.output.row,U.left,L.output.row,U.right,!0,!0);if(0<O.length){const T=O[O.length-1];if(T.bottom+1===P.top){T.SGf(P);continue}}O.push(P)}this.bQd.Uak(F,B,O);H.ULS.sendTraceTag(508036635,306,50,"FormulaByExampleCommandHandler.notifyLockManagerOnSignalSent: SignalLocksManager has been updated with the signal sent")}WNf(F,
B){return B?(B=this.Qb.Zf(F,!1),B?this.hj.yDc(B.name,F.left):(H.ULS.sendTraceTag(508036634,306,15,"FormulaByExampleCommandHandler.getColumnKeyFromEditRange: explicit table is null"),null)):this.hj.kSb(F,F.left,u.a.nZ(this.Qb.ja))}async OXi(F,B,P,U,O,L,T){T=await this.lRi(B,F,U,T);if(!T)return null;let Z,za=void 0,na=void 0;if(O){const N=this.Qb.Zf(F,!1);if(!N)return H.ULS.sendTraceTag(537161925,306,15,"FormulaByExampleCommandHandler.TriggerFormulaByExample: table returned null for given edit range."),
this.hj.mq(U,13,{reason:"Table returned null for given edit range"}),this.Qb.l5(U,"table return null for table suggestion"),null;Z=this.CSi(N);v.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleReferenceRowFormula",!1)&&(na=B.top-1,F=N.Z5?.HeadersList[F.left-B.left]?.Name)&&(F=(0,x.b)(F),za=`${N.name}[[#Headers],[${F}]]`)}else this.Qb.J1a()&&(Z=this.BSi(B,F),v.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleReferenceRowFormula",!1)&&(na=L?B.top:B.top-
1,za=`\$${F.toString().charAt(0)}\$${na}`));if(!Z)return this.Qb.l5(U,"no column names found"),null;v.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleReferenceRowFormula",!1)&&!za&&(H.ULS.sendTraceTag(508347742,306,15,`FormulaByExampleCommandHandler.TriggerFormulaByExample: failed to generate referenceRowExpression. isHederLessTable: ${L}, isInExplicitTable: ${O}`),na=za=void 0);P=(0,Aa.a)(new c,{formulasCount:1,examples:T.examples,additionalInputs:T.additionalInputs,columnNames:Z,
stateID:this.Qb.Tv,invocationMethod:P?0:1,guid:U.toString(),supportedFunctions:A,enableConditional:v.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleConditionals",!1),referenceRowExpression:za,referenceRowValue:na,cultureInfoNames:v.EwaSettings.isChangeGateEnabled("OfficeVSO:8198743_FormulaByExampleTier1Langs")?{userInterfaceCulture:void 0,dataCulture:this.Qb.J.dataCultureTag}:void 0,enableExplanations:v.EwaSettings.isChangeGateEnabled("OfficeVSO:8697329_FormulaByExampleExplanationsAlwaysGenerated")||
v.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleExplanations",!1)});H.ULS.sendTraceTag(528758225,306,50,"FormulaByExampleCommandHandler.getFormulaByExampleSignalFromTable: signal generated.");return P}async lRi(F,B,P,U){return await this.mRi(F,B,P,U)}CSi(F){const B=[],P=F.name;if(v.EwaSettings.isChangeGateEnabled("OfficeVSO:8180963_FBEFixColumnHeadersMetadata")){var U=F.Z5?.HeadersList;if(!U)return H.ULS.sendTraceTag(508363682,306,15,"FormulaByExampleCommandHandler.getColumnNamesMapFromTable: failed to generate columnNames."),
null;for(const {Index:L,Name:T}of U)U=v.EwaSettings.isChangeGateEnabled("OfficeVSO:8202565_FBEescapeColumnHeaderNames")?(0,x.b)(T):T,B.push({column:L+1,name:`${P}[@[${U}]]`})}else{var O=u.a.vJa(F);F=this.Qb.y_a(F);if(!O||!F)return H.ULS.sendTraceTag(524940244,306,15,`FormulaByExampleCommandHandler.getColumnNamesMapFromTable: failed to generate columnNames. is tableRange null: ${!O}, is colNamesCurrentTable null: ${!F}`),null;O=O.left;for(U of F)F=v.EwaSettings.isChangeGateEnabled("OfficeVSO:8202565_FBEescapeColumnHeaderNames")?
(0,x.b)(U):U,B.push({column:O,name:`${P}[@[${F}]]`}),O++}return B}BSi(F,B){const P=[];B=new r.Range(B.top,F.left,B.top,F.right,!0,!0);F=this.Qb.eua("FormulaByExample.getColumnNamesMapFromInputRange",B);for(B=B.left;F.$$mn();){const U={column:B++,name:`${r.Range.UN(F.$$cu().range.left)+t.b}`};P.push(U)}return P}async mRi(F,B,P,U){B=B.left;try{const O=await this.EXi(F,B,P);return await this.Hii(F,B,O,U,P)}catch(O){return H.ULS.sendTraceTag(508909329,306,10,`FormulaByExampleCommandHandler.getByExamplesInputsFromRangeAsync: failed to generate byExampleInputs. ${O}`),
null}}async EXi(F,B,P){const U=new Set,O=this.Qb.eua("FormulaByExample.getForbiddenColumnsFromRangeAsync",F),L=T=>{var Z=T.range;const za=Z.left;za===B||U.has(za)||(Z=new r.Range(Z.top,B,Z.top,B,!1,!1),this.bvj(T,Z)&&(U.add(za),this.hj.xSc(P,za-(this.Qb.displayRtl?F.right:F.left))))};try{return await this.vih(O,L),U}catch(T){throw Error(`getForbiddenColumnsFromRangeAsync failed with reason: ${T}`);}}async Hii(F,B,P,U,O){const L=[],T=[],Z=F.right,za=new Set;let na=[],N=!1,ca=null;const ea=v.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleTrackNonUniformColumns",
!1)?new Set:null;F=this.Qb.eua("FormulaByExample.createValidExamplesFromRangeAsync",F);let ia=!1;const Fa=new Map,Oa=Qa=>{if(504848446!==U.gX||Qa.range.top!==U.dVc.top){var Db=Qa.range.left,Eb=Db===B;Eb&&Qa.text?ca=this.Rpf(Qa):Eb||P.has(Db)||(Qa.text&&(N=!0),na.push(this.Rpf(Qa)));Qa=this.jkl(Qa,Fa);ia||(ia=Qa);Db===Z&&(N&&(ca?(L.push({output:ca,inputs:na}),za.add(ca.rawValueJson),ea?.add(ca.numberFormatCategory)):T.length<this.ARj&&T.push({output:null,inputs:na})),na=[],N=!1,ca=null)}};try{await this.vih(F,
Oa);if(za.size<h.a)return H.ULS.sendTraceTag(509683013,306,50,"FormulaByExampleCommandHandler.createValidExamplesFromRange: column does not have enough distinct examples with inputs."),this.Qb.l5(O,"not enough examples with non-empty inputs"),null;if(ea){const Qa={["isUniformColumn"]:1===ea.size,["dataTypes"]:Array.from(ea).sort().join(","),["flowId"]:O};H.ULS.sendTraceTag(507581650,306,20,`Formula By Example Uniform Column Data: ${JSON.stringify(Qa)}`);if(v.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleSuppressNonUniformSignals",
!1)&&1<ea.size)return H.ULS.sendTraceTag(507581649,306,50,"FormulaByExampleCommandHandler.createValidExamplesFromRange: column has non uniform data, suppressing signal."),this.Qb.l5(O,"column has non uniform data"),null}if(this.Qb.I1a()){const Qa=Fa.get(B),Db={["isFormulaUser"]:ia,["hasFormulaColumn"]:Array.from(Fa.entries()).some(([,Eb])=>"HasNonFormulaCell"!==Eb&&1===Eb.size),["outputColumnDataState"]:Qa&&"HasNonFormulaCell"===Qa?"NonFormulaColumn":1===Qa.size?"FormulaColumn":"MixedFormulasColumn",
["flowId"]:O};H.ULS.sendTraceTag(507557075,306,20,`Formula By Example Formula User And Columns Hypothesis Data: ${JSON.stringify(Db)}`)}return{examples:L,additionalInputs:T}}catch(Qa){throw this.Qb.l5(O,"createValidExamplesFromRangeAsync failed, log 4vv2r"),Error(`createValidExamplesFromRangeAsync failed with reason: ${Qa}`);}}async vih(F,B){const P=performance.now();let U=P;try{for(;F.$$mn();){if(performance.now()-P>z)throw Error("Timeout");performance.now()-U>w&&(await u.a.Hsl(),U=performance.now());
B(F.$$cu())}}catch(O){throw Error(`Error while iterating over cells: ${O}`);}finally{F&&F.dispose()}}jkl(F,B){if(!this.Qb.I1a())return!1;const P=F.range.left;if(!F.text||!F.Mw)return B.set(P,"HasNonFormulaCell"),!1;if("HasNonFormulaCell"===B.get(P))return!0;B.has(P)||B.set(P,new Set);B.get(P).add(F.formulaBarText);return!0}bvj(F,B){const P=F.RM,U=F.range,O=this.Qb.YJe,L=this.Qb.ja;if(!L)return H.ULS.sendTraceTag(509743199,306,50,"FormulaByExampleCommandHandler.isDependingOn: this.ewaControl.activeItem returned null. Expected to be an object of type Sheet."),
!1;if(!(v.EwaSettings.isChangeGateEnabled("OfficeVSO:7251463_FBEFixJsCrashOnNullActiveSheet")||L instanceof n.a))return H.ULS.sendTraceTag(509743198,306,50,"FormulaByExampleCommandHandler.isDependingOn: this.ewaControl.activeItem returned object of type other then Sheet. Expected to be an object of type Sheet."),!1;if(!this.Qb.jLc(F.cell.$h,P))return!1;if(F=this.Qb.extractReferences(P,L.name,O,!0,U))for(const T of F.Items)if(u.a.uLi(T.Range).equals(B))return!0;return!1}Rpf(F){let B;if(F.Nh.type===
f.e.Number){B=parseFloat(F.Nh.value);var P=this.Qb.zla(F.cell.$h);(0,k.c)(P)?P=P.value.isDate?4:P.value.isTime?5:1:(H.ULS.sendTraceTag(522840207,0,10,`FormulaByExampleCommandHandler.createAugLoopCell: CalcManager's getNumberFormat method failed on the given cell, falling back to number format. failureReason: ${P.reason}`),P=1)}else B=F.text,P=0;return Object.assign(new d.a,{row:F.range.top,column:F.range.left,displayText:F.text,rawValueJson:JSON.stringify(B),numberFormatCategory:P.toString()})}}(0,
ka.a)(G,"FormulaByExampleCommandHandler",null,[50])},74150:function(ka,oa,a){a.d(oa,{a:function(){return 2}})},84609:function(ka,oa,a){a.d(oa,{a:function(){return u},b:function(){return-1}});ka=a(89236);var H=a(60302),r;(function(A){A[A.UserEditedInTable=0]="UserEditedInTable";A[A.FormulaByExampleNoTrigger=1]="FormulaByExampleNoTrigger";A[A.FlowInterrupted=2]="FlowInterrupted";A[A.FormulaByExampleFullTrigger=3]="FormulaByExampleFullTrigger";A[A.HadCachedSuggestion=4]="HadCachedSuggestion";A[A.NoCachedSuggestion=
5]="NoCachedSuggestion";A[A.PreCalcPreviewRejected=6]="PreCalcPreviewRejected";A[A.WaitingForCalcResult=7]="WaitingForCalcResult";A[A.PostCalcPreviewRejected=8]="PostCalcPreviewRejected";A[A.SuggestionDidntMatch=9]="SuggestionDidntMatch";A[A.SuggestionMatched=10]="SuggestionMatched";A[A.PreviewShouldBeShown=11]="PreviewShouldBeShown";A[A.SignalSent=12]="SignalSent";A[A.NoSignalSent=13]="NoSignalSent";A[A.AnnotationReceived=14]="AnnotationReceived";A[A.NoFormulaFound=15]="NoFormulaFound";A[A.FormulaFound=
16]="FormulaFound";A[A.WorkbookClosed=17]="WorkbookClosed";A[A.UnexpectedTransition=18]="UnexpectedTransition"})(r||(r={}));(0,ka.b)("FormulaByExampleFlowState",r);const Aa=new Map([[r.UserEditedInTable,[r.FormulaByExampleNoTrigger,r.FormulaByExampleFullTrigger]],[r.FormulaByExampleFullTrigger,[r.FlowInterrupted,r.NoCachedSuggestion,r.HadCachedSuggestion]],[r.NoCachedSuggestion,[r.NoSignalSent,r.SignalSent]],[r.HadCachedSuggestion,[r.PreCalcPreviewRejected,r.WaitingForCalcResult]],[r.PreCalcPreviewRejected,
[r.NoSignalSent,r.SignalSent]],[r.WaitingForCalcResult,[r.NoSignalSent,r.SignalSent]]]),k=new Set([r.FormulaByExampleNoTrigger,r.FlowInterrupted,r.NoSignalSent,r.SignalSent]),y=new Map([[r.PreCalcPreviewRejected,[r.SuggestionDidntMatch,r.SuggestionMatched]]]),b=new Set([r.SuggestionDidntMatch,r.SuggestionMatched]),c=new Map([[r.WaitingForCalcResult,[r.PostCalcPreviewRejected,r.SuggestionDidntMatch,r.SuggestionMatched]],[r.SuggestionDidntMatch,[r.PostCalcPreviewRejected,r.PreviewShouldBeShown]],[r.SuggestionMatched,
[r.PostCalcPreviewRejected,r.PreviewShouldBeShown]]]),d=new Set([r.PostCalcPreviewRejected,r.PreviewShouldBeShown]),m=new Map([[r.SignalSent,[r.AnnotationReceived]],[r.AnnotationReceived,[r.NoFormulaFound,r.FormulaFound]],[r.FormulaFound,[r.PreCalcPreviewRejected,r.WaitingForCalcResult]]]),l=new Set([r.NoFormulaFound,r.FormulaFound]),f=new Set([r.NoFormulaFound,r.PreCalcPreviewRejected,r.WaitingForCalcResult]);var e;(function(A){A[A.Initial=0]="Initial";A[A.Pending=1]="Pending";A[A.Resolved=2]="Resolved"})(e||
(e={}));(0,ka.b)("SignalState",e);var n=a(98856);class h{constructor(A,C,G){this.currentState=A;this.Z6k=C;this.hHi=G}NHa(A){const C=this.Z6k.get(this.currentState);return C&&C.includes(A)?(this.currentState=A,!0):!1}get isActive(){return!this.hHi.has(this.currentState)}fWd(){return r[this.currentState]}}(0,ka.a)(h,"FormulaByExampleStateMachine",null,[]);class t{constructor(A,C,G,F,B,P){this.A3j=P;this.eVc=new h(0,Aa,k);this.Sda={flowId:A,c7h:C,rowNumber:G,gX:F,HRc:null,wJf:!1,fwe:!1,t8a:0,U3:B,xJf:{},
wjf:new Set}}get t8a(){return this.Sda.t8a}set flowId(A){this.Sda.flowId=A}xSc(A){this.Sda.wjf.add(A)}NHa(A,C){17===A?this.wja():(this.Yzc(A,C),this.lPh())}wja(){this.A3j(this.Sda)}Yzc(A,C){this.eVc.NHa(A)?this.T8j(A):this.Egb?.NHa(A)?this.o_j(A):this.L3c?.NHa(A)?this.Vak(A,C):this.T6j(A,C);(A=this.YRf(A))&&this.d9e(A,C)}T8j(A){switch(A){case 2:this.Sda.wJf=!0;break;case 6:this.Egb=new h(A,y,b);break;case 7:this.Egb=new h(A,c,d);break;case 12:this.Sda.t8a=1,this.L3c=new h(A,m,n.EwaSettings.isChangeGateEnabled("OfficeVSO:6169955_ShowFormulaByExampleSuggestionsUponArrivalFromServer")?
f:l)}}o_j(A){switch(A){case 9:this.Sda.fwe=!1;break;case 10:this.Sda.fwe=!0}}Vak(A,C){switch(A){case 14:this.Sda.t8a=2;break;case 16:this.Sda.HRc=C?C.HRc:null;break;case 7:this.Egb=new h(A,c,d)}}T6j(A,C){this.d9e(this.YRf(18),{reason:`${`Tried to change state from ${this.INk()} to ${r[A]}`}.${this.LTf(C)}`});this.wja()}lPh(){this.eVc.isActive||this.Egb?.isActive||this.L3c?.isActive||this.wja()}d9e(A,C){if(C=this.LTf(C))A.explanation||(A.explanation=""),A.explanation+=C;const {name:G,...F}=A;this.Sda.xJf[G]=
F}LTf(A){return null!=A&&null!=A.reason?" "+A.reason:""}INk(){return`[${`OriginStateMachine: ${this.eVc.isActive?this.eVc.fWd():"NotActive"}`}, ${`CalcStateMachine: ${this.Egb?.isActive?this.Egb.fWd():"NotActive"}`}, ${`SignalStateMachine: ${this.L3c?.isActive?this.L3c.fWd():"NotActive"}`}]`}YRf(A){switch(A){case 1:return this.i2("FBEFullTrigger",!1);case 3:return this.i2("FBEFullTrigger",!0);case 5:return this.i2("CachedSuggestion",!1);case 4:return this.i2("CachedSuggestion",!0);case 6:return this.i2("PreviewShouldBeShown",
!1,"Before calling calc evaluation");case 8:return this.i2("PreviewShouldBeShown",!1,"After returning from Calc");case 9:return this.i2("SetCellMatchedSuggestion",!1);case 10:return this.i2("SetCellMatchedSuggestion",!0);case 11:return this.i2("PreviewShouldBeShown",!0);case 8:return this.i2("PreviewShouldBeShown",!1,"After returning from Calc");case 15:return this.i2("FormulaFound",!1);case 16:return this.i2("FormulaFound",!0);case 18:return this.i2("UnexpectedTransition",!0)}return null}i2(A,C,
G){return G?{name:A,value:C,explanation:G}:{name:A,value:C}}}(0,ka.a)(t,"FormulaByExampleFlowDataAggregator",null,[]);var v=a(93187);class u{static getInstance(A){this.instance||(n.EwaSettings.isChangeGateEnabled("OfficeVSO:7041480_FormulaByExampleFlowAggregatorFixed")?this.instance=x.getInstance(A):this.instance=z.getInstance(A));return this.instance}}(0,ka.a)(u,"FormulaByExampleFlowsTrackerFactory",null,[]);class x{constructor(A){this.nextId=1;this.Y3f=this.icc=0;this.Z2=new Map;this.FDe=new Map;
this.Fmf=new Map;this.Yc=()=>{const C=this.E2i();if(0!==C.size){this.Qb.sendBeaconTraceTag(526984790,50,!1,`some pending FBE flows were not resolved by workbook closure. Total flows amount in sessions: ${this.icc}, Unresolved flows amount: ${C.size}, pending flows: ${[...C].join()}, interrupted flows amount ${this.Y3f}`);for(const G of C)this.mq(G,17)}};this.E8k=C=>{const G=C.flowId;var F=C.c7h;const B=C.rowNumber,P=C.gX,U=C.HRc,O=C.wJf,L=C.fwe,T=C.t8a,Z=C.xJf,za=C.wjf,na=C.U3,N=this.QSf(F);C=N.Zxa;
const ca=C!==U;ca&&(N.p7g++,N.Zxa=U);L&&N.Zxf++;O&&this.Y3f++;2===T&&this.icc++;F={["flowId"]:G,["columnKey"]:F,["rowNumber"]:B,["triggerCommand"]:v.a.VRd(P),["flowDataAggergation"]:Z,["editOperationsInColumn"]:N.Qxf,["suggestionChangesInColumn"]:N.p7g,["gotNewSuggestion"]:ca,["matchedSuggestionsInColumn"]:N.Zxf,["cellCycleColumns"]:Array.from(za).sort(),["rowsEditedInColumn"]:Array.from(N.Wxf).sort(),["isInExplicitTable"]:na};H.ULS.sendTraceTag(512365781,0,null!=C||null!=U?20:50,`FormulaByExampleFlowsTracker.summarizeFlowOverallData: Flow Aggregation results: ${JSON.stringify(F)}`);
this.Z2.set(G,void 0)};this.Qb=A;A.Dj(this.Yc);this.Eve=new w}static getInstance(A){x.instance||(x.instance=new x(A));return x.instance}nSf(){const A=this.nextId++,C=this.Z2.get(-1);C?(C.flowId=A,this.Z2.set(A,C),this.Z2.delete(-1)):H.ULS.sendTraceTag(512503829,0,15,`FormulaByExampleFlowsTracker.getNewFlowId: on flowId ${A} called getNewFlowId without having matched anonymousFlow`);return A}M7f(A){const C=this.Z2.has(A),G=this.Z2.get(A),F=G&&1===G.t8a;let B;C?G?F||(B="The flow exists but is not pending for annotation"):
B="Flow was resolved already":B="This flow does not exist";B&&H.ULS.sendTraceTag(509650145,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: flow is not pending for annotation. ${B} flowId: ${A}`);return F}Ozg(A,C,G,F){this.Z2.get(-1)&&(this.mq(-1,2),this.Z2.delete(-1));const B=this.QSf(A);B.Qxf++;B.Wxf.add(C);this.Z2.set(-1,new t(-1,A,C,F,G,this.E8k))}Zsg(A,C,G,F){C=this.yDc(C,G);this.Ozg(C,F,!0,A)}$sg(A,C,G,F,B){C=this.kSb(C,G,B);this.Ozg(C,F,!1,A)}xSc(A,C){const G=this.Z2.get(A);
G?G.xSc(C):this.eQg("onCellCycleFound",A)}mq(A,C,G){const F=this.Z2.get(A);F?F.NHa(C,G):this.eQg("notifyFlowReachedState",A,C)}yDc(A,C){let G=this.FDe.get(A);void 0===G&&(G=this.FDe.size,this.FDe.set(A,G));return G+"_"+C}kSb(A,C,G){return this.zMf(A,G,C)}AMf(A,C){return this.zMf(A,C)}zMf(A,C,G){let F;const B=this.Eve.A8i(C);B?B.find((P,U)=>{F=U;return P.$c(A)})||(this.Eve.D9e(C,A),F=B.length-1):(F=0,this.Eve.D9e(C,A));return`${C}_${F}${G?`_${G}`:""}`}E2i(){const A=new Set;for(const [C,G]of this.Z2)1===
G?.t8a&&A.add(C);return A}QSf(A){let C=this.Fmf.get(A);C||(C={Qxf:0,Zxf:0,p7g:0,Zxa:null,Wxf:new Set},this.Fmf.set(A,C));return C}eQg(A,C,G){const F=this.Z2.has(C);H.ULS.sendTraceTag(509678805,0,15,`FormulaByExampleFlowsTracker.${A}:
       on flowId ${C} ${G?` transition to ${r[G]}`:""}, `+"flowIdsToAggregatorsMap didn't find the requested flowAggregatoror. "+`Did flow exist: ${F}`)}}(0,ka.a)(x,"FormulaByExampleFlowsTracker",null,[966]);class w{constructor(){this.x5c=new Map}D9e(A,C){this.x5c.has(A)||this.x5c.set(A,[]);this.x5c.get(A).push(C)}A8i(A){return this.x5c.get(A)}}(0,ka.a)(w,"SensedTablesHeatMap",null,[]);class z{constructor(A){this.nextId=1;this.yRb=new Set;this.icc=0;this.Yc=()=>{const C=this.yRb.size;0!==C&&this.Qb.sendBeaconTraceTag(526984790,
50,!1,"some pending FBE flows were not resolved by workbook closure. Total flows amount in sessions: {0}, Unresolved flows amount: {1}, pending flows: {2}",this.icc,C,[...this.yRb].join())};this.Qb=A;this.Qb.Dj(this.Yc)}static getInstance(A){z.instance||(z.instance=new z(A));return z.instance}M7f(A){return this.yRb.has(A)}Zsg(){}$sg(){}xSc(){}yDc(){return null}kSb(){return null}AMf(){return null}mq(A,C){switch(C){case 12:this.nQk(A);break;case 14:this.oQk(A)}}nSf(){return this.nextId++}nQk(A){this.yRb.add(A);
this.icc++}oQk(A){this.yRb.delete(A)}}(0,ka.a)(z,"FormulaByExampleFlowsTrackerDeprecated",null,[966])},43689:function(ka,oa,a){a.d(oa,{a:function(){return H},b:function(){return"<<<FBE_XL_RW>>>"}});ka=a(89236);a=a(71351);class H extends a.a{constructor(r,Aa,k,y){super(r,Aa,k,y);this.kind="Range";this.wDa=y.headerRow;this.qx=y.qx;this.sYb=y.V3}get formula(){const r=super.formula;return r?r.replace(RegExp("<<<FBE_XL_RW>>>","g"),`${this.originCell.top}`):null}get dQd(){return super.formula}get sYb(){return this.Ewh}set sYb(r){this.Ewh=
r}get qx(){return this.CCh}set qx(r){this.CCh=r}get headerRow(){return this.wDa}}(0,ka.a)(H,"FormulaByExampleRangeSuggestion",a.a,[])},93187:function(ka,oa,a){a.d(oa,{a:function(){return x}});ka=a(89236);var H=a(51924),r=a(60896),Aa=a(3769),k=a(84214),y=a(52034),b=a(55650),c=a(44031),d=a(11280),m=a(70197),l=a(72320);a(4441);var f=a(62076),e=a(20720),n=a(13923),h=a(44838),t=a(82957),v=a(33002),u=a(60302);class x{constructor(w,z,A,C,G,F,B,P,U,O){this.J=w;this.Wd=z;this.Sg=A;this.DH=C;this.Ge=G;this.xlh=
F;this.Ywj=B;this.indexedDB=P;this.pluginScheduler=O;this.U=r.f(w);this.Rq=U?.tWf("Legacy")}Pi(){const w=t.a.qd(1,0,0,0,0,0,"FormulaByExampleApplyAsValueFailed");v.a(this.U.J).Pi(w)}Lbd(w,z){const A=new h.a(163,0,(C,G,F)=>{const B=this.J.ia.oa,P=B.Za(0);P.rangeToSet=w;P.rangeValues=z;return n.h(B,"SetRange",P,(U,O,L)=>{u.ULS.sendTraceTag(507585379,306,20,"FormulaByExampleServiceProxy.SetRange: the operation has succeeded");C(U,O,L)},(U,O,L)=>{u.ULS.sendTraceTag(507585378,306,10,"FormulaByExampleServiceProxy.SetRange: the operation has failed");
G(U,O,L)},F,this.J.ia.oa.Yb(),0)},65);this.J.Ba.enqueueOperation(A,null)}BK(...w){return this.U.Jb.BK(...w)}uW(...w){return this.U.Jb.uW(...w)}GN(...w){return this.U.Jb.GN(...w)}K_(...w){return this.U.Jb.K_(...w)}Zf(...w){return this.U.ub.Zf(...w)}u8i(w){return e.a(this.J,w,!1)}P5(...w){return this.U.vJ.P5(...w)}a1b(...w){return this.U.vJ.a1b(...w)}getLoadedRange(){return this.U.Hk}isEditing(){return this.U.isEditing}c9(...w){return this.U.va.c9(...w)}getActiveCell(){return this.U.da.la.activeCell}lS(){return this.U.va.lS}Ir(...w){return this.U.va.Ir(...w)}ht(...w){return this.U.va.ht(...w)}su(...w){return this.U.va.su(...w)}$u(...w){return this.U.va.$u(...w)}Qeb(...w){return this.U.va.Qeb(...w)}M6b(...w){return this.U.va.M6b(...w)}qqc(...w){return this.U.qqc(...w)}rqc(...w){this.fIk(z=>
{z.rqc(...w)})}Db(...w){return this.U.Db(...w)}b9(...w){return this.U.b9(...w)}az(...w){return this.U.az(...w)}setCell(...w){return this.U.setCell(...w)}eua(...w){return this.U.Io(...w)}get Oc(){return this.U.Oc}HMa(...w){return this.U.va.HMa(...w)}evalFormula(...w){return this.Wd.evalFormula(...w)}O2(...w){return this.Wd.O2(...w)}jLc(...w){return this.Wd.jLc(...w)}M6d(...w){return this.Wd.M6d(...w)}y_a(...w){return this.Wd.y_a(...w)}ORh(...w){return this.Wd.tbf(...w)}extractReferences(...w){return this.Wd.extractReferences(...w)}zla(...w){return this.Wd.zla(...w)}Dvd(...w){return this.Wd.Dvd(...w)}OIb(...w){return this.Wd.OIb(...w)}Q6b(...w){return this.Wd.Q6b(...w)}localizeEnglishFormula(...w){return this.Wd.localizeEnglishFormula(...w)}uc(...w){return this.J.uc(...w)}vb(...w){return this.J.Ga.vb(...w)}Dj(...w){return this.J.Dj(...w)}sendBeaconTraceTag(...w){return this.J.sendBeaconTraceTag(...w)}kn(...w){return this.J.Ba.kn(...w)}Up(...w){return this.J.Ba.Up(...w)}get isFeedbackEnabled(){return this.J.isFeedbackEnabled}get Ma(){return this.J.Ma}get ja(){return this.J.ja}get activeItemName(){return this.U.J.activeItemName}get C2c(){return this.J.ma?.ja}get Tv(){return this.J.Z.Tv}get displayRtl(){return this.J.ja.displayRtl}get YJe(){return this.J.workbookContext.WorkbookFileName}maj(){return f.a(this.J)}static IKc(w){return(0,
l.a)(w)}static sendOtelEvent(...w){return(0,m.c)(...w)}static Unh(...w){return d.a(...w)}static BTg(...w){(0,b.f)(...w)}static VRd(...w){return(0,c.a)(...w)}static Hsl(){return(0,b.g)()}static uLi(...w){return(0,y.kd)(...w)}static nZ(...w){return(0,k.d)(...w)}J1a(){return this.Ywj}CKa(){return Aa.a.CKa(this.J)}mob(){return Aa.a.mob(this.J)}I1a(){return Aa.a.I1a()}static vJa(...w){return(0,H.a)(...w)}Ulj(){this.wbc=this.DH.dwa()}C9k(...w){return this.wbc?.QTb(...w)}SPd(...w){return this.Ge.SPd(...w)}K8(...w){return this.Ge.K8(...w)}Ruj(){var w=
[];return!!this.indexedDB&&this.indexedDB.If(...w)}anj(...w){this.indexedDB.initialize(...w)}SXi(...w){return this.indexedDB.Mva(...w)}hJk(...w){this.indexedDB.fAa(...w)}deleteDatabase(...w){return this.indexedDB.deleteDatabase(...w)}gkh(w,z){this.Sg.register(this.Sg.mO().NP("FormulaByExample").KP(w).activateAnnotation(z).build())}Xuj(){return!!this.Sg}hhl(){this.Sg.unregister(...["FormulaByExample"])}e8k(...w){this.Sg.cbc(...w)}l5(w,z){this.Rq&&(this.Rq.Bha(w,1,{errorMessage:z}),this.Rq.mjb(w))}fIk(w){this.J.za.Hd(254,
w)}}(0,ka.a)(x,"FormulaByExampleServiceProxy",null,[])},71351:function(ka,oa,a){a.d(oa,{a:function(){return Aa}});ka=a(89236);oa=a(66108);var H=a(60302),r=a(10531);class Aa extends oa.a{constructor(k,y,b,c){super();this.Vhd=null;this.q_e=!1;Object.assign(this,y);this.Qb=k;this.DSe=b;c&&(this.Xcb=c.dVc,this.Qsh=c.valueType,this.Tqd=c.sheetId,this.q_e=c.lyj);this.hW={flowId:this.flowId,Xz:this.Xz,originCell:this.originCell,anonymizedFormula:this.anonymizedFormula}}set eLi(k){this.Vhd=k}set flowId(k){this.DSe=
k}get flowId(){return this.DSe}get formula(){if(this.Vhd)return this.Vhd;void 0===this.tDa&&(this.tDa=this.generatedFormula?.formula)&&"="!==this.tDa.charAt(0)&&(H.ULS.sendTraceTag(509620492,306,50,"FormulaByExampleSuggestion.formula: appending = sign as formula prefix."),this.tDa=`=${this.tDa}`);return this.tDa}set Xz(k){this.bhd=k}get fNd(){return this.rows}get rli(){return this.Qsh}get anonymizedFormula(){void 0===this.Vic&&(this.Vic=this.generatedFormula?.anonymizedFormula);return this.Vic}get sheetId(){return this.Tqd}get Xz(){void 0===
this.bhd&&(this.bhd=this.fNd.length);return this.bhd}set originCell(k){this.Xcb=k}get originCell(){void 0===this.Xcb&&(H.ULS.sendTraceTag(509620491,306,10,`FormulaByExampleSuggestion.originCell: origin cell is not defined - falling back to first cell of annotation range. flowId: ${this.flowId}`),this.Xcb=r.Range.pc(this.fNd[0],this.column));return this.Xcb}get range(){return new r.Range(this.qx.top,this.Xcb.left,this.qx.bottom,this.Xcb.left,!0,!0)}get o8j(){return this.q_e}i7f(k){return k.$c(this.range)&&
this.fNd.includes(k.top)}}(0,ka.a)(Aa,"FormulaByExampleSuggestionBase",oa.a,[1010])},35165:function(ka,oa,a){a.d(oa,{a:function(){return n},b:function(){return f}});ka=a(89236);var H=a(97795);oa=a(25657);var r=a(60302);class Aa{constructor(h){this.gD=h;this.wtc=new Map}Oca(h){return this.f2i(h.sheetId).Oca(h)}bFc(h){const t=this.wtc.get(h.sheetId);return t?t.bFc(h.range):null}fmi(h){const t=this.wtc.get(h.sheetId);return t?t.zib(h):!1}f2i(h){let t=this.wtc.get(h);t||(t=new k(this.gD),this.wtc.set(h,
t));return t}}(0,ka.a)(Aa,"FormulaByExampleRangeSuggestionsCache",null,[]);class k extends oa.c{constructor(h){super();this.gD=h}Oca(h){const t=this.feh(h);if(t)return t;this.zib(h);this.gD.XW(h.originCell,3);return super.Oca(h)}uTb(h){return this.bFc(h.range)}bFc(h){r.ULS.shipAssertTag(509383498,306,h.EV,"FormulaByExampleRangeSuggestionsCache.getIntersectingSuggestion: lookup range must be of single column width.");return this.get(h.left)?.find(t=>t.suggestion.range.$c(h))}gJa(h){return h.range.left}feh(h){const t=
this.uTb(h);return t&&t.suggestion.dQd===h.dQd?this.fIe(t,h):null}}(0,ka.a)(k,"ColumnBasedRangeSuggestionsCache",oa.c,[]);var y=a(98856);const b=(h,t,v)=>{if(y.EwaSettings.isChangeGateEnabled("OfficeVSO:8180963_FBEFixColumnHeadersMetadata")){if((v=h.Z5?.HeadersList)&&0<v.length&&(v=v.find(z=>z.Index===t-1)))return h.name+"_"+v.Name;r.ULS.sendTraceTag(537161876,306,20,`FormulaByExampleSuggestionCache.getUniqueTableColumnIdentifier: invalid inputs. tableRange: ${h.usedRange}, columnNumber: ${t}, `+
`areAllTableHeadersAvailable: ${h.Z5?.IsFullTableHeaders}`);return null}const u=v.y_a(h);if(!u)return null;const x=h.usedRange,w=t-x.left;return 0>w||w>=u.length?(r.ULS.sendTraceTag(537161876,306,20,`FormulaByExampleSuggestionCache.getUniqueTableColumnIdentifier: invalid inputs. tableRange: ${x}, columnNumber: ${t}, `+`areAllTableHeadersAvailable: ${v.ORh(h,u)}`),null):(v=u[w])?h.name+"_"+v:null};class c extends oa.a{constructor(h,t){super();this.Qb=h;this.gD=t}Oca(h){var t=!1;const v=super.uTb(h);
if(!v||(t=v.suggestion.formula!==h.formula))return t&&r.ULS.sendTraceTag(523842004,306,20,`FormulaByExampleSuggestionsCache.cacheSuggestion: formula changed from last cache entry, overriding cache entry.
           Last example count: ${v.suggestion.Xz}, current: ${h.Xz}, oldFormula: ${v.suggestion.anonymizedFormula}, newFormula:${h.anonymizedFormula}`),r.ULS.sendTraceTag(537161877,306,20,`FormulaByExampleSuggestionsCache.cacheSuggestion: saving suggestion for table range. tableRange: ${h.table?.usedRange}, columnNumber: ${h.column}, examplesCount ${h.Xz}, hasPreviousSuggestion: ${this.has(this.gJa(h))}`),(t=super.Oca(h))||r.ULS.sendTraceTag(528889932,306,15,"SuggestionsCache.cacheSuggestion: failed to cache table suggestion due to getTableColumnKey failure."),
this.gD.XW(h.originCell,3),t;v.suggestion.Xz!==h.Xz&&(r.ULS.sendTraceTag(523842003,306,50,`FormulaByExampleSuggestionsCache.cacheSuggestion: formula didn't change from the last cache entry, but number of examples changed. Last example ${v.suggestion.Xz}, current: ${h.Xz}`),this.gD.XW(h.originCell,4),h.hW.Xz=v.suggestion.hW.Xz);v.suggestion.Xz!==h.Xz&&(r.ULS.sendTraceTag(523842003,306,50,`FormulaByExampleSuggestionsCache.cacheSuggestion: formula didn't change from the last cache entry, but number of examples changed. Last example ${v.suggestion.Xz}, current: ${h.Xz}`),
this.gD.XW(h.originCell,4),h.hW.Xz=v.suggestion.hW.Xz);return this.fIe(v,h)}s8i(h,t){h=b(h,t,this.Qb);return h?this.YVi(h):(r.ULS.sendTraceTag(528889931,306,15,"FormulaByExampleSuggestionsCache.getTableCachedSuggestion: failed to get cached table suggestion due to getTableColumnKey failure."),null)}gJa(h){return b(h.table,h.column,this.Qb)}}(0,ka.a)(c,"FormulaByExampleTableSuggestionsCache",oa.a,[]);class d extends Sys.EventArgs{constructor(h){super();this.suggestion=h}}(0,ka.a)(d,"FormulaByExampleFormulaRejectedEventArgs",
Sys.EventArgs,[]);oa=a(86608);var m=a(10531),l=a(95138);const f=h=>"Table"===h.kind;class e extends Map{}(0,ka.a)(e,"ForbiddenFormulasMap",Map,[]);class n extends oa.a{constructor(h,t,v){super();this.Qb=h;this.gD=t;this.hj=v;this.Vje=!1;this.whk="formulaByExamplePersistentCache";this.xhk="formulaByExamplePersistentSuggestionsCache";this.oKi="forbiddenFormulas";this.PFi=1;this.qne=new Aa(t);this.z5c=new c(this.Qb,t);y.EwaSettings.isChangeGateEnabled("OfficeVSO:7654591_FormulaByExampleForbiddenFormulas")&&
(this.vIa=new Map,this.j_d=new Map,this.Vje=y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FBEPersistentCache",!1)&&this.Qb.Ruj())&&(this.iih=this.Qb.maj(),void this.Rlj());this.Twj=y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleForbidFormulaForTable",!1)}mKh(h){this.addHandler("fbefr",h)}b$i(h,t){let v;const u=h.dVc;var x=h.qx;if(h.U3){h=this.Qb.Zf(u,!1);if(!h)return r.ULS.sendTraceTag(509649310,306,50,`FormulaByExampleManager.onUserInput: getTableContainingRange returned null. flowId: ${t}, editedCellRange: ${u}`),
null;if(x=this.z5c.s8i(h,u.left))x.suggestion.table=h,v=x}else if(t=new m.Range(x.top,u.left,x.bottom,u.right,!0,!0),t=this.qne.bFc(new H.a(t,h.sheetId)))t.suggestion.qx=x,t.suggestion.sYb=h.V3,v=t;return v}Oca(h){return"Table"===h.kind?this.z5c.Oca(h):this.qne.Oca(h)}zib(h){return"Table"===h.kind?this.z5c.zib(h):this.qne.fmi(h)}NZg(h,t,v=!1){h.state=t;h.Ikj();y.EwaSettings.isChangeGateEnabled("OfficeVSO:7654591_FormulaByExampleForbiddenFormulas")&&this.C9h(h,v)}cxj(h){const t=this.fTd(h);return this.vIa.has(t)?
this.vIa.get(t).has(this.ZPf(h)):!1}get UKe(){return Date.now()}ZPf(h){return y.EwaSettings.isChangeGateEnabled("OfficeVSO:8666058_FormulaByExampleForbidByAnonymizedFormula")?h.anonymizedFormula:h.formula}async Rlj(){new Promise(h=>{this.WJj=h});this.pmi();this.Qb.anj(this.xhk,this.oKi,this.PFi);await this.SJj();this.WJj();this.AJf()}pmi(){const h=this.Qb.deleteDatabase(this.whk);l.TaskExtensions.lb(h,t=>{t.result?r.ULS.sendTraceTag(507872217,306,50,"FormulaByExampleSuggestionCache.deleteV1Database: successfully deleted old database."):
r.ULS.sendTraceTag(507872216,306,15,"FormulaByExampleSuggestionCache.deleteV1Database: call to delete old database had failed.")},this.Qb.Ma)}async SJj(){let h,t;const v=new Promise(u=>{t=u});try{h=this.Qb.SXi(this.iih)}catch(u){r.ULS.sendTraceTag(508065931,306,50,`FormulaByExampleSuggestionCache.loadSavedCacheState: failed to get forbidden formulas from indexedDB. error: ${u}`)}if(h)return l.TaskExtensions.lb(h,u=>{u=u.result;try{const x=JSON.parse(u);for(const w of x){const z=new e;for(const A of w.pKi)12096E5<
this.UKe-A.forbiddingDateTime||z.set(A.formula,A.forbiddingDateTime);this.vIa.set(w.target,z)}x&&0<x.length&&r.ULS.sendTraceTag(508065929,306,20,`FormulaByExampleSuggestionCache.loadSavedCacheState: successfully non-empty loaded forbidden formulas save state from indexedDB. forbiddenFormulasByTarget size: ${this.vIa.size}`)}catch(x){r.ULS.sendTraceTag(508065928,306,50,`FormulaByExampleSuggestionCache.loadSavedCacheState: failed to parse forbidden formulas from indexedDB. error: ${x}`)}finally{t()}},
this.Qb.Ma),v;r.ULS.sendTraceTag(508065930,306,50,"FormulaByExampleSuggestionCache.loadSavedCacheState: getSavedStateTask is undefined.");t()}C9h(h,t){switch(h.state){case "DECLINE":case "UNDO":this.IPd(h.suggestion);break;case "IGNORE":t=this.fTd(h.suggestion);if(!this.j_d.has(t)){this.j_d.set(t,new Set([h.suggestion.formula]));break}t=this.j_d.get(t);t.has(h.suggestion.formula)?this.IPd(h.suggestion):t.add(h.suggestion.formula);break;case "ACCEPT":t&&this.IPd(h.suggestion)}}IPd(h){let t;const v=
this.fTd(h);this.vIa.has(v)||(t=new e,this.vIa.set(v,t));t=this.vIa.get(v);t.set(this.ZPf(h),this.UKe);this.raiseEvent("fbefr",new d(h));this.Vje&&this.AJf()}AJf(){const h=[];for(const [t,v]of this.vIa)h.push({["target"]:t,pKi:Array.from(v.entries(),([u,x])=>({["formula"]:u,["forbiddingDateTime"]:x}))});try{this.Qb.hJk({key:this.iih,value:JSON.stringify(h)}),r.ULS.sendTraceTag(508065927,306,50,"FormulaByExampleSuggestionCache.flushForbiddenFormulasToIndexedDB: successfully flushed forbidden formulas to indexedDB.")}catch(t){r.ULS.sendTraceTag(508065926,
306,50,`FormulaByExampleSuggestionCache.flushForbiddenFormulasToIndexedDB: failed to flush forbidden formulas to indexedDB. error: ${t}`)}}fTd(h){return this.Twj?"Table"===h.kind?h.table.name:this.hj.AMf(h.qx,h.sheetId):this.t8i(h)}t8i(h){return"Table"===h.kind?this.z5c.gJa(h):this.hj.kSb(h.qx,h.qx.left-h.originCell.left,h.sheetId)}}(0,ka.a)(n,"FormulaByExampleSuggestionCache",oa.a,[967])},92462:function(ka,oa,a){a.d(oa,{a:function(){return t},b:function(){return l},c:function(){return f},d:function(){return n},
e:function(){return e},f:function(){return m},g:function(){return d},h:function(){return b}});ka=a(89236);var H=a(99488),r=a(49309),Aa=a(60302),k=a(35165),y=a(93447);const b=(x,w,z,A)=>{const C={["flowId"]:x.flowId,["originFormulaFlowId"]:x.hW.flowId,["formulaAnonymized"]:x.anonymizedFormula,["originalFormulaAnonymized"]:x.hW.anonymizedFormula,["range"]:x.range,["failureReason"]:w,["isTableSuggestion"]:(0,k.b)(x)};Aa.ULS.sendTraceTag(221794372,306,20,`FormulaByExample suggestion display failure reported. Failure data ${JSON.stringify(C)}`);
z&&z.mq(x.flowId,A,{reason:w})};var c;(function(x){x.EXAMPLE="EXAMPLE";x.MODIFIEDEXAMPLE="MODIFIEDEXAMPLE";x.RESTOFRANGE="RESTOFRANGE";x.MODIFIEDRESTOFRANGE="MODIFIEDRESTOFRANGE"})(c||(c={}));(0,ka.b)("suggestionCellType",c);const d=(x,w,z,A,C,G,F,B,P,U)=>{x={["failureReason"]:x,["flowId"]:G.flowId,["cellType"]:F,["caller"]:C,["formulaAnonymized"]:G.anonymizedFormula,["originalCellText"]:y.a.eY(w),["evalFormulaText"]:y.a.eY(z),["cellFormatIndex"]:A,["isOriginalValueMatchCellValue"]:B,["isTableSuggestion"]:(0,
k.b)(G),["originalNumFmt"]:P?{["Start"]:y.a.eY(P.Start),["Separator"]:y.a.eY(P.Separator),["End"]:y.a.eY(P.End)}:null,["evalNumFmt"]:U?{["Start"]:y.a.eY(U.Start),["Separator"]:y.a.eY(U.Separator),["End"]:y.a.eY(U.End)}:null};Aa.ULS.sendTraceTag(84165388,0,20,`FormulaByExample CloneEval mismatch failure reported. Failure data ${JSON.stringify(x)}`)},m=(x,w,z)=>{try{const A=v(x,w,z);window.performance.mark(A)}catch(A){Aa.ULS.sendTraceTag(529109767,0,10,`FormulaByExampleTelemetryGenerator.markPerformancePoint: Error thrown : ${A.message}`)}},
l=x=>{for(const w in h)try{window.performance.clearMarks(v(w,x,!1)),window.performance.clearMarks(v(w,x,!0))}catch(z){Aa.ULS.sendTraceTag(527005662,0,10,`FormulaByExampleTelemetryGenerator.clearPerformanceFlowMarks: Error thrown : ${z.message}`)}},f=x=>u(`FBE_flowCurrentDuration_${x}`,v(h.EditCommit,x,!1)),e=(x,w)=>{try{return{["EditCommitToSignal"]:u(`FBE_EditCommitToSignal_${w}_${x}`,v(h.EditCommit,w,!1),v(h.SignalSent,w,!1)),["WorkflowAndNetworkTime"]:x?0:u(`FBE_WorkflowAndNetworkTime_${w}_${x}`,
v(h.SignalSent,w,!1),v(h.AnnotationReceived,w,!1)),["Calculation"]:u(`FBE_Calculation_${w}_${x}`,v(h.CalculationStart,w,x),v(h.CalculationEnd,w,x)),["ModelUpdate"]:u(`FBE_ModelUpdate_${w}_${x}`,v(h.CalculationEnd,w,x),v(h.ModelUpdated,w,x)),["PreviewRender"]:u(`FBE_PreviewRendered_${w}_${x}`,v(h.ModelUpdated,w,x),v(h.PreviewRendered,w,x)),["Total"]:u(`FBE_Total_${w}_${x}`,v(h.EditCommit,w,!1),v(h.PreviewRendered,w,x))}}catch(z){Aa.ULS.sendTraceTag(529109766,0,50,`FormulaByExampleTelemetryGenerator.getPreviewShownDurations: Error thrown : ${z.message}`)}},
n=(x,w)=>{try{return{["UserInPreviewDuration"]:u(`FBE_InputToPreviewRemovedWithCSE_${w}_${x}`,v(h.PreviewRendered,w,x),v(h.UserInputArrived,w,x)),["InputToPreviewRemovedWithCSE"]:u(`FBE_InputToPreviewRemovedWithCSE_${w}_${x}`,v(h.UserInputArrived,w,x),v(h.PreviewRemovedWithCSE,w,x))}}catch(z){Aa.ULS.sendTraceTag(529109765,0,10,`FormulaByExampleTelemetryGenerator.getPreviewRemovedDurations: Error thrown : ${z.message}`)}};var h;(function(x){x.EditCommit="EDITCOMMIT";x.SignalSent="SIGNALSENT";x.AnnotationReceived=
"ANNOTATIONRECEIVED";x.CalculationStart="CALCULATIONSTART";x.CalculationEnd="CALCULATIONED";x.ModelUpdated="MODELUPDATED";x.PreviewRendered="PREVIEWRENDERED";x.UserInputArrived="USERINPUTARRIVED";x.PreviewRemovedWithCSE="PREVIEWREMOVEDWITHCSE"})(h||(h={}));(0,ka.b)("FormulaByExampleFlowMarks",h);const t=x=>H.HelperMethods.bAd&&r.a.kWa&&x.CKa(),v=(x,w,z)=>`${x}_${w+(z?"_cached":"")}`,u=(x,w,z)=>{const A=window.performance.measure(x,w,z);if(A)return w=A.duration,performance.clearMeasures(x),w;Aa.ULS.sendTraceTag(526984791,
0,15,`FormulaByExampleTelemetryGenerator.measureTime: could not find performance entry for measure: ${x}, startMark: ${w}, endMark: ${z}`);return-1}},25657:function(ka,oa,a){a.d(oa,{a:function(){return b},b:function(){return Aa},c:function(){return y}});ka=a(89236);var H;(function(c){c.accept="ACCEPT";c.undo="UNDO";c.decline="DECLINE";c.ignore="IGNORE";c.unseen="UNSEEN"})(H||(H={}));(0,ka.b)("PreviewOutcome",H);var r;(r||(r={})).unseen="UNSEEN";(0,ka.b)("EntryState",r);const Aa={...r,...H};class k{constructor(c){this.state=
Aa.unseen;this.uM=0;this.suggestion=c}Ikj(){this.uM+=1}}(0,ka.a)(k,"SuggestionEntryInternal",null,[]);class y extends Map{Oca(c){const d=this.gJa(c);if(!d)return null;let m=this.get(d);m||(m=[],this.set(d,m));c=new k(c);m.push(c);return c}zib(c){c=this.uTb(c);return this.nmi(c)}nmi(c){if(c){var d=this.gJa(c.suggestion);d=this.get(d);d.splice(d.indexOf(c));return!0}return!1}feh(c){const d=this.uTb(c);return this.fIe(d,c)}fIe(c,d){c&&(c.suggestion=d);return c}}(0,ka.a)(y,"SuggestionsCache",Map,[]);
class b extends y{YVi(c){return super.get(c)?.[0]}uTb(c){return(c=this.gJa(c))?this.has(c)?this.get(c)[0]:null:null}Oca(c){const d=this.gJa(c);if(!d)return null;c=new k(c);this.set(d,[c]);return c}zib(c){return(c=this.gJa(c))?this.delete(c):!1}}(0,ka.a)(b,"SingularSuggestionsCache",y,[])},71106:function(ka,oa,a){a.r(oa);a.d(oa,{RelativeAndAbsoluteReferencesManager:function(){return x}});ka=a(89236);var H=a(75071),r=a(60302);class Aa{}(0,ka.a)(Aa,"Reference",null,[]);class k extends Aa{constructor(){super();
this.column=this.row=null}}(0,ka.a)(k,"CellReference",Aa,[]);class y{constructor(){this.end=this.start=0;this.Zv=null}eRh(w,z){for(let A=0;A<this.Zv.length;A++){const C=this.xrc(w,this.Zv[A]);z+=C;A<this.Zv.length-1&&(z+=":")}return z}}(0,ka.a)(y,"IReferenceSequence",null,[]);var b=a(10531),c=a(11191);class d extends y{constructor(){super();this.RKa=!1}oFc(){const {RelativeAndAbsoluteReferencesManager:w}=a(71106),z=this.Zv[0];return w.sog(z.row.kind===c.a.abs,z.column.kind===c.a.abs)}xrc(w,z){z=b.Range.pc(z.row.index+
1,z.column.index+1);return this.RKa?z.pEc(1===w||3===w,1===w||2===w):z.mea(1===w||3===w,1===w||2===w,!0,!0)}}(0,ka.a)(d,"CellReferenceSequence",y,[]);class m extends Aa{constructor(){super();this.secondColumn=this.firstColumn=null}}(0,ka.a)(m,"ColumnReference",Aa,[]);class l extends y{constructor(){super()}oFc(){const w=this.Zv[0];return a(71106).RelativeAndAbsoluteReferencesManager.Emg(w.firstColumn,w.secondColumn).kind===c.a.abs?2:3}xrc(w,z){return b.Range.eZ(z.firstColumn.index+1,z.secondColumn.index+
1).mea(1===w||3===w,!0,1===w||3===w,!0)}}(0,ka.a)(l,"ColumnReferenceSequence",y,[]);class f extends Aa{constructor(){super();this.right=this.left=this.bottom=this.top=null}}(0,ka.a)(f,"RangeReference",Aa,[]);class e extends y{constructor(){super()}oFc(){const {RelativeAndAbsoluteReferencesManager:w}=a(71106),z=this.Zv[0];return w.sog(z.top.kind===c.a.abs,z.left.kind===c.a.abs)}xrc(w,z){z=new b.Range(z.top.index+1,z.left.index+1,z.bottom.index+1,z.right.index+1,!1,!1);const A=1===w||3===w;w=1===w||
2===w;return z.mea(A,w,A,w)}}(0,ka.a)(e,"RangeReferenceSequence",y,[]);class n extends Aa{constructor(){super();this.secondRow=this.firstRow=null}}(0,ka.a)(n,"RowReference",Aa,[]);class h extends y{constructor(){super()}oFc(){const w=this.Zv[0];return a(71106).RelativeAndAbsoluteReferencesManager.Emg(w.firstRow,w.secondRow).kind===c.a.abs?0:1}xrc(w,z){return b.Range.CR(z.firstRow.index+1,z.secondRow.index+1).mea(!0,1===w||2===w,!0,1===w||2===w)}}(0,ka.a)(h,"RowReferenceSequence",y,[]);var t=a(15755),
v=a(73548),u=a(60808);class x{constructor(w){this.Wd=w}mib(w,z,A){let C,G;C=z;G=A;if(!w||!u.f(w))return{returnValue:w,Rde:C,Qde:G};var F=this.Wd.INd(w);if(!F)return r.ULS.sendTraceTag(524039641,0,15,"RelativeAndAbsoluteReferencesManager.CycleThroughRelativeAndAbsoluteReferences: Couldn't extract references (might be invalid formula)"),{returnValue:null,Rde:C,Qde:G};F=this.w6i(F,w,z,A);let B=0,P="",U=0,O=0;for(;O<F.length;O++)if(this.Twf(F[O],z,A)){B=F[O].oFc();C=F[O].start;break}for(;O<F.length&&
this.Twf(F[O],z,A);O++)P+=w.substring(U,F[O].start),P=F[O].eRh(B,P),U=F[O].end;U&&(G=P.length);P+=w.substring(U,w.length);return{returnValue:P,Rde:C,Qde:G}}w6i(w,z,A,C){const G=[];for(let U=0;U<w.length;U++){var F=w[U];if(F.kind===t.a.range)if(F=F.ref,F.type===v.a.cell){var B=F;F=(0,H.a)(new d,{start:F.span.start,end:F.span.end,Zv:[(0,H.a)(new k,{column:B.col,row:B.row})],RKa:this.Wd.LWa(F.span.end,z)});G.push(F)}else if(F.type===v.a.range)this.Uwf(F.topLeftSpan,A,C)&&this.Uwf(F.bottomRightSpan,A,
C)?(B=new f,F.top.index<=F.bottom.index?(B.top=F.top,B.bottom=F.bottom):(B.bottom=F.top,B.top=F.bottom),F.left.index<=F.right.index?(B.left=F.left,B.right=F.right):(B.right=F.left,B.left=F.right),F=(0,H.a)(new e,{start:F.topLeftSpan.start,end:F.bottomRightSpan.end,Zv:[B]}),G.push(F)):(B=(0,H.a)(new d,{start:F.topLeftSpan.start,end:F.topLeftSpan.end,Zv:[(0,H.a)(new k,{column:F.left,row:F.top})],RKa:this.Wd.LWa(F.topLeftSpan.end,z)}),F=(0,H.a)(new d,{start:F.bottomRightSpan.start,end:F.bottomRightSpan.end,
Zv:[(0,H.a)(new k,{column:F.right,row:F.bottom})],RKa:this.Wd.LWa(F.topLeftSpan.end,z)}),G.push(B),G.push(F));else if(F.type===v.a.column){B=F;for(F=(0,H.a)(new l,{start:F.span.start,end:F.span.end,Zv:[(0,H.a)(new m,{firstColumn:B.startIndex,secondColumn:B.endIndex})]});F.end<z.length-1&&":"===z.charAt(F.end)&&U<w.length-1;)if(B=w[U+1].ref,B.type===v.a.column&&B.span.start===F.end+1){var P=B;F.Zv.push((0,H.a)(new m,{firstColumn:P.startIndex,secondColumn:P.endIndex}));F.end=B.span.end;U++}else break;
G.push(F)}else if(F.type===v.a.row){B=F;for(F=(0,H.a)(new h,{start:F.span.start,end:F.span.end,Zv:[(0,H.a)(new n,{firstRow:B.startIndex,secondRow:B.endIndex})]});F.end<z.length-1&&":"===z.charAt(F.end)&&U<w.length-1;)if(B=w[U+1].ref,B.type===v.a.row&&B.span.start===F.end+1)P=B,F.Zv.push((0,H.a)(new n,{firstRow:P.startIndex,secondRow:P.endIndex})),F.end=B.span.end,U++;else break;G.push(F)}}return G}Twf(w,z,A){return!(w.start>A||z>w.end)}Uwf(w,z,A){return!(w.start>A||z>w.end)}static Emg(w,z){return w.index<=
z.index?w:z}static sog(w,z){return z||w?z&&w?2:!z&&w?3:0:1}}(0,ka.a)(x,"RelativeAndAbsoluteReferencesManager",null,[863])},66108:function(ka,oa,a){a.d(oa,{a:function(){return r}});ka=a(89236);oa=a(79661);var H=a(74370);class r extends oa.a{constructor(){super();this.rows=null;this.column=0;this.generatedFormula=this.formulas=null;this.resultKind=this.invocationMethod=this.stateID=0;this.errorMessage=this.guid=null;this.H_=Object.assign(new H.a,{T_:r.getTypeName(),B_:r.getBaseTypes()})}static getTypeName(){return"AugLoop_FormulaByExample_FormulaByExampleAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}}
(0,ka.a)(r,"FormulaByExampleAnnotation",oa.a,[])},71922:function(ka,oa){Object.defineProperty(oa,"__esModule",{value:!0});ka=oa.lRa={};ka[ka.ArgumentAssistanceCard=0]="ArgumentAssistanceCard";ka[ka.AutoCompleteMenu=1]="AutoCompleteMenu";ka[ka.ValuePreview=2]="ValuePreview"},44266:function(ka,oa,a){Object.defineProperty(oa,"__esModule",{value:!0});a(43216).__exportStar(a(71922),oa)},78604:function(ka,oa,a){a.r(oa);a.d(oa,{"default":function(){return b}});ka=a(66396);ka=a.n(ka);oa=a(4709);oa=a.n(oa);
var H=a(72391);H=a.n(H);var r=a(31380);r=a.n(r);var Aa=a(87696);Aa=a.n(Aa);var k=a(32381);k=a.n(k);a=a(97168);var y={};y.xk=k();y.wk=r();y.insert=H().bind(null,"head");y.nk=oa();y.pk=Aa();ka()(a.a,y);const b=a.a&&a.a.he?a.a.he:void 0},71411:function(ka,oa,a){a.r(oa);a.d(oa,{"default":function(){return b}});ka=a(66396);ka=a.n(ka);oa=a(4709);oa=a.n(oa);var H=a(72391);H=a.n(H);var r=a(31380);r=a.n(r);var Aa=a(87696);Aa=a.n(Aa);var k=a(32381);k=a.n(k);a=a(13815);var y={};y.xk=k();y.wk=r();y.insert=H().bind(null,
"head");y.nk=oa();y.pk=Aa();ka()(a.a,y);const b=a.a&&a.a.he?a.a.he:void 0}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaTS.edt.js.map/20e4dddbbb4879462e56944eb9e6fbf1/EwaTS.edt.js.map